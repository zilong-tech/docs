<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zilong-tech.github.io/docs/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html"><meta property="og:site_name" content="å­é¾™æŠ€æœ¯"><meta property="og:title" content="Spring SecurityåŸç†"><meta property="og:description" content="Spring Securityçš„åŠŸèƒ½å®ç°ä¸»è¦å°±æ˜¯ç”±ä¸€ç³»åˆ—è¿‡æ»¤å™¨é“¾ç›¸äº’é…åˆå®Œæˆçš„ã€‚ å½“åˆå§‹åŒ–Spring Securityæ—¶ï¼Œåœ¨org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurationä¸­ä¼šå¾€Springå®¹å™¨ä¸­æ³¨å…¥ä¸€ä¸ªåä¸ºSpringS..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-02-15T08:34:01.000Z"><meta property="article:author" content="ç¨‹åºå‘˜å­é¾™"><meta property="article:modified_time" content="2023-02-15T08:34:01.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Spring SecurityåŸç†","image":[""],"dateModified":"2023-02-15T08:34:01.000Z","author":[{"@type":"Person","name":"ç¨‹åºå‘˜å­é¾™"}]}</script><title>Spring SecurityåŸç† | å­é¾™æŠ€æœ¯</title><meta name="description" content="Spring Securityçš„åŠŸèƒ½å®ç°ä¸»è¦å°±æ˜¯ç”±ä¸€ç³»åˆ—è¿‡æ»¤å™¨é“¾ç›¸äº’é…åˆå®Œæˆçš„ã€‚ å½“åˆå§‹åŒ–Spring Securityæ—¶ï¼Œåœ¨org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurationä¸­ä¼šå¾€Springå®¹å™¨ä¸­æ³¨å…¥ä¸€ä¸ªåä¸ºSpringS...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/docs/assets/style-84ad0583.css" as="style"><link rel="stylesheet" href="/docs/assets/style-84ad0583.css">
    <link rel="modulepreload" href="/docs/assets/app-e6db4a12.js"><link rel="modulepreload" href="/docs/assets/framework-2afc6763.js"><link rel="modulepreload" href="/docs/assets/Spring SecurityåŸç†.html-cf5f1555.js"><link rel="modulepreload" href="/docs/assets/Spring SecurityåŸç†.html-32517a0d.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/docs/" class="brand"><img class="logo" src="/docs/logo.png" alt="å­é¾™æŠ€æœ¯"><!----><span class="site-name hide-in-pad">å­é¾™æŠ€æœ¯</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/docs/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="nav-link" aria-label="å¹¶å‘ç¼–ç¨‹"><span class="font-icon icon info" style=""></span>å¹¶å‘ç¼–ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="nav-link" aria-label="ç½‘ç»œç¼–ç¨‹"><span class="font-icon icon info" style=""></span>ç½‘ç»œç¼–ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åˆ†å¸ƒå¼"><span class="title"><span class="font-icon icon info" style=""></span>åˆ†å¸ƒå¼</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80/" class="nav-link" aria-label="åˆ†å¸ƒå¼åŸºç¡€"><span class="font-icon icon creative" style=""></span>åˆ†å¸ƒå¼åŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/docs/zookeeper/" class="nav-link" aria-label="zookeeper"><span class="font-icon icon creative" style=""></span>zookeeper<!----></a></li><li class="dropdown-item"><a href="/docs/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" class="nav-link" aria-label="åˆ†å¸ƒå¼äº‹åŠ¡"><span class="font-icon icon creative" style=""></span>åˆ†å¸ƒå¼äº‹åŠ¡<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¾®æœåŠ¡"><span class="title"><span class="font-icon icon info" style=""></span>å¾®æœåŠ¡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/SpringBoot/" class="nav-link" aria-label="SpringBoot"><span class="font-icon icon creative" style=""></span>SpringBoot<!----></a></li><li class="dropdown-item"><a href="/docs/SpringCloudAlibaba/" class="nav-link" aria-label="SpringCloudAlibaba"><span class="font-icon icon creative" style=""></span>SpringCloudAlibaba<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="nav-link" aria-label="è®¾è®¡æ¨¡å¼"><span class="font-icon icon info" style=""></span>è®¾è®¡æ¨¡å¼<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/Java/" class="nav-link" aria-label="Java"><span class="font-icon icon info" style=""></span>Java<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/JVM/" class="nav-link" aria-label="JVM"><span class="font-icon icon info" style=""></span>JVM<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="font-icon icon info" style=""></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/Redis/" class="nav-link" aria-label="Redis"><span class="font-icon icon info" style=""></span>Redis<!----></a></li><li class="dropdown-item"><a href="/docs/MySQL/" class="nav-link" aria-label="MySQL"><span class="font-icon icon info" style=""></span>MySQL<!----></a></li><li class="dropdown-item"><a href="/docs/Mongodb/" class="nav-link" aria-label="Mongodb"><span class="font-icon icon info" style=""></span>Mongodb<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/Mybatis/" class="nav-link" aria-label="Mybatis"><span class="font-icon icon info" style=""></span>Mybatis<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/Spring/" class="nav-link active" aria-label="Spring"><span class="font-icon icon info" style=""></span>Spring<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¶ˆæ¯ä¸­é—´ä»¶"><span class="title"><span class="font-icon icon info" style=""></span>æ¶ˆæ¯ä¸­é—´ä»¶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/Kafka/" class="nav-link" aria-label="Kafka"><span class="font-icon icon creative" style=""></span>Kafka<!----></a></li><li class="dropdown-item"><a href="/docs/RocketMQ/" class="nav-link" aria-label="RocketMQ"><span class="font-icon icon creative" style=""></span>RocketMQ<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/%E9%AB%98%E5%B9%B6%E5%8F%91/" class="nav-link" aria-label="é«˜å¹¶å‘"><span class="font-icon icon info" style=""></span>é«˜å¹¶å‘<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E9%9D%A2%E8%AF%95/" class="nav-link" aria-label="é¢è¯•"><span class="font-icon icon info" style=""></span>é¢è¯•<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E5%B7%A5%E5%85%B7/" class="nav-link" aria-label="å·¥å…·"><span class="font-icon icon info" style=""></span>å·¥å…·<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/" class="nav-link" aria-label="å¼€æºé¡¹ç›®"><span class="font-icon icon info" style=""></span>å¼€æºé¡¹ç›®<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/docs/Spring/CGLIB.html" class="nav-link sidebar-link sidebar-page" aria-label="åŠ¨æ€ä»£ç†-CGLIB"><span class="font-icon icon discover" style=""></span>åŠ¨æ€ä»£ç†-CGLIB<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/%E9%9D%9E%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E7%BB%99%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC.html" class="nav-link sidebar-link sidebar-page" aria-label="éé™æ€å˜é‡ç»™é™æ€å˜é‡èµ‹å€¼"><span class="font-icon icon discover" style=""></span>éé™æ€å˜é‡ç»™é™æ€å˜é‡èµ‹å€¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/%E8%BF%87%E6%BB%A4%E5%99%A8%E4%B8%8E%E6%8B%A6%E6%88%AA%E5%99%A8%E5%8C%BA%E5%88%AB%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨åŒºåˆ«ã€ä½¿ç”¨åœºæ™¯"><span class="font-icon icon discover" style=""></span>è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨åŒºåˆ«ã€ä½¿ç”¨åœºæ™¯<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/%E6%8E%A5%E5%8F%A3%E9%87%8D%E8%AF%95%E6%9C%BA%E5%88%B6%20Spring-Retry.html" class="nav-link sidebar-link sidebar-page" aria-label="æ¥å£é‡è¯•æœºåˆ¶ Spring-Retry"><span class="font-icon icon discover" style=""></span>æ¥å£é‡è¯•æœºåˆ¶ Spring-Retry<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/%E5%88%A9%E7%94%A8cglib%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E6%88%96%E5%9C%A8%E5%8E%9F%E5%AF%B9%E8%B1%A1%E6%96%B0%E5%A2%9E%E5%B1%9E%E6%80%A7.html" class="nav-link sidebar-link sidebar-page" aria-label="åˆ©ç”¨cglibåŠ¨æ€åˆ›å»ºå¯¹è±¡æˆ–åœ¨åŸå¯¹è±¡æ–°å¢å±æ€§"><span class="font-icon icon discover" style=""></span>åˆ©ç”¨cglibåŠ¨æ€åˆ›å»ºå¯¹è±¡æˆ–åœ¨åŸå¯¹è±¡æ–°å¢å±æ€§<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/%E8%81%8A%E8%81%8Aspring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88%E7%9A%84%E5%9C%BA%E6%99%AF.html" class="nav-link sidebar-link sidebar-page" aria-label="èŠèŠspringäº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯"><span class="font-icon icon discover" style=""></span>èŠèŠspringäº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/Hibernate%20Validator%20%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E6%88%98.html" class="nav-link sidebar-link sidebar-page" aria-label="Hibernate Validator å‚æ•°æ ¡éªŒä¼˜é›…å®æˆ˜"><span class="font-icon icon discover" style=""></span>Hibernate Validator å‚æ•°æ ¡éªŒä¼˜é›…å®æˆ˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/Jackson%E5%BA%8F%E5%88%97%E5%8C%96json%E6%97%B6null%E8%BD%AC%E6%88%900%E6%88%96%E7%A9%BA%E4%B8%B2.html" class="nav-link sidebar-link sidebar-page" aria-label="Jacksonåºåˆ—åŒ–jsonæ—¶nullè½¬æˆ0æˆ–ç©ºä¸²"><span class="font-icon icon discover" style=""></span>Jacksonåºåˆ—åŒ–jsonæ—¶nullè½¬æˆ0æˆ–ç©ºä¸²<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/Spring%20%20@Autowired%20Map.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring  @Autowired Map"><span class="font-icon icon discover" style=""></span>Spring  @Autowired Map<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/Spring%20@Cacheable%E4%B8%8E%E5%A4%B1%E6%95%88%E6%97%B6%E9%97%B4TTL.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring @Cacheableä¸å¤±æ•ˆæ—¶é—´TTL"><span class="font-icon icon discover" style=""></span>Spring @Cacheableä¸å¤±æ•ˆæ—¶é—´TTL<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/%E5%9C%A8%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8C%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%8F%AF%E8%83%BD%E9%9D%9E%E5%B8%B8%E5%A4%8D%E6%9D%82%EF%BC%8C%E6%A0%B8%E5%BF%83%E4%B8%9A%E5%8A%A1%20_%20%E5%A4%9A%E4%B8%AA%E5%AD%90%E4%B8%9A%E5%8A%A1.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Event äº‹ä»¶è§£è€¦"><span class="font-icon icon discover" style=""></span>Spring Event äº‹ä»¶è§£è€¦<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/Spring%20Security%20%E5%85%A5%E9%97%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Security å…¥é—¨"><span class="font-icon icon discover" style=""></span>Spring Security å…¥é—¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Spring SecurityåŸç†"><span class="font-icon icon discover" style=""></span>Spring SecurityåŸç†<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html#è®¤è¯æµç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è®¤è¯æµç¨‹"><!---->è®¤è¯æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html#æˆæƒæµç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æˆæƒæµç¨‹"><!---->æˆæƒæµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html#è‡ªå®šä¹‰è®¤è¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è‡ªå®šä¹‰è®¤è¯"><!---->è‡ªå®šä¹‰è®¤è¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html#ä¼šè¯æ§åˆ¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¼šè¯æ§åˆ¶"><!---->ä¼šè¯æ§åˆ¶<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/docs/Spring/Spring%E9%A1%B9%E7%9B%AE%E6%95%B4%E5%90%88MybatisPlus%E5%87%BA%E7%8E%B0org.mybatis.logging.LoggerFactory%20Not%20Found%20%E5%BC%82%E5%B8%B8.html" class="nav-link sidebar-link sidebar-page" aria-label="Springé¡¹ç›®æ•´åˆMybatisPluså‡ºç°org.mybatis.logging.LoggerFactory Not Found å¼‚å¸¸"><span class="font-icon icon discover" style=""></span>Springé¡¹ç›®æ•´åˆMybatisPluså‡ºç°org.mybatis.logging.LoggerFactory Not Found å¼‚å¸¸<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/Spring/Spring%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E8%8E%B7%E5%8F%96bean.html" class="nav-link sidebar-link sidebar-page" aria-label="Springåœ¨ä»£ç ä¸­è·å–bean"><span class="font-icon icon discover" style=""></span>Springåœ¨ä»£ç ä¸­è·å–bean<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="font-icon icon discover" style=""></span>Spring SecurityåŸç†</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">ç¨‹åºå‘˜å­é¾™</span></span><span property="author" content="ç¨‹åºå‘˜å­é¾™"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-10T09:01:37.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 14 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT14M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category1" role>Spring</span><meta property="articleSection" content="Spring"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html#è®¤è¯æµç¨‹" class="router-link-active router-link-exact-active toc-link level3">è®¤è¯æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html#æˆæƒæµç¨‹" class="router-link-active router-link-exact-active toc-link level3">æˆæƒæµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html#è‡ªå®šä¹‰è®¤è¯" class="router-link-active router-link-exact-active toc-link level3">è‡ªå®šä¹‰è®¤è¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/Spring/Spring%20Security%E5%8E%9F%E7%90%86.html#ä¼šè¯æ§åˆ¶" class="router-link-active router-link-exact-active toc-link level3">ä¼šè¯æ§åˆ¶</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><p>Spring Securityçš„åŠŸèƒ½å®ç°ä¸»è¦å°±æ˜¯ç”±ä¸€ç³»åˆ—è¿‡æ»¤å™¨é“¾ç›¸äº’é…åˆå®Œæˆçš„ã€‚</p><p>å½“åˆå§‹åŒ–Spring Securityæ—¶ï¼Œåœ¨org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurationä¸­ä¼šå¾€Springå®¹å™¨ä¸­æ³¨å…¥ä¸€ä¸ªåä¸º<strong>SpringSecurityFilterChain</strong>çš„Servletè¿‡æ»¤å™¨ï¼Œç±»å‹ä¸ºorg.springframework.security.web.FilterChainProxyã€‚å®ƒå®ç°äº†javax.servlet.Filterï¼Œå› æ­¤å¤–éƒ¨çš„è¯·æ±‚éƒ½ä¼šç»è¿‡è¿™ä¸ªç±»ã€‚</p><p>FilterChainProxyæ˜¯ä¸€ä¸ªä»£ç†ï¼ŒçœŸæ­£èµ·ä½œç”¨çš„æ˜¯FilterChainProxyä¸­SecurityFilterChainæ‰€åŒ…å«çš„å„ä¸ªFilterï¼ŒåŒæ—¶ï¼Œè¿™äº›Filteréƒ½å·²ç»æ³¨å…¥åˆ°Springå®¹å™¨ä¸­ï¼Œä»–ä»¬æ˜¯Spring Securityçš„æ ¸å¿ƒï¼Œå„æœ‰å„çš„èŒè´£ã€‚ä½†æ˜¯ä»–ä»¬å¹¶ä¸ç›´æ¥å¤„ç†ç”¨æˆ·çš„è®¤è¯å’Œæˆæƒï¼Œè€Œæ˜¯æŠŠä»–ä»¬äº¤ç»™äº†è®¤è¯ç®¡ç†å™¨(AuthenticationManager)å’Œå†³ç­–ç®¡ç†å™¨(AccessDecisionManager)è¿›è¡Œå¤„ç†ã€‚</p><p><img src="https://pic1.zhimg.com/80/v2-bdd98b2a932b78399bbf34258b3ebed9_720w.png" alt=""></p><p>é¡¹ç›®å¯åŠ¨æ—¶å€™æ‰“å°çš„è¿‡æ»¤å™¨</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code> org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@596dd88d
 org.springframework.security.web.context.SecurityContextPersistenceFilter@78002812
 org.springframework.security.web.header.HeaderWriterFilter@5e93783a
 org.springframework.security.web.authentication.logout.LogoutFilter@621e5270
 org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter@568e8a1a
 org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter@40edd65c
 org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter@5c288735
 org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6d4e288c
 org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@6faecb58
 org.springframework.security.web.authentication.AnonymousAuthenticationFilter@6ecc3f13
 org.springframework.security.web.session.SessionManagementFilter@77e6c7a9
 org.springframework.security.web.access.ExceptionTranslationFilter@59f9844a
 org.springframework.security.web.access.intercept.FilterSecurityInterceptor@6a85289b
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://pica.zhimg.com/80/v2-0446075367f10d0a053da5c0de7de2a2_720w.png" alt=""></p><p>ä»‹ç»è¿‡æ»¤å™¨é“¾ä¸­ä¸»è¦çš„å‡ ä¸ªè¿‡æ»¤å™¨åŠå…¶ä½œç”¨ï¼š</p><p><strong>SecurityContextPersistenceFilter</strong> è¿™ä¸ªFilteræ˜¯æ•´ä¸ªæ‹¦æˆªè¿‡ç¨‹çš„å…¥å£å’Œå‡ºå£ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ‹¦æˆªå™¨ï¼‰ï¼Œä¼šåœ¨è¯·æ±‚å¼€å§‹æ—¶ä»é…ç½®å¥½çš„ SecurityContextRepository ä¸­è·å– SecurityContextï¼Œç„¶åæŠŠå®ƒè®¾ç½®ç»™SecurityContextHolderã€‚åœ¨è¯·æ±‚å®Œæˆåå°†SecurityContextHolder æŒæœ‰çš„ SecurityContext å†ä¿å­˜åˆ°é…ç½®å¥½çš„ SecurityContextRepositoryï¼ŒåŒæ—¶æ¸…é™¤ securityContextHolder æ‰€æŒæœ‰çš„ SecurityContextï¼›</p><p><strong>UsernamePasswordAuthenticationFilter</strong> ç”¨äºå¤„ç†æ¥è‡ªè¡¨å•æäº¤çš„è®¤è¯ã€‚è¯¥è¡¨å•å¿…é¡»æä¾›å¯¹åº”çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå…¶å†…éƒ¨è¿˜æœ‰ç™»å½•æˆåŠŸæˆ–å¤±è´¥åè¿›è¡Œå¤„ç†çš„ AuthenticationSuccessHandler å’Œ AuthenticationFailureHandlerï¼Œè¿™äº›éƒ½å¯ä»¥æ ¹æ®éœ€æ±‚åšç›¸å…³æ”¹å˜ï¼›</p><p><strong>FilterSecurityInterceptor</strong> æ˜¯ç”¨äºä¿æŠ¤webèµ„æºçš„ï¼Œä½¿ç”¨AccessDecisionManagerå¯¹å½“å‰ç”¨æˆ·è¿›è¡Œæˆæƒè®¿é—®ï¼›</p><p><strong>ExceptionTranslationFilter</strong> èƒ½å¤Ÿæ•è·æ¥è‡ª FilterChain æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯å®ƒåªä¼šå¤„ç†ä¸¤ç±»å¼‚å¸¸ï¼šAuthenticationException å’Œ AccessDeniedExceptionï¼Œå…¶å®ƒçš„å¼‚å¸¸å®ƒä¼šç»§ç»­æŠ›å‡ºã€‚</p><h3 id="è®¤è¯æµç¨‹" tabindex="-1"><a class="header-anchor" href="#è®¤è¯æµç¨‹" aria-hidden="true">#</a> è®¤è¯æµç¨‹</h3><p><img src="https://pic1.zhimg.com/80/v2-42bde7bd74d7aa8bbf01bf15626cdd17_720w.png" alt=""></p><p>1ã€ç”¨æˆ·æäº¤ç”¨æˆ·åã€å¯†ç è¢«SecurityFilterChainä¸­çš„ UsernamePasswordAuthenticationFilter è¿‡æ»¤å™¨è·å–åˆ°ï¼Œå°è£…ä¸ºè¯·æ±‚Authenticationï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯UsernamePasswordAuthenticationTokenè¿™ä¸ªå®ç°ç±»ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
    <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span>req<span class="token punctuation">;</span>
    <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span>res<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requiresAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
   
        <span class="token class-name">Authentication</span> authResult<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//ç™»å½•éªŒè¯</span>
            authResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attemptAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>authResult <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>sessionStrategy<span class="token punctuation">.</span><span class="token function">onAuthentication</span><span class="token punctuation">(</span>authResult<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InternalAuthenticationServiceException</span> var8<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;An internal error occurred while trying to authenticate the user.&quot;</span><span class="token punctuation">,</span> var8<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsuccessfulAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> var8<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> var9<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsuccessfulAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> var9<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>continueChainBeforeSuccessfulAuthentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">successfulAuthentication</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">,</span> authResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Authentication</span> <span class="token function">attemptAuthentication</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>postOnly <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationServiceException</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication method not supported: &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">obtainUsername</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">obtainPassword</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            username <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            password <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        username <span class="token operator">=</span> username<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UsernamePasswordAuthenticationToken</span> authRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDetails</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> authRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAuthenticationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>UsernamePasswordAuthenticationTokenç±»çš„ç»§æ‰¿å…³ç³»</p><p><img src="https://pic2.zhimg.com/80/v2-7ad9e89636ac7728e71623da42ca33ef_720w.png" alt=""></p><p>2ã€ è¿‡æ»¤å™¨å°†Authenticationæäº¤è‡³è®¤è¯ç®¡ç†å™¨ï¼ˆAuthenticationManagerï¼‰è¿›è¡Œè®¤è¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// åŠ è½½ç”¨æˆ·ä¿¡æ¯</span>
<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">UserDetails</span> <span class="token function">retrieveUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareTimingAttackProtection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDetails</span> loadedUser <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>loadedUser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalAuthenticationServiceException</span><span class="token punctuation">(</span><span class="token string">&quot;UserDetailsService returned null, which is an interface contract violation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> loadedUser<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UsernameNotFoundException</span> var4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mitigateAgainstTimingAttack</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> var4<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InternalAuthenticationServiceException</span> var5<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> var5<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var6<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalAuthenticationServiceException</span><span class="token punctuation">(</span>var6<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> var6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æ¯”è¾ƒå¯†ç </span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">additionalAuthenticationChecks</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> userDetails<span class="token punctuation">,</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication failed: no credentials provided&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bad credentials&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç”¨æˆ·è¾“å…¥çš„å¯†ç </span>
        <span class="token class-name">String</span> presentedPassword <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>presentedPassword<span class="token punctuation">,</span> userDetails<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication failed: password does not match stored value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bad credentials&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€è®¤è¯æˆåŠŸåï¼Œ AuthenticationManager èº«ä»½ç®¡ç†å™¨è¿”å›ä¸€ä¸ªè¢«å¡«å……æ»¡äº†ä¿¡æ¯çš„ï¼ˆåŒ…æ‹¬ä¸Šé¢æåˆ°çš„æƒé™ä¿¡æ¯ï¼Œèº«ä»½ä¿¡æ¯ï¼Œç»†èŠ‚ä¿¡æ¯ï¼Œä½†å¯†ç é€šå¸¸ä¼šè¢«ç§»é™¤ï¼‰ Authentication å®ä¾‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Authentication</span> <span class="token function">createSuccessAuthentication</span><span class="token punctuation">(</span><span class="token class-name">Object</span> principal<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authentication<span class="token punctuation">,</span> <span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">UsernamePasswordAuthenticationToken</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>principal<span class="token punctuation">,</span> authentication<span class="token punctuation">.</span><span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>authoritiesMapper<span class="token punctuation">.</span><span class="token function">mapAuthorities</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">setDetails</span><span class="token punctuation">(</span>authentication<span class="token punctuation">.</span><span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€ç™»å½•æˆåŠŸä¹‹åï¼Œå°†è®¤è¯åçš„ Authentication å¯¹è±¡å­˜å‚¨åˆ°è¯·æ±‚çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œè¿™æ ·åœ¨æˆæƒé˜¶æ®µå°±å¯ä»¥è·å–åˆ° Authentication è®¤è¯ä¿¡æ¯ï¼Œå¹¶åˆ©ç”¨ Authentication å†…çš„æƒé™ä¿¡æ¯è¿›è¡Œè®¿é—®æ§åˆ¶åˆ¤æ–­ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">successfulAuthentication</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
            <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">,</span> <span class="token class-name">Authentication</span> authResult<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication success. Updating SecurityContextHolder to contain: &quot;</span> <span class="token operator">+</span> authResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
ã€€ã€€ã€€ã€€ã€€<span class="token comment">// ç™»å½•æˆåŠŸä¹‹åï¼ŒæŠŠè®¤è¯åçš„ Authentication å¯¹è±¡å­˜å‚¨åˆ°è¯·æ±‚çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œè¿™æ ·åœ¨æˆæƒé˜¶æ®µå°±å¯ä»¥è·å–åˆ°æ­¤è®¤è¯ä¿¡æ¯è¿›è¡Œè®¿é—®æ§åˆ¶åˆ¤æ–­</span>
        <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authResult<span class="token punctuation">)</span><span class="token punctuation">;</span>

        rememberMeServices<span class="token punctuation">.</span><span class="token function">loginSuccess</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> authResult<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Fire event</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventPublisher <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            eventPublisher<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InteractiveAuthenticationSuccessEvent</span><span class="token punctuation">(</span>
                    authResult<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        successHandler<span class="token punctuation">.</span><span class="token function">onAuthenticationSuccess</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> authResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸»è¦ç»„ä»¶çš„æµç¨‹å›¾ï¼š</p><p><img src="https://pic2.zhimg.com/80/v2-7b2bcf2e45cf880736866e56c225d9ca_720w.png" alt=""></p><h4 id="authenticationprovideræ¥å£-è®¤è¯å¤„ç†å™¨" tabindex="-1"><a class="header-anchor" href="#authenticationprovideræ¥å£-è®¤è¯å¤„ç†å™¨" aria-hidden="true">#</a> AuthenticationProvideræ¥å£ï¼šè®¤è¯å¤„ç†å™¨</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AuthenticationProvider</span> <span class="token punctuation">{</span>
    <span class="token comment">//è®¤è¯çš„æ–¹æ³•</span>
   <span class="token class-name">Authentication</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">;</span>
    <span class="token comment">//æ”¯æŒå“ªç§è®¤è¯ </span>
   <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå¯¹äºAbstractUserDetailsAuthenticationProviderï¼Œä»–çš„supportæ–¹æ³•å°±è¡¨æ˜ä»–å¯ä»¥å¤„ç†ç”¨æˆ·åå¯†ç è¿™æ ·çš„è®¤è¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="authenticationè®¤è¯ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#authenticationè®¤è¯ä¿¡æ¯" aria-hidden="true">#</a> Authenticationè®¤è¯ä¿¡æ¯</h4><p>ç»§æ‰¿è‡ªPrincipalç±»ï¼Œä»£è¡¨ä¸€ä¸ªæŠ½è±¡ä¸»ä½“èº«ä»½ã€‚ç»§æ‰¿äº†ä¸€ä¸ªgetName()æ–¹æ³•æ¥è¡¨ç¤ºä¸»ä½“çš„åç§°ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public interface Authentication extends Principal, Serializable {
	//è·å–æƒé™ä¿¡æ¯åˆ—è¡¨
    Collection&lt;? extends GrantedAuthority&gt; getAuthorities();
	//è·å–å‡­è¯ä¿¡æ¯ã€‚ç”¨æˆ·è¾“å…¥çš„å¯†ç å­—ç¬¦ä¸²ï¼Œåœ¨è®¤è¯è¿‡åé€šå¸¸ä¼šè¢«ç§»é™¤ï¼Œç”¨äºä¿éšœå®‰å…¨ã€‚
    Object getCredentials();
	//ç»†èŠ‚ä¿¡æ¯ï¼Œwebåº”ç”¨ä¸­çš„å®ç°æ¥å£é€šå¸¸ä¸º WebAuthenticationDetailsï¼Œå®ƒè®°å½•äº†è®¿é—®è€…çš„ipåœ° å€å’ŒsessionIdçš„å€¼ã€‚
    Object getDetails();
	//èº«ä»½ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿”å›çš„æ˜¯UserDetailsæ¥å£çš„å®ç°ç±»
    Object getPrincipal();

    boolean isAuthenticated();

    void setAuthenticated(boolean var1) throws IllegalArgumentException;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="userdetailsserviceæ¥å£-è·å–ç”¨æˆ·ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#userdetailsserviceæ¥å£-è·å–ç”¨æˆ·ä¿¡æ¯" aria-hidden="true">#</a> UserDetailsServiceæ¥å£: è·å–ç”¨æˆ·ä¿¡æ¯</h4><p>è·å–ç”¨æˆ·ä¿¡æ¯çš„åŸºç¡€æ¥å£ï¼Œåªæœ‰ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨DaoAuthenticationProviderçš„retrieveUseræ–¹æ³•ä¸­ï¼Œä¼šè·å–springå®¹å™¨ä¸­çš„UserDetailsServiceã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰è‡ªå·±æ³¨å…¥UserDetailsServiceå¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨UserDetailsServiceAutoConfigurationç±»ä¸­ï¼Œä¼šåœ¨å¯åŠ¨æ—¶é»˜è®¤æ³¨å…¥ä¸€ä¸ªå¸¦userç”¨æˆ·çš„UserDetailsServiceã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨å…¥è‡ªå·±çš„UserDetailsServiceæ¥å®ç°åŠ è½½è‡ªå·±çš„æ•°æ®ã€‚</p><h4 id="userdetails-ç”¨æˆ·ä¿¡æ¯å®ä½“" tabindex="-1"><a class="header-anchor" href="#userdetails-ç”¨æˆ·ä¿¡æ¯å®ä½“" aria-hidden="true">#</a> UserDetails: ç”¨æˆ·ä¿¡æ¯å®ä½“</h4><p>ä»£è¡¨äº†ä¸€ä¸ªç”¨æˆ·å®ä½“ï¼ŒåŒ…æ‹¬ç”¨æˆ·ã€å¯†ç ã€æƒé™åˆ—è¡¨ï¼Œè¿˜æœ‰ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬è´¦å·è¿‡æœŸã€è®¤è¯è¿‡æœŸã€æ˜¯å¦å¯ç”¨ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetails</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="passwordencoder-å¯†ç è§£æå™¨" tabindex="-1"><a class="header-anchor" href="#passwordencoder-å¯†ç è§£æå™¨" aria-hidden="true">#</a> PasswordEncoder å¯†ç è§£æå™¨</h4><p>ç”¨æ¥å¯¹å¯†ç è¿›è¡ŒåŠ å¯†åŠè§£æ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PasswordEncoder</span> <span class="token punctuation">{</span>ã€
    <span class="token comment">//åŠ å¯†</span>
    <span class="token class-name">String</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//æ¯”è¾ƒå¯†ç </span>
    <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> var1<span class="token punctuation">,</span> <span class="token class-name">String</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    <span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">upgradeEncoding</span><span class="token punctuation">(</span><span class="token class-name">String</span> encodedPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>DaoAuthenticationProvideråœ¨additionalAuthenticationChecksæ–¹æ³•ä¸­ä¼šè·å–Springå®¹å™¨ä¸­çš„PasswordEncoderæ¥å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡Œæ¯”è¾ƒã€‚</p><h4 id="bcryptpasswordencoder" tabindex="-1"><a class="header-anchor" href="#bcryptpasswordencoder" aria-hidden="true">#</a> BCryptPasswordEncoder:</h4><p>â€‹ è¿™æ˜¯SpringSecurityä¸­æœ€å¸¸ç”¨çš„å¯†ç è§£æå™¨ã€‚ä»–ä½¿ç”¨BCryptç®—æ³•ã€‚ä»–çš„ç‰¹ç‚¹æ˜¯åŠ å¯†å¯ä»¥åŠ ç›saultï¼Œä½†æ˜¯è§£å¯†ä¸éœ€è¦ç›ã€‚å› ä¸ºç›å°±åœ¨å¯†æ–‡å½“ä¸­ã€‚è¿™æ ·å¯ä»¥é€šè¿‡æ¯æ¬¡æ·»åŠ ä¸åŒçš„ç›ï¼Œè€Œç»™åŒæ ·çš„å­—ç¬¦ä¸²åŠ å¯†å‡ºä¸åŒçš„å¯†æ–‡ã€‚</p><p>å¯†æ–‡å½¢å¦‚ï¼š$2a$10$vTUDYhjnVb52iM3qQgi2Du31sq6PRea6xZbIsKIsmOVDnEuGb/.7K</p><p>å…¶ä¸­ï¼š$æ˜¯åˆ†å‰²ç¬¦ï¼Œæ— æ„ä¹‰ï¼›2aæ˜¯bcryptåŠ å¯†ç‰ˆæœ¬å·ï¼›10æ˜¯costçš„å€¼ï¼›è€Œåçš„å‰22ä½æ˜¯saltå€¼ï¼›å†ç„¶åçš„å­—ç¬¦ä¸²å°±æ˜¯å¯†ç çš„å¯†æ–‡äº†</p><h3 id="æˆæƒæµç¨‹" tabindex="-1"><a class="header-anchor" href="#æˆæƒæµç¨‹" aria-hidden="true">#</a> æˆæƒæµç¨‹</h3><p>Spring Securityå¯ä»¥é€šè¿‡http.authorizeRequests()å¯¹webè¯·æ±‚è¿›è¡Œæˆæƒä¿æŠ¤ã€‚Spring Securityä½¿ç”¨æ ‡å‡†Filterå»ºç«‹äº†å¯¹webè¯·æ±‚çš„æ‹¦æˆªï¼Œæœ€ç»ˆå®ç°å¯¹èµ„æºçš„æˆæƒè®¿é—®ã€‚</p><p><img src="https://pica.zhimg.com/80/v2-f73f7bf8688918f83946da121e565cf7_720w.png" alt=""></p><p>1ã€<strong>æ‹¦æˆªè¯·æ±‚</strong>ï¼Œå·²è®¤è¯ç”¨æˆ·è®¿é—®å—ä¿æŠ¤çš„webèµ„æºå°†è¢«SecurityFilterChainä¸­ FilterSecurityInterceptor æ‹¦æˆªã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//FilterSecurityInterceptor.java</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span>
      <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
   <span class="token class-name">FilterInvocation</span> fi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterInvocation</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">invoke</span><span class="token punctuation">(</span>fi<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€<strong>è·å–èµ„æºè®¿é—®ç­–ç•¥</strong>ï¼ŒFilterSecurityInterceptorä¼šä» SecurityMetadataSource çš„å­ç±»DefaultFilterInvocationSecurityMetadataSource è·å–è¦è®¿é—®å½“å‰èµ„æºæ‰€éœ€è¦çš„æƒé™<code>Collection&lt;ConfigAttribute&gt;</code> ã€‚</p><p>SecurityMetadataSourceå…¶å®å°±æ˜¯è¯»å–è®¿é—®ç­–ç•¥çš„æŠ½è±¡ï¼Œè€Œè¯»å–çš„å†…å®¹ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬é…ç½®çš„è®¿é—®è§„åˆ™ï¼Œè¯»å–è®¿é—®ç­–ç•¥å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//å…³é—­csrgè·¨åŸŸæ£€æŸ¥</span>
        <span class="token comment">//è¿™é‡Œæ³¨æ„matchereæ˜¯æœ‰é¡ºåºçš„ã€‚</span>
        <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/mobile/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;mobile&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/salary/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;salary&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/common/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//commonä¸‹çš„è¯·æ±‚ç›´æ¥é€šè¿‡</span>
        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//å…¶ä»–è¯·æ±‚éœ€è¦ç™»å½•</span>
        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//å¹¶è¡Œæ¡ä»¶</span>
        <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/main.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">failureUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/common/loginFailed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€<strong>æœ€å</strong>ï¼ŒFilterSecurityInterceptorä¼šè°ƒç”¨ AccessDecisionManager è¿›è¡Œæˆæƒå†³ç­–ï¼Œè‹¥å†³ç­–é€šè¿‡ï¼Œåˆ™å…è®¸è®¿é—®èµ„æºï¼Œå¦åˆ™å°†ç¦æ­¢è®¿é—®ã€‚</p><p>å…³äºAccessDecisionManageræ¥å£ï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯å…¶ä¸­çš„decideæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥é‰´å®šå½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®å¯¹åº”å—ä¿æŠ¤èµ„æºçš„æƒé™ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccessDecisionManager</span> <span class="token punctuation">{</span>
	<span class="token comment">//é€šè¿‡ä¼ é€’çš„å‚æ•°æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®å¯¹åº”å—ä¿æŠ¤èµ„æºçš„æƒé™</span>
	<span class="token keyword">void</span> <span class="token function">decide</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication<span class="token punctuation">,</span> <span class="token class-name">Object</span> object<span class="token punctuation">,</span>
			<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigAttribute</span><span class="token punctuation">&gt;</span></span> configAttributes<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AccessDeniedException</span><span class="token punctuation">,</span>
			<span class="token class-name">InsufficientAuthenticationException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œç€é‡è¯´æ˜ä¸€ä¸‹decideçš„å‚æ•°ï¼š</p><p>authenticationï¼šè¦è®¿é—®èµ„æºçš„è®¿é—®è€…çš„èº«ä»½</p><p>objectï¼šè¦è®¿é—®çš„å—ä¿æŠ¤èµ„æºï¼Œwebè¯·æ±‚å¯¹åº”FilterInvocation</p><p>configAttributesï¼šæ˜¯å—ä¿æŠ¤èµ„æºçš„è®¿é—®ç­–ç•¥ï¼Œé€šè¿‡SecurityMetadataSourceè·å–ã€‚</p><h4 id="å†³ç­–æµç¨‹" tabindex="-1"><a class="header-anchor" href="#å†³ç­–æµç¨‹" aria-hidden="true">#</a> å†³ç­–æµç¨‹</h4><p>åœ¨AccessDecisionManagerçš„å®ç°ç±»ConsensusBasedä¸­ï¼Œæ˜¯ä½¿ç”¨æŠ•ç¥¨çš„æ–¹å¼æ¥ç¡®å®šæ˜¯å¦èƒ½å¤Ÿè®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚</p><p><img src="https://pic2.zhimg.com/80/v2-87e168da212e1a5898514c774167ff40_720w.png" alt=""></p><p>AccessDecisionManagerä¸­åŒ…å«äº†ä¸€ç³»åˆ—çš„AccessDecisionVoterè®²ä¼šè¢«ç”¨æ¥å¯¹Authenticationæ˜¯å¦æœ‰æƒè®¿é—®å—ä¿æŠ¤å¯¹è±¡è¿›è¡ŒæŠ•ç¥¨ï¼ŒAccessDecisionManageræ ¹æ®æŠ•ç¥¨ç»“æœï¼Œåšå‡ºæœ€ç»ˆè§’è‰²ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¦æŠ•ç¥¨ï¼Ÿ å› ä¸ºæƒé™å¯ä»¥ä»å¤šä¸ªæ–¹é¢æ¥è¿›è¡Œé…ç½®ï¼Œæœ‰è§’è‰²ä½†æ˜¯æ²¡æœ‰èµ„æºæ€ä¹ˆåŠï¼Ÿè¿™å°±éœ€è¦æœ‰ä¸åŒçš„å¤„ç†ç­–ç•¥</p></blockquote><p>AccessDecisionVoteræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccessDecisionVoter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> <span class="token constant">ACCESS_GRANTED</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> <span class="token constant">ACCESS_ABSTAIN</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> <span class="token constant">ACCESS_DENIED</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

   <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">ConfigAttribute</span> attribute<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">int</span> <span class="token function">vote</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication<span class="token punctuation">,</span> <span class="token class-name">S</span> object<span class="token punctuation">,</span>
         <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigAttribute</span><span class="token punctuation">&gt;</span></span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vote()å°±æ˜¯è¿›è¡ŒæŠ•ç¥¨çš„æ–¹æ³•ã€‚æŠ•ç¥¨å¯ä»¥è¡¨ç¤ºèµæˆã€æ‹’ç»ã€å¼ƒæƒã€‚</p><p>Spring Securityå†…ç½®äº†ä¸‰ä¸ªåŸºäºæŠ•ç¥¨çš„å®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯AffirmativeBased,ConsensusBasesdå’ŒUnanimaousBased</p><p><strong>AffirmativeBasedæ˜¯Spring Securityé»˜è®¤ä½¿ç”¨çš„æŠ•ç¥¨æ–¹å¼</strong>ï¼Œä»–çš„é€»è¾‘æ˜¯åªè¦æœ‰ä¸€ä¸ªæŠ•ç¥¨é€šè¿‡ï¼Œå°±è¡¨ç¤ºé€šè¿‡ã€‚</p><p>â€‹ 1ã€åªè¦æœ‰ä¸€ä¸ªæŠ•ç¥¨é€šè¿‡äº†ï¼Œå°±è¡¨ç¤ºé€šè¿‡ã€‚</p><p>â€‹ 2ã€å¦‚æœå…¨éƒ¨å¼ƒæƒä¹Ÿè¡¨ç¤ºé€šè¿‡ã€‚</p><p>â€‹ 3ã€å¦‚æœæ²¡æœ‰äººæŠ•èµæˆç¥¨ï¼Œä½†æ˜¯æœ‰äººæŠ•åå¯¹ç¥¨ï¼Œåˆ™æŠ›å‡ºAccessDeniedException.</p><p><strong>ConsensusBased</strong>çš„é€»è¾‘æ˜¯ï¼šå¤šæ•°èµæˆå°±é€šè¿‡</p><p>â€‹ 1ã€å¦‚æœèµæˆç¥¨å¤šäºåå¯¹ç¥¨åˆ™è¡¨ç¤ºé€šè¿‡</p><p>â€‹ 2ã€å¦‚æœåå¯¹ç¥¨å¤šäºèµæˆç¥¨åˆ™æŠ›å‡ºAccessDeniedException</p><p>â€‹ 3ã€å¦‚æœèµæˆç¥¨ä¸åå¯¹ç¥¨ç›¸åŒä¸”ä¸ç­‰äº0ï¼Œå¹¶ä¸”å±æ€§allowIfEqualGrantedDeniedDecisionsçš„å€¼ä¸ºtrueï¼Œåˆ™è¡¨ç¤ºé€šè¿‡ï¼Œå¦åˆ™æŠ›å‡ºAccessDeniedExceptionã€‚å‚æ•°allowIfEqualGrantedDeniedDecisionsçš„å€¼é»˜è®¤æ˜¯trueã€‚</p><p>â€‹ 4ã€å¦‚æœæ‰€æœ‰çš„AccessDecisionVoteréƒ½å¼ƒæƒäº†ï¼Œåˆ™å°†è§†å‚æ•°allowIfAllAbstainDecisionsçš„å€¼è€Œå®šï¼Œå¦‚æœè¯¥å€¼ä¸ºtrueåˆ™è¡¨ç¤ºé€šè¿‡ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸AccessDeniedExceptionã€‚å‚æ•°allowIfAllAbstainDecisionsçš„å€¼é»˜è®¤ä¸ºfalseã€‚</p><p>â€‹ <strong>UnanimousBased</strong>ç›¸å½“äºä¸€ç¥¨å¦å†³ã€‚</p><p>â€‹ 1ã€å¦‚æœå—ä¿æŠ¤å¯¹è±¡é…ç½®çš„æŸä¸€ä¸ªConfifigAttributeè¢«ä»»æ„çš„AccessDecisionVoteråå¯¹äº†ï¼Œåˆ™å°†æŠ›å‡ºAccessDeniedExceptionã€‚</p><p>â€‹ 2ã€å¦‚æœæ²¡æœ‰åå¯¹ç¥¨ï¼Œä½†æ˜¯æœ‰èµæˆç¥¨ï¼Œåˆ™è¡¨ç¤ºé€šè¿‡ã€‚</p><p>â€‹ 3ã€å¦‚æœå…¨éƒ¨å¼ƒæƒäº†ï¼Œåˆ™å°†è§†å‚æ•°allowIfAllAbstainDecisionsçš„å€¼è€Œå®šï¼Œtrueåˆ™é€šè¿‡ï¼Œfalseåˆ™æŠ›å‡ºAccessDeniedExceptionã€‚</p><p>â€‹ Spring Securityé»˜è®¤æ˜¯ä½¿ç”¨çš„AffirmativeBasedæŠ•ç¥¨å™¨ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡å¾€Springå®¹å™¨é‡Œæ³¨å…¥çš„æ–¹å¼æ¥é€‰æ‹©æŠ•ç¥¨å†³å®šå™¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">AccessDecisionManager</span> <span class="token function">accessDecisionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccessDecisionVoter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> decisionVoters 
      <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">WebExpressionVoter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">RoleVoter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">AuthenticatedVoter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">MinuteBasedVoter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UnanimousBased</span><span class="token punctuation">(</span>decisionVoters<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨configureä¸­é…ç½®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    http
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">accessDecisionManager</span><span class="token punctuation">(</span><span class="token function">accessDecisionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è‡ªå®šä¹‰è®¤è¯" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰è®¤è¯" aria-hidden="true">#</a> è‡ªå®šä¹‰è®¤è¯</h3><h4 id="è‡ªå®šä¹‰ç™»å½•é¡µé¢åŠç™»å½•è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç™»å½•é¡µé¢åŠç™»å½•è¿‡ç¨‹" aria-hidden="true">#</a> è‡ªå®šä¹‰ç™»å½•é¡µé¢åŠç™»å½•è¿‡ç¨‹</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token comment">//é…ç½®å®‰å…¨æ‹¦æˆªæœºåˆ¶</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
   http
           <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/r/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    
           <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                
           <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//å…è®¸è¡¨å•ç™»å½•</span>
         <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/loginâ€view&quot;</span><span class="token punctuation">)</span><span class="token comment">//è‡ªå®šä¹‰ç™»å½•é¡µé¢</span>
         <span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token comment">//è‡ªå®šä¹‰ç™»å½•å¤„ç†åœ°å€</span>
       	<span class="token punctuation">.</span><span class="token function">defaultSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/main.html&quot;</span><span class="token punctuation">)</span><span class="token comment">//æŒ‡å®šç™»å½•æˆåŠŸåçš„è·³è½¬åœ°å€-é¡µé¢é‡å®šå‘</span>
        <span class="token comment">// .successForwardUrl(&quot;/loginâ€success&quot;)//æŒ‡å®šç™»å½•æˆåŠŸåçš„è·³è½¬URL - åç«¯è·³è½¬</span>
         <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å°†æ•°æ®æºæ”¹ä¸ºä»æ•°æ®åº“è·å–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#å°†æ•°æ®æºæ”¹ä¸ºä»æ•°æ®åº“è·å–æ•°æ®" aria-hidden="true">#</a> å°†æ•°æ®æºæ”¹ä¸ºä»æ•°æ®åº“è·å–æ•°æ®</h4><p>ä¿®æ”¹UserDetailsï¼Œä»æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>ä¿®æ”¹HttpSecurityï¼Œä»æ•°æ®åº“åŠ è½½æˆæƒé…ç½®ã€‚</p><h4 id="é…ç½®æ–¹æ³•ä¸èµ„æºç»‘å®šå…³ç³»" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ–¹æ³•ä¸èµ„æºç»‘å®šå…³ç³»" aria-hidden="true">#</a> é…ç½®æ–¹æ³•ä¸èµ„æºç»‘å®šå…³ç³»</h4><h5 id="_1ã€ä»£ç æ–¹å¼é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1ã€ä»£ç æ–¹å¼é…ç½®" aria-hidden="true">#</a> 1ã€ä»£ç æ–¹å¼é…ç½®</h5><p>â€‹ Spring Securityå¯ä»¥é€šè¿‡HttpSecurityé…ç½®URLæˆæƒä¿¡æ¯ï¼Œä¿æŠ¤URLå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>authenticated() ä¿æŠ¤URLï¼Œéœ€è¦ç”¨æˆ·ç™»å½•
permitAll() æŒ‡å®šURLæ— éœ€ä¿æŠ¤ï¼Œä¸€èˆ¬åº”ç”¨ä¸é™æ€èµ„æºæ–‡ä»¶
hasRole(String role) é™åˆ¶å•ä¸ªè§’è‰²è®¿é—®ã€‚è§’è‰²å…¶å®ç›¸å½“äºä¸€ä¸ª&quot;ROLE_&quot;+roleçš„èµ„æºã€‚
hasAuthority(String authority) é™åˆ¶å•ä¸ªæƒé™è®¿é—®
hasAnyRole(Stringâ€¦ roles)å…è®¸å¤šä¸ªè§’è‰²è®¿é—®. 
hasAnyAuthority(Stringâ€¦ authorities) å…è®¸å¤šä¸ªæƒé™è®¿é—®. 
access(String attribute) è¯¥æ–¹æ³•ä½¿ç”¨ SpELè¡¨è¾¾å¼, æ‰€ä»¥å¯ä»¥åˆ›å»ºå¤æ‚çš„é™åˆ¶. 
hasIpAddress(String ipaddressExpression) é™åˆ¶IPåœ°å€æˆ–å­ç½‘
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2ã€æ³¨è§£æ–¹å¼é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2ã€æ³¨è§£æ–¹å¼é…ç½®" aria-hidden="true">#</a> 2ã€æ³¨è§£æ–¹å¼é…ç½®</h5><p>â€‹ Spring Securityé™¤äº†å¯ä»¥é€šè¿‡HttpSecurityé…ç½®æˆæƒä¿¡æ¯å¤–ï¼Œè¿˜æä¾›äº†æ³¨è§£æ–¹å¼å¯¹æ–¹æ³•è¿›è¡Œæˆæƒã€‚</p><p>â€‹ æ³¨è§£æ–¹å¼éœ€è¦å…ˆåœ¨å¯åŠ¨åŠ è½½çš„ç±»ä¸­æ‰“å¼€ @EnableGlobalMethodSecurity(securedEnabled=true) æ³¨è§£ï¼Œç„¶ååœ¨éœ€è¦æƒé™ç®¡ç†çš„æ–¹æ³•ä¸Šä½¿ç”¨@Secured(Resource)çš„æ–¹å¼é…åˆæƒé™ã€‚å…¶ä¸­</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@EnableGlobalMethodSecurity(securedEnabled=true) å¼€å¯@Secured æ³¨è§£è¿‡æ»¤æƒé™
	æ‰“å¼€å@Secured({&quot;ROLE_manager&quot;,&quot;ROLE_admin&quot;}) è¡¨ç¤ºæ–¹æ³•éœ€è¦æœ‰managerå’Œadminä¸¤ä¸ªè§’è‰²æ‰èƒ½è®¿é—®
	å¦å¤–@Securedæ³¨è§£æœ‰äº›å…³é”®å­—ï¼Œæ¯”å¦‚IS_AUTHENTICATED_ANONYMOUSLY è¡¨ç¤ºå¯ä»¥åŒ¿åç™»å½•ã€‚
@EnableGlobalMethodSecurity(jsr250Enabled=true)	å¼€å¯@RolesAllowed æ³¨è§£è¿‡æ»¤æƒé™ 

@EnableGlobalMethodSecurity(prePostEnabled=true) ä½¿ç”¨è¡¨è¾¾å¼æ—¶é—´æ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§ï¼Œæ‰“å¼€åå¯ä»¥ä½¿ç”¨ä¸€ä¸‹å‡ ä¸ªæ³¨è§£ã€‚
    @PreAuthorize åœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰,åŸºäºè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ¥é™åˆ¶å¯¹æ–¹æ³•çš„è®¿é—®ã€‚ä¾‹å¦‚@PreAuthorize(&quot;hasRole(&#39;normal&#39;) AND hasRole(&#39;admin&#39;)&quot;)
    @PostAuthorize å…è®¸æ–¹æ³•è°ƒç”¨,ä½†æ˜¯å¦‚æœè¡¨è¾¾å¼è®¡ç®—ç»“æœä¸ºfalse,å°†æŠ›å‡ºä¸€ä¸ªå®‰å…¨æ€§å¼‚å¸¸ã€‚æ­¤æ³¨é‡Šæ”¯æŒä½¿ç”¨returnObjectæ¥è¡¨ç¤ºè¿”å›çš„å¯¹è±¡ã€‚ä¾‹å¦‚@PostAuthorize(&quot; returnObject!=null &amp;&amp;  returnObject.username == authentication.name&quot;)
    @PostFilter å…è®¸æ–¹æ³•è°ƒç”¨,ä½†å¿…é¡»æŒ‰ç…§è¡¨è¾¾å¼æ¥è¿‡æ»¤æ–¹æ³•çš„ç»“æœ
    @PreFilter å…è®¸æ–¹æ³•è°ƒç”¨,ä½†å¿…é¡»åœ¨è¿›å…¥æ–¹æ³•ä¹‹å‰è¿‡æ»¤è¾“å…¥å€¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¼šè¯æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¼šè¯æ§åˆ¶" aria-hidden="true">#</a> ä¼šè¯æ§åˆ¶</h3><h4 id="è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯" aria-hidden="true">#</a> è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</h4><p>ç”¨æˆ·è®¤è¯é€šè¿‡åï¼Œä¸ºäº†é¿å…ç”¨æˆ·çš„æ¯æ¬¡æ“ä½œéƒ½è¿›è¡Œè®¤è¯å¯å°†ç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åœ¨ä¼šè¯ä¸­ã€‚spring securityæä¾›ä¼šè¯ç®¡</p><p>ç†ï¼Œè®¤è¯é€šè¿‡åå°†èº«ä»½ä¿¡æ¯æ”¾å…¥SecurityContextHolderä¸Šä¸‹æ–‡ï¼ŒSecurityContextä¸å½“å‰çº¿ç¨‹è¿›è¡Œç»‘å®šï¼Œæ–¹ä¾¿è·å–</p><p>ç”¨æˆ·èº«ä»½ã€‚</p><p>å¯ä»¥é€šè¿‡ä¸ºSecurityContextHolder.getContext().getAuthentication()è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/common&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/getLoginUserByPrincipal&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getLoginUserByPrincipal</span><span class="token punctuation">(</span><span class="token class-name">Principal</span> principal<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> principal<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/getLoginUserByAuthentication&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">currentUserName</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> authentication<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/username&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">currentUserNameSimple</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Principal</span> principal <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getUserPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> principal<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/getLoginUser&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getLoginUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Principal</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Principal</span><span class="token punctuation">)</span><span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> principal<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¼šè¯æ§åˆ¶-1" tabindex="-1"><a class="header-anchor" href="#ä¼šè¯æ§åˆ¶-1" aria-hidden="true">#</a> ä¼šè¯æ§åˆ¶</h4><p>â€‹ å¯ä»¥é€šè¿‡é…ç½®sessonCreationPolicyå‚æ•°æ¥äº†æ§åˆ¶å¦‚ä½•ç®¡ç†Sessionã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">sessionCreationPolicy</span><span class="token punctuation">(</span><span class="token class-name">SessionCreationPolicy</span><span class="token punctuation">.</span><span class="token constant">IF_REQUIRED</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå±æ€§æœ‰å‡ ä¸ªé€‰é¡¹ï¼š</p><table><thead><tr><th>æœºåˆ¶</th><th>æè¿°</th></tr></thead><tbody><tr><td>always</td><td>å¦‚æœæ²¡æœ‰Sessionå°±åˆ›å»ºä¸€ä¸ª</td></tr><tr><td>ifRequired</td><td>å¦‚æœéœ€è¦å°±åœ¨ç™»å½•æ—¶åˆ›å»ºä¸€ä¸ªï¼Œé»˜è®¤ç­–ç•¥</td></tr><tr><td>never</td><td>SpringSecurityå°†ä¸ä¼šåˆ›å»ºSessionã€‚ä½†æ˜¯å¦‚æœåº”ç”¨ä¸­å…¶ä»–åœ°æ–¹åˆ›å»ºäº†Sessionï¼Œé‚£ä¹ˆSpring Securityå°±ä¼šä½¿ç”¨ã€‚</td></tr><tr><td>stateless</td><td>SpringSecurityå°†ç»å¯¹ä¸åˆ›å»ºSessionï¼Œä¹Ÿä¸ä½¿ç”¨ã€‚é€‚åˆäºä¸€äº›REST APIçš„æ— çŠ¶æ€åœºæ™¯ã€‚</td></tr></tbody></table><h4 id="ä¼šè¯è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#ä¼šè¯è¶…æ—¶" aria-hidden="true">#</a> ä¼šè¯è¶…æ—¶</h4><p>â€‹ ä¼šè¯è¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡spring bootçš„é…ç½®ç›´æ¥å®¡å®šã€‚</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">server.servlet.session.timeout</span><span class="token punctuation">=</span><span class="token value attr-value">3600s</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>sessionè¶…æ—¶åï¼Œå¯ä»¥é€šè¿‡SpringSecurityçš„httpé…ç½®è·³è½¬åœ°å€</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>http<span class="token punctuation">.</span><span class="token function">sessionManagement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">expiredUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/loginâ€view?error=EXPIRED_SESSION&quot;</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">invalidSessionUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/loginâ€view?error=INVALID_SESSION&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>expiredæ˜¯æŒ‡sessionè¿‡æœŸï¼ŒinvalidSessionæŒ‡ä¼ å…¥çš„sessionIdå¤±æ•ˆã€‚</p><h4 id="å®‰å…¨ä¼šè¯cookie" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨ä¼šè¯cookie" aria-hidden="true">#</a> å®‰å…¨ä¼šè¯cookie</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨httpOnlyå’Œsecureæ ‡ç­¾æ¥ä¿æŠ¤æˆ‘ä»¬çš„ä¼šè¯cookieï¼š</p><p><strong>httpOnly</strong>ï¼šå¦‚æœä¸ºtrueï¼Œé‚£ä¹ˆæµè§ˆå™¨è„šæœ¬å°†æ— æ³•è®¿é—®cookie</p><p><strong>secure</strong>ï¼šå¦‚æœä¸ºtrueï¼Œåˆ™cookieå°†ä»…é€šè¿‡HTTPSè¿æ¥å‘é€</p><p>spring boot é…ç½®æ–‡ä»¶ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">server.servlet.session.cookie.httpâ€only</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">server.servlet.session.cookie.secure</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é€€å‡º" tabindex="-1"><a class="header-anchor" href="#é€€å‡º" aria-hidden="true">#</a> é€€å‡º</h4><p>â€‹ Spring Securityé»˜è®¤å®ç°äº†logouté€€å‡ºï¼Œç›´æ¥è®¿é—®/logoutå°±ä¼šè·³è½¬åˆ°ç™»å‡ºé¡µé¢ï¼Œè€Œajaxè®¿é—®/logoutå°±å¯ä»¥ç›´æ¥é€€å‡ºã€‚</p><p>â€‹ åœ¨WebSecurityConfifigçš„config(HttpSecurity http)ä¸­ï¼Œä¹Ÿæ˜¯å¯ä»¥é…ç½®é€€å‡ºçš„ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚è‡ªå®šä¹‰é€€å‡ºé¡µé¢ã€å®šä¹‰æ¨å‡ºåçš„è·³è½¬åœ°å€ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>http
<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//æä¾›ç³»ç»Ÿé€€å‡ºæ”¯æŒï¼Œä½¿ç”¨ WebSecurityConfigurerAdapter ä¼šè‡ªåŠ¨è¢«åº”ç”¨</span>
<span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span> <span class="token comment">//é»˜è®¤é€€å‡ºåœ°å€</span>
<span class="token punctuation">.</span><span class="token function">logoutSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/loginâ€view?logout&quot;</span><span class="token punctuation">)</span> <span class="token comment">//é€€å‡ºåçš„è·³è½¬åœ°å€</span>
    <span class="token punctuation">.</span><span class="token function">addLogoutHandler</span><span class="token punctuation">(</span>logoutHandler<span class="token punctuation">)</span> <span class="token comment">//æ·»åŠ ä¸€ä¸ªLogoutHandlerï¼Œç”¨äºå®ç°ç”¨æˆ·é€€å‡ºæ—¶çš„æ¸…ç†å·¥ä½œ.é»˜è®¤ SecurityContextLogoutHandler ä¼šè¢«æ·»åŠ ä¸ºæœ€åä¸€ä¸ª LogoutHandler ã€‚</span>
    <span class="token punctuation">.</span><span class="token function">invalidateHttpSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//æŒ‡å®šæ˜¯å¦åœ¨é€€å‡ºæ—¶è®©HttpSessionå¤±æ•ˆï¼Œé»˜è®¤æ˜¯true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨é€€å‡ºæ“ä½œæ—¶ï¼Œä¼šåšä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p><p>1ã€ä½¿HTTP Sessionå¤±æ•ˆã€‚</p><p>2ã€æ¸…é™¤SecurityContextHolder</p><p>3ã€è·³è½¬åˆ°å®šä¹‰çš„åœ°å€ã€‚</p><p><strong>logoutHandler</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ LogoutHandler çš„å®ç°ç±»è¢«ç”¨æ¥æ‰§è¡Œå¿…è¦çš„æ¸…ç†ï¼Œå› è€Œä»–ä»¬ä¸åº”è¯¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ä¸‹é¢æ˜¯Spring Securityæä¾›çš„ä¸€äº›å®ç°ï¼š</p><ul><li><p>PersistentTokenBasedRememberMeServices åŸºäºæŒä¹…åŒ–tokençš„<strong>RememberMe</strong>åŠŸèƒ½çš„ç›¸å…³æ¸…ç†</p></li><li><p>TokenBasedRememberMeService åŸºäºtokençš„<strong>RememberMe</strong>åŠŸèƒ½çš„ç›¸å…³æ¸…ç†</p></li><li><p>CookieClearingLogoutHandler é€€å‡ºæ—¶Cookieçš„ç›¸å…³æ¸…ç†</p></li><li><p>CsrfLogoutHandler è´Ÿè´£åœ¨é€€å‡ºæ—¶ç§»é™¤csrfToken</p></li><li><p>SecurityContextLogoutHandler é€€å‡ºæ—¶SecurityContextçš„ç›¸å…³æ¸…ç†</p></li></ul><p>é“¾å¼APIæä¾›äº†è°ƒç”¨ç›¸åº”çš„ LogoutHandler å®ç°çš„å¿«æ·æ–¹å¼ï¼Œæ¯”å¦‚deleteCookies()ã€‚</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: zysspace@163.com">javacode</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/docs/Spring/Spring%20Security%20%E5%85%A5%E9%97%A8.html" class="nav-link prev" aria-label="Spring Security å…¥é—¨"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon discover" style=""></span>Spring Security å…¥é—¨</div></a><a href="/docs/Spring/Spring%E9%A1%B9%E7%9B%AE%E6%95%B4%E5%90%88MybatisPlus%E5%87%BA%E7%8E%B0org.mybatis.logging.LoggerFactory%20Not%20Found%20%E5%BC%82%E5%B8%B8.html" class="nav-link next" aria-label="Springé¡¹ç›®æ•´åˆMybatisPluså‡ºç°org.mybatis.logging.LoggerFactory Not Found å¼‚å¸¸"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">Springé¡¹ç›®æ•´åˆMybatisPluså‡ºç°org.mybatis.logging.LoggerFactory Not Found å¼‚å¸¸<span class="font-icon icon discover" style=""></span></div></a></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/docs/assets/app-e6db4a12.js" defer></script>
  </body>
</html>
