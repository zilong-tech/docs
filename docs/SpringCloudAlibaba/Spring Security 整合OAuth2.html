<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zilong-tech.github.io/docs/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html"><meta property="og:site_name" content="å­é¾™æŠ€æœ¯"><meta property="og:title" content="Spring Security æ•´åˆOAuth2"><meta property="og:description" content="OAuth2.0ä»‹ç» OAuthï¼ˆOpen Authorizationï¼‰æ˜¯ä¸€ä¸ªå…³äºæˆæƒï¼ˆauthorizationï¼‰çš„å¼€æ”¾ç½‘ç»œæ ‡å‡†ï¼Œå…è®¸ç”¨æˆ·æˆæƒç¬¬ä¸‰æ–¹ åº”ç”¨è®¿é—®ä»–ä»¬å­˜å‚¨åœ¨å¦å¤–çš„æœåŠ¡æä¾›è€…ä¸Šçš„ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å°†ç”¨æˆ·åå’Œå¯†ç æä¾›ç»™ç¬¬ä¸‰æ–¹ç§»åŠ¨åº”ç”¨æˆ–åˆ†äº«ä»– ä»¬æ•°æ®çš„æ‰€æœ‰å†…å®¹ã€‚OAuthåœ¨å…¨ä¸–ç•Œå¾—åˆ°å¹¿æ³›åº”ç”¨ï¼Œç›®å‰çš„ç‰ˆæœ¬æ˜¯2.0ç‰ˆã€‚ OAuthåè®®ï¼šhttps://..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-02-10T09:01:37.000Z"><meta property="article:author" content="ç¨‹åºå‘˜å­é¾™"><meta property="article:modified_time" content="2023-02-10T09:01:37.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Spring Security æ•´åˆOAuth2","image":[""],"dateModified":"2023-02-10T09:01:37.000Z","author":[{"@type":"Person","name":"ç¨‹åºå‘˜å­é¾™"}]}</script><title>Spring Security æ•´åˆOAuth2 | å­é¾™æŠ€æœ¯</title><meta name="description" content="OAuth2.0ä»‹ç» OAuthï¼ˆOpen Authorizationï¼‰æ˜¯ä¸€ä¸ªå…³äºæˆæƒï¼ˆauthorizationï¼‰çš„å¼€æ”¾ç½‘ç»œæ ‡å‡†ï¼Œå…è®¸ç”¨æˆ·æˆæƒç¬¬ä¸‰æ–¹ åº”ç”¨è®¿é—®ä»–ä»¬å­˜å‚¨åœ¨å¦å¤–çš„æœåŠ¡æä¾›è€…ä¸Šçš„ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å°†ç”¨æˆ·åå’Œå¯†ç æä¾›ç»™ç¬¬ä¸‰æ–¹ç§»åŠ¨åº”ç”¨æˆ–åˆ†äº«ä»– ä»¬æ•°æ®çš„æ‰€æœ‰å†…å®¹ã€‚OAuthåœ¨å…¨ä¸–ç•Œå¾—åˆ°å¹¿æ³›åº”ç”¨ï¼Œç›®å‰çš„ç‰ˆæœ¬æ˜¯2.0ç‰ˆã€‚ OAuthåè®®ï¼šhttps://...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/docs/assets/style-84ad0583.css" as="style"><link rel="stylesheet" href="/docs/assets/style-84ad0583.css">
    <link rel="modulepreload" href="/docs/assets/app-e6db4a12.js"><link rel="modulepreload" href="/docs/assets/framework-2afc6763.js"><link rel="modulepreload" href="/docs/assets/Spring Security æ•´åˆOAuth2.html-50cdd040.js"><link rel="modulepreload" href="/docs/assets/Spring Security æ•´åˆOAuth2.html-5c93594f.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/docs/" class="brand"><img class="logo" src="/docs/logo.png" alt="å­é¾™æŠ€æœ¯"><!----><span class="site-name hide-in-pad">å­é¾™æŠ€æœ¯</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/docs/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="nav-link" aria-label="å¹¶å‘ç¼–ç¨‹"><span class="font-icon icon info" style=""></span>å¹¶å‘ç¼–ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="nav-link" aria-label="ç½‘ç»œç¼–ç¨‹"><span class="font-icon icon info" style=""></span>ç½‘ç»œç¼–ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åˆ†å¸ƒå¼"><span class="title"><span class="font-icon icon info" style=""></span>åˆ†å¸ƒå¼</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80/" class="nav-link" aria-label="åˆ†å¸ƒå¼åŸºç¡€"><span class="font-icon icon creative" style=""></span>åˆ†å¸ƒå¼åŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/docs/zookeeper/" class="nav-link" aria-label="zookeeper"><span class="font-icon icon creative" style=""></span>zookeeper<!----></a></li><li class="dropdown-item"><a href="/docs/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" class="nav-link" aria-label="åˆ†å¸ƒå¼äº‹åŠ¡"><span class="font-icon icon creative" style=""></span>åˆ†å¸ƒå¼äº‹åŠ¡<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¾®æœåŠ¡"><span class="title"><span class="font-icon icon info" style=""></span>å¾®æœåŠ¡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/SpringBoot/" class="nav-link" aria-label="SpringBoot"><span class="font-icon icon creative" style=""></span>SpringBoot<!----></a></li><li class="dropdown-item"><a href="/docs/SpringCloudAlibaba/" class="nav-link active" aria-label="SpringCloudAlibaba"><span class="font-icon icon creative" style=""></span>SpringCloudAlibaba<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="nav-link" aria-label="è®¾è®¡æ¨¡å¼"><span class="font-icon icon info" style=""></span>è®¾è®¡æ¨¡å¼<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/Java/" class="nav-link" aria-label="Java"><span class="font-icon icon info" style=""></span>Java<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/JVM/" class="nav-link" aria-label="JVM"><span class="font-icon icon info" style=""></span>JVM<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="font-icon icon info" style=""></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/Redis/" class="nav-link" aria-label="Redis"><span class="font-icon icon info" style=""></span>Redis<!----></a></li><li class="dropdown-item"><a href="/docs/MySQL/" class="nav-link" aria-label="MySQL"><span class="font-icon icon info" style=""></span>MySQL<!----></a></li><li class="dropdown-item"><a href="/docs/Mongodb/" class="nav-link" aria-label="Mongodb"><span class="font-icon icon info" style=""></span>Mongodb<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/Mybatis/" class="nav-link" aria-label="Mybatis"><span class="font-icon icon info" style=""></span>Mybatis<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/Spring/" class="nav-link" aria-label="Spring"><span class="font-icon icon info" style=""></span>Spring<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¶ˆæ¯ä¸­é—´ä»¶"><span class="title"><span class="font-icon icon info" style=""></span>æ¶ˆæ¯ä¸­é—´ä»¶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/Kafka/" class="nav-link" aria-label="Kafka"><span class="font-icon icon creative" style=""></span>Kafka<!----></a></li><li class="dropdown-item"><a href="/docs/RocketMQ/" class="nav-link" aria-label="RocketMQ"><span class="font-icon icon creative" style=""></span>RocketMQ<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/%E9%AB%98%E5%B9%B6%E5%8F%91/" class="nav-link" aria-label="é«˜å¹¶å‘"><span class="font-icon icon info" style=""></span>é«˜å¹¶å‘<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E9%9D%A2%E8%AF%95/" class="nav-link" aria-label="é¢è¯•"><span class="font-icon icon info" style=""></span>é¢è¯•<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E5%B7%A5%E5%85%B7/" class="nav-link" aria-label="å·¥å…·"><span class="font-icon icon info" style=""></span>å·¥å…·<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/" class="nav-link" aria-label="å¼€æºé¡¹ç›®"><span class="font-icon icon info" style=""></span>å¼€æºé¡¹ç›®<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/docs/SpringCloudAlibaba/Spring%20Cloud%20%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95.html" class="nav-link sidebar-link sidebar-page" aria-label="å•ç‚¹ç™»å½•"><span class="font-icon icon discover" style=""></span>å•ç‚¹ç™»å½•<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/%E4%BB%80%E4%B9%88%E6%98%AFjwt%EF%BC%9F.html" class="nav-link sidebar-link sidebar-page" aria-label="ä»€ä¹ˆæ˜¯jwt"><span class="font-icon icon discover" style=""></span>ä»€ä¹ˆæ˜¯jwt<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/oauth%20%E6%95%B4%E5%90%88%20jwt.html" class="nav-link sidebar-link sidebar-page" aria-label="oauth æ•´åˆ jwt"><span class="font-icon icon discover" style=""></span>oauth æ•´åˆ jwt<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/openfeign%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E5%BC%82%E5%B8%B8%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="openfeignè¿œç¨‹è°ƒç”¨å¼‚å¸¸ç»Ÿä¸€å¤„ç†"><span class="font-icon icon discover" style=""></span>openfeignè¿œç¨‹è°ƒç”¨å¼‚å¸¸ç»Ÿä¸€å¤„ç†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/sentinel%20%E5%AE%9E%E6%88%98.html" class="nav-link sidebar-link sidebar-page" aria-label="sentinel å®æˆ˜"><span class="font-icon icon discover" style=""></span>sentinel å®æˆ˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/Spring%20Cloud%20%E5%85%A5%E9%97%A8%E7%AF%87.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Cloud å…¥é—¨ç¯‡"><span class="font-icon icon discover" style=""></span>Spring Cloud å…¥é—¨ç¯‡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/Spring%20Cloud%20Feign.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Cloud Feign"><span class="font-icon icon discover" style=""></span>Spring Cloud Feign<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/Spring%20Cloud%20Gateway.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Cloud Gateway"><span class="font-icon icon discover" style=""></span>Spring Cloud Gateway<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/Spring%20Cloud%20Nacos%20Config.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Cloud Nacos Config"><span class="font-icon icon discover" style=""></span>Spring Cloud Nacos Config<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/Spring%20Cloud%20Ribbon.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Cloud Ribbon"><span class="font-icon icon discover" style=""></span>Spring Cloud Ribbon<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Spring Security æ•´åˆOAuth2"><span class="font-icon icon discover" style=""></span>Spring Security æ•´åˆOAuth2<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#oauth2-0ä»‹ç»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="OAuth2.0ä»‹ç»"><!---->OAuth2.0ä»‹ç»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#spring-security" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Spring Security"><!---->Spring Security<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#spring-security-oauth2-0æ•´ä½“æ¶æ„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Spring Security + Oauth2.0æ•´ä½“æ¶æ„"><!---->Spring Security + Oauth2.0æ•´ä½“æ¶æ„<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#oauth2-0æ¨¡å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="OAuth2.0æ¨¡å¼"><!---->OAuth2.0æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#æ€»ç»“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ€»ç»“"><!---->æ€»ç»“<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/spring%20cloud%20%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.html" class="nav-link sidebar-link sidebar-page" aria-label="SpringCloud æ³¨å†Œä¸­å¿ƒ"><span class="font-icon icon discover" style=""></span>SpringCloud æ³¨å†Œä¸­å¿ƒ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/Nacos.html" class="nav-link sidebar-link sidebar-page" aria-label="SpringCloud Nacos"><span class="font-icon icon discover" style=""></span>SpringCloud Nacos<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/SpringCloudAlibaba/SpringCloud%E9%9B%86%E6%88%90%20%E6%8A%A5%E9%94%99%20An%20attempt%20was%20made%20to%20call%20a%20method%20that%20does%20not%20exist.html" class="nav-link sidebar-link sidebar-page" aria-label="SpringCloudé›†æˆ æŠ¥é”™ An attempt was made to call a method that does not exist"><span class="font-icon icon discover" style=""></span>SpringCloudé›†æˆ æŠ¥é”™ An attempt was made to call a method that does not exist<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="font-icon icon discover" style=""></span>Spring Security æ•´åˆOAuth2</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">ç¨‹åºå‘˜å­é¾™</span></span><span property="author" content="ç¨‹åºå‘˜å­é¾™"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-10T09:01:37.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 18 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT18M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category7" role>SpringCloud</span><meta property="articleSection" content="SpringCloud"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#oauth2-0ä»‹ç»" class="router-link-active router-link-exact-active toc-link level3">OAuth2.0ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#spring-security" class="router-link-active router-link-exact-active toc-link level3">Spring Security</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#spring-security-oauth2-0æ•´ä½“æ¶æ„" class="router-link-active router-link-exact-active toc-link level3">Spring Security + Oauth2.0æ•´ä½“æ¶æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#oauth2-0æ¨¡å¼" class="router-link-active router-link-exact-active toc-link level3">OAuth2.0æ¨¡å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/SpringCloudAlibaba/Spring%20Security%20%E6%95%B4%E5%90%88OAuth2.html#æ€»ç»“" class="router-link-active router-link-exact-active toc-link level3">æ€»ç»“</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h3 id="oauth2-0ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#oauth2-0ä»‹ç»" aria-hidden="true">#</a> <strong>OAuth2.0ä»‹ç»</strong></h3><p>OAuthï¼ˆOpen Authorizationï¼‰æ˜¯ä¸€ä¸ªå…³äºæˆæƒï¼ˆauthorizationï¼‰çš„å¼€æ”¾ç½‘ç»œæ ‡å‡†ï¼Œå…è®¸ç”¨æˆ·æˆæƒç¬¬ä¸‰æ–¹ åº”ç”¨è®¿é—®ä»–ä»¬å­˜å‚¨åœ¨å¦å¤–çš„æœåŠ¡æä¾›è€…ä¸Šçš„ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å°†ç”¨æˆ·åå’Œå¯†ç æä¾›ç»™ç¬¬ä¸‰æ–¹ç§»åŠ¨åº”ç”¨æˆ–åˆ†äº«ä»– ä»¬æ•°æ®çš„æ‰€æœ‰å†…å®¹ã€‚OAuthåœ¨å…¨ä¸–ç•Œå¾—åˆ°å¹¿æ³›åº”ç”¨ï¼Œç›®å‰çš„ç‰ˆæœ¬æ˜¯2.0ç‰ˆã€‚</p><p>OAuthåè®®ï¼šhttps://tools.ietf.org/html/rfc6749</p><p>åè®®ç‰¹ç‚¹ï¼š</p><ul><li>ç®€å•ï¼šä¸ç®¡æ˜¯OAuthæœåŠ¡æä¾›è€…è¿˜æ˜¯åº”ç”¨å¼€å‘è€…ï¼Œéƒ½å¾ˆæ˜“äºç†è§£ä¸ä½¿ç”¨ï¼›</li><li>å®‰å…¨ï¼šæ²¡æœ‰æ¶‰åŠåˆ°ç”¨æˆ·å¯†é’¥ç­‰ä¿¡æ¯ï¼Œæ›´å®‰å…¨æ›´çµæ´»ï¼›</li><li>å¼€æ”¾ï¼šä»»ä½•æœåŠ¡æä¾›å•†éƒ½å¯ä»¥å®ç°OAuthï¼Œä»»ä½•è½¯ä»¶å¼€å‘å•†éƒ½å¯ä»¥ä½¿ç”¨OAuthï¼›</li></ul><h4 id="åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯" aria-hidden="true">#</a> <strong>åº”ç”¨åœºæ™¯</strong></h4><ul><li><p>åŸç”Ÿappæˆæƒï¼šappç™»å½•è¯·æ±‚åå°æ¥å£ï¼Œä¸ºäº†å®‰å…¨è®¤è¯ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¸¦tokenä¿¡æ¯ï¼Œå¦‚æœç™»å½•éªŒè¯ã€ è¯·æ±‚åå°æ•°æ®ã€‚</p></li><li><p>å‰åç«¯åˆ†ç¦»å•é¡µé¢åº”ç”¨ï¼šå‰åç«¯åˆ†ç¦»æ¡†æ¶ï¼Œå‰ç«¯è¯·æ±‚åå°æ•°æ®ï¼Œéœ€è¦è¿›è¡Œoauth2å®‰å…¨è®¤è¯</p></li><li><p>ç¬¬ä¸‰æ–¹åº”ç”¨æˆæƒç™»å½•ï¼Œæ¯”å¦‚QQï¼Œå¾®åšï¼Œå¾®ä¿¡çš„æˆæƒç™»å½•ã€‚</p></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/15209061-6c7e5d5ef8c33c8a?imageMogr2/auto-orient/strip|imageView2/2/w/640/format/webp" alt=""></p><h4 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ" aria-hidden="true">#</a> åŸºæœ¬æ¦‚å¿µ</h4><ul><li><p><strong>Third-party application</strong>ï¼šç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼Œåˆç§°&quot;å®¢æˆ·ç«¯&quot;ï¼ˆclientï¼‰ï¼Œå³ä¾‹å­ä¸­çš„&quot;è±†ç“£&quot;ã€‚</p></li><li><p><strong>HTTP service</strong>ï¼šHTTPæœåŠ¡æä¾›å•†ï¼Œç®€ç§°&quot;æœåŠ¡æä¾›å•†&quot;ï¼Œå³ä¾‹å­ä¸­çš„qqã€‚</p></li><li><p><strong>Resource Owner</strong>ï¼šèµ„æºæ‰€æœ‰è€…ï¼Œåˆç§°&quot;ç”¨æˆ·&quot;ï¼ˆuserï¼‰ã€‚</p></li><li><p><strong>User Agent</strong>ï¼šç”¨æˆ·ä»£ç†ï¼Œæ¯”å¦‚æµè§ˆå™¨ã€‚</p></li><li><p><strong>Authorization server</strong>ï¼šæˆæƒæœåŠ¡å™¨ï¼Œå³æœåŠ¡æä¾›å•†ä¸“é—¨ç”¨æ¥å¤„ç†è®¤è¯æˆæƒçš„æœåŠ¡å™¨ã€‚</p></li><li><p><strong>Resource server</strong>ï¼šèµ„æºæœåŠ¡å™¨ï¼Œå³æœåŠ¡æä¾›å•†å­˜æ”¾ç”¨æˆ·ç”Ÿæˆçš„èµ„æºçš„æœåŠ¡å™¨ã€‚å®ƒä¸æˆæƒæœåŠ¡å™¨ï¼Œå¯ä»¥æ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„æœåŠ¡å™¨ã€‚</p></li></ul><p>OAuthçš„ä½œç”¨å°±æ˜¯è®©&quot;å®¢æˆ·ç«¯&quot;å®‰å…¨å¯æ§åœ°è·å–&quot;ç”¨æˆ·&quot;çš„æˆæƒï¼Œä¸&quot;æœåŠ¡æä¾›å•†&quot;è¿›è¡Œäº¤äº’ã€‚</p><h4 id="ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#ä¼˜ç¼ºç‚¹" aria-hidden="true">#</a> <strong>ä¼˜ç¼ºç‚¹</strong></h4><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ›´å®‰å…¨ï¼Œå®¢æˆ·ç«¯ä¸æ¥è§¦ç”¨æˆ·å¯†ç ï¼ŒæœåŠ¡å™¨ç«¯æ›´æ˜“é›†ä¸­ä¿æŠ¤</li><li>å¹¿æ³›ä¼ æ’­å¹¶è¢«æŒç»­é‡‡ç”¨</li><li>çŸ­å¯¿å‘½å’Œå°è£…çš„token</li><li>èµ„æºæœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨è§£è€¦</li><li>é›†ä¸­å¼æˆæƒï¼Œç®€åŒ–å®¢æˆ·ç«¯</li><li>HTTP/JSONå‹å¥½ï¼Œæ˜“äºè¯·æ±‚å’Œä¼ é€’token</li><li>è€ƒè™‘å¤šç§å®¢æˆ·ç«¯æ¶æ„åœºæ™¯</li><li>å®¢æˆ·å¯ä»¥å…·æœ‰ä¸åŒçš„ä¿¡ä»»çº§åˆ«</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>åè®®æ¡†æ¶å¤ªå®½æ³›ï¼Œé€ æˆå„ç§å®ç°çš„å…¼å®¹æ€§å’Œäº’æ“ä½œæ€§å·®</li><li>ä¸æ˜¯ä¸€ä¸ªè®¤è¯åè®®ï¼Œæœ¬èº«å¹¶ä¸èƒ½å‘Šè¯‰ä½ ä»»ä½•ç”¨æˆ·ä¿¡æ¯ã€‚</li></ul><h3 id="spring-security" tabindex="-1"><a class="header-anchor" href="#spring-security" aria-hidden="true">#</a> Spring Security</h3><p>Spring Securityæ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºåŸºäºSpringçš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆçš„<strong>å®‰å…¨æ¡†æ¶</strong>ã€‚Spring Security ä¸»è¦å®ç°äº†<strong>Authentication</strong>ï¼ˆè®¤è¯ï¼Œè§£å†³who are you? ï¼‰ å’Œ <strong>Access Control</strong>ï¼ˆè®¿é—®æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯what are you allowed to doï¼Ÿï¼Œä¹Ÿç§°ä¸º<strong>Authorization</strong>ï¼‰ã€‚Spring Securityåœ¨æ¶æ„ä¸Šå°†è®¤è¯ä¸æˆæƒåˆ†ç¦»ï¼Œå¹¶æä¾›äº†æ‰©å±•ç‚¹ã€‚</p><p><strong>è®¤è¯ï¼ˆAuthenticationï¼‰</strong> ï¼šç”¨æˆ·è®¤è¯å°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·çš„èº«ä»½æ˜¯å¦åˆæ³•çš„è¿‡ç¨‹ï¼Œç”¨æˆ·å»è®¿é—®ç³»ç»Ÿèµ„æºæ—¶ç³»ç»Ÿè¦æ±‚éªŒè¯ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œèº«ä»½åˆæ³•æ–¹å¯ç»§ç»­è®¿é—®ï¼Œä¸åˆæ³•åˆ™æ‹’ç»è®¿é—®ã€‚å¸¸è§çš„ç”¨æˆ·èº«ä»½è®¤è¯æ–¹å¼æœ‰ï¼šç”¨æˆ·åå¯†ç ç™»å½•ï¼ŒäºŒç»´ç ç™»å½•ï¼Œæ‰‹æœºçŸ­ä¿¡ç™»å½•ï¼ŒæŒ‡çº¹è®¤è¯ç­‰æ–¹å¼ã€‚</p><p><strong>æˆæƒï¼ˆAuthorizationï¼‰</strong>ï¼š æˆæƒæ˜¯ç”¨æˆ·è®¤è¯é€šè¿‡æ ¹æ®ç”¨æˆ·çš„æƒé™æ¥æ§åˆ¶ç”¨æˆ·è®¿é—®èµ„æºçš„è¿‡ç¨‹ï¼Œæ‹¥æœ‰èµ„æºçš„è®¿é—®æƒé™åˆ™æ­£å¸¸è®¿é—®ï¼Œæ²¡æœ‰æƒé™åˆ™æ‹’ç»è®¿é—®ã€‚</p><p>å°†OAuth2å’ŒSpring Securityé›†æˆï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€å¥—å®Œæ•´çš„å®‰å…¨è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Spring Security OAuth2æ„å»ºä¸€ä¸ªæˆæƒæœåŠ¡å™¨æ¥éªŒè¯ç”¨æˆ·èº«ä»½ä»¥æä¾›access_tokenï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªaccess_tokenæ¥ä»èµ„æºæœåŠ¡å™¨è¯·æ±‚æ•°æ®ã€‚</p><h3 id="spring-security-oauth2-0æ•´ä½“æ¶æ„" tabindex="-1"><a class="header-anchor" href="#spring-security-oauth2-0æ•´ä½“æ¶æ„" aria-hidden="true">#</a> Spring Security + Oauth2.0<strong>æ•´ä½“æ¶æ„</strong></h3><p><img src="https://note.youdao.com/yws/public/resource/eaab054e79f362d02340114569806d3a/xmlnote/E75EE15C7D3640D190B9A767423F7748/19014" alt="https://note.youdao.com/yws/public/resource/eaab054e79f362d02340114569806d3a/xmlnote/E75EE15C7D3640D190B9A767423F7748/19014"></p><ul><li>Authorize Endpoint ï¼šæˆæƒç«¯ç‚¹ï¼Œè¿›è¡Œæˆæƒ</li><li>Token Endpoint ï¼šä»¤ç‰Œç«¯ç‚¹ï¼Œç»è¿‡æˆæƒæ‹¿åˆ°å¯¹åº”çš„Token</li><li>Introspection Endpoint ï¼šæ ¡éªŒç«¯ç‚¹ï¼Œæ ¡éªŒTokençš„åˆæ³•æ€§</li><li>Revocation Endpoint ï¼šæ’¤é”€ç«¯ç‚¹ï¼Œæ’¤é”€æˆæƒ</li></ul><p><img src="https://note.youdao.com/yws/public/resource/eaab054e79f362d02340114569806d3a/xmlnote/890BA4CD0763456EB649582314FE6689/19008" alt="https://note.youdao.com/yws/public/resource/eaab054e79f362d02340114569806d3a/xmlnote/890BA4CD0763456EB649582314FE6689/19008"></p><ol><li>ç”¨æˆ·è®¿é—®,æ­¤æ—¶æ²¡æœ‰Tokenã€‚Oauth2RestTemplateä¼šæŠ¥é”™ï¼Œè¿™ä¸ªæŠ¥é”™ä¿¡æ¯ä¼šè¢«Oauth2ClientContextFilteræ•è·å¹¶é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨ã€‚</li><li>æˆæƒæœåŠ¡å™¨é€šè¿‡Authorization Endpointè¿›è¡Œæˆæƒï¼Œå¹¶é€šè¿‡AuthorizationServerTokenServicesç”Ÿæˆæˆæƒç å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯æ‹¿åˆ°æˆæƒç å»æˆæƒæœåŠ¡å™¨é€šè¿‡Token Endpointè°ƒç”¨AuthorizationServerTokenServicesç”ŸæˆTokenå¹¶è¿”å›ç»™å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯æ‹¿åˆ°Tokenå»èµ„æºæœåŠ¡å™¨è®¿é—®èµ„æºï¼Œä¸€èˆ¬ä¼šé€šè¿‡Oauth2AuthenticationManagerè°ƒç”¨ResourceServerTokenServicesè¿›è¡Œæ ¡éªŒã€‚æ ¡éªŒé€šè¿‡å¯ä»¥è·å–èµ„æºã€‚</li></ol><h3 id="oauth2-0æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#oauth2-0æ¨¡å¼" aria-hidden="true">#</a> OAuth2.0æ¨¡å¼</h3><h4 id="è¿è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œæµç¨‹" aria-hidden="true">#</a> è¿è¡Œæµç¨‹</h4><p>OAuth 2.0çš„è¿è¡Œæµç¨‹å¦‚ä¸‹å›¾ï¼Œæ‘˜è‡ªRFC 6749ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/15209061-98feec3dbfd354bf.png?imageMogr2/auto-orient/strip|imageView2/2/w/766/format/webp" alt=""></p><p>ï¼ˆAï¼‰ç”¨æˆ·æ‰“å¼€å®¢æˆ·ç«¯ä»¥åï¼Œå®¢æˆ·ç«¯è¦æ±‚ç”¨æˆ·ç»™äºˆæˆæƒã€‚ ï¼ˆBï¼‰ç”¨æˆ·åŒæ„ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚ ï¼ˆCï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ä¸Šä¸€æ­¥è·å¾—çš„æˆæƒï¼Œå‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚ ï¼ˆDï¼‰è®¤è¯æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯ä»¥åï¼Œç¡®è®¤æ— è¯¯ï¼ŒåŒæ„å‘æ”¾ä»¤ç‰Œã€‚ ï¼ˆEï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ä»¤ç‰Œï¼Œå‘èµ„æºæœåŠ¡å™¨ç”³è¯·è·å–èµ„æºã€‚ ï¼ˆFï¼‰èµ„æºæœåŠ¡å™¨ç¡®è®¤ä»¤ç‰Œæ— è¯¯ï¼ŒåŒæ„å‘å®¢æˆ·ç«¯å¼€æ”¾èµ„æºã€‚</p><p>å¼•å…¥ä¾èµ–</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;
&lt;/dependency&gt;    


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æˆæƒæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#æˆæƒæ¨¡å¼" aria-hidden="true">#</a> æˆæƒæ¨¡å¼</h4><p>å®¢æˆ·ç«¯å¿…é¡»å¾—åˆ°ç”¨æˆ·çš„æˆæƒï¼ˆauthorization grantï¼‰ï¼Œæ‰èƒ½è·å¾—ä»¤ç‰Œï¼ˆaccess tokenï¼‰ã€‚OAuth 2.0ä¸€å…±åˆ†æˆå››ç§æˆæƒç±»å‹ï¼ˆauthorization grantï¼‰</p><ul><li>æˆæƒç æ¨¡å¼ï¼ˆauthorization codeï¼‰</li><li>ç®€åŒ–æ¨¡å¼ï¼ˆimplicitï¼‰</li><li>å¯†ç æ¨¡å¼ï¼ˆresource owner password credentialsï¼‰</li><li>å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆclient credentialsï¼‰</li></ul><p>æˆæƒç æ¨¡å¼å’Œå¯†ç æ¨¡å¼æ¯”è¾ƒå¸¸ç”¨ã€‚</p><p>ç¬¬ä¸‰æ–¹åº”ç”¨ç”³è¯·ä»¤ç‰Œä¹‹å‰ï¼Œéƒ½å¿…é¡»å…ˆåˆ°ç³»ç»Ÿå¤‡æ¡ˆï¼Œè¯´æ˜è‡ªå·±çš„èº«ä»½ï¼Œç„¶åä¼šæ‹¿åˆ°ä¸¤ä¸ªèº«ä»½è¯†åˆ«ç ï¼šå®¢æˆ·ç«¯ IDï¼ˆclient IDï¼‰å’Œå®¢æˆ·ç«¯å¯†é’¥ï¼ˆclient secretï¼‰ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ä»¤ç‰Œè¢«æ»¥ç”¨ï¼Œæ²¡æœ‰å¤‡æ¡ˆè¿‡çš„ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæ˜¯ä¸ä¼šæ‹¿åˆ°ä»¤ç‰Œçš„ã€‚</p><h5 id="æˆæƒç æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#æˆæƒç æ¨¡å¼" aria-hidden="true">#</a> <strong>æˆæƒç æ¨¡å¼</strong></h5><p><strong>æˆæƒç ï¼ˆauthorization codeï¼‰æ–¹å¼ï¼ŒæŒ‡çš„æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨å…ˆç”³è¯·ä¸€ä¸ªæˆæƒç ï¼Œç„¶åå†ç”¨è¯¥ç è·å–ä»¤ç‰Œã€‚</strong></p><p>è¿™ç§æ–¹å¼æ˜¯æœ€å¸¸ç”¨çš„æµç¨‹ï¼Œå®‰å…¨æ€§ä¹Ÿæœ€é«˜ï¼Œå®ƒé€‚ç”¨äºé‚£äº›æœ‰åç«¯çš„ Web åº”ç”¨ã€‚æˆæƒç é€šè¿‡å‰ç«¯ä¼ é€ï¼Œä»¤ç‰Œåˆ™æ˜¯å‚¨å­˜åœ¨åç«¯ï¼Œè€Œä¸”æ‰€æœ‰ä¸èµ„æºæœåŠ¡å™¨çš„é€šä¿¡éƒ½åœ¨åç«¯å®Œæˆã€‚è¿™æ ·çš„å‰åç«¯åˆ†ç¦»ï¼Œå¯ä»¥é¿å…ä»¤ç‰Œæ³„æ¼ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šç›®å‰ä¸»æµçš„ç¬¬ä¸‰æ–¹éªŒè¯éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ¨¡å¼</p><p>â€‹ <img src="https://note.youdao.com/yws/public/resource/eaab054e79f362d02340114569806d3a/xmlnote/28927E9C24844765935717F4C491EE2A/18873" alt="0"></p><p>ä¸»è¦æµç¨‹ï¼š</p><p>ï¼ˆAï¼‰ç”¨æˆ·è®¿é—®å®¢æˆ·ç«¯ï¼Œåè€…å°†å‰è€…å¯¼å‘æˆæƒæœåŠ¡å™¨ã€‚</p><p>ï¼ˆBï¼‰ç”¨æˆ·é€‰æ‹©æ˜¯å¦ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚</p><p>ï¼ˆCï¼‰ç”¨æˆ·ç»™äºˆæˆæƒï¼ŒæˆæƒæœåŠ¡å™¨å°†ç”¨æˆ·å¯¼å‘å®¢æˆ·ç«¯äº‹å…ˆæŒ‡å®šçš„&quot;é‡å®šå‘URI&quot;ï¼ˆredirection URIï¼‰ï¼ŒåŒæ—¶é™„ä¸Šä¸€ä¸ªæˆæƒç ã€‚</p><p>ï¼ˆDï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æˆæƒç ï¼Œé™„ä¸Šæ—©å…ˆçš„&quot;é‡å®šå‘URI&quot;ï¼Œå‘æˆæƒæœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚è¿™ä¸€æ­¥æ˜¯åœ¨å®¢æˆ·ç«¯çš„åå°çš„æœåŠ¡å™¨ä¸Šå®Œæˆçš„ï¼Œå¯¹ç”¨æˆ·ä¸å¯è§ã€‚</p><p>ï¼ˆEï¼‰æˆæƒæœåŠ¡å™¨æ ¸å¯¹äº†æˆæƒç å’Œé‡å®šå‘URIï¼Œç¡®è®¤æ— è¯¯åï¼Œå‘å®¢æˆ·ç«¯å‘é€è®¿é—®ä»¤ç‰Œï¼ˆaccess tokenï¼‰å’Œæ›´æ–°ä»¤ç‰Œï¼ˆrefresh tokenï¼‰ã€‚</p><p>â€‹</p><h6 id="é…ç½®æˆæƒæœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#é…ç½®æˆæƒæœåŠ¡å™¨" aria-hidden="true">#</a> <strong>é…ç½®æˆæƒæœåŠ¡å™¨</strong></h6><p>æ³¨æ„ï¼šå®é™…é¡¹ç›®ä¸­clinet_id å’Œclient_secret æ˜¯é…ç½®åœ¨æ•°æ®åº“ä¸­ï¼Œçœç•¥spring securityç›¸å…³é…ç½®ï¼Œå¯ä»¥å‚è€ƒ</p><div class="language-Java line-numbers-mode" data-ext="Java"><pre class="language-Java"><code>@Configuration
@EnableAuthorizationServer
public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Autowired
    private TokenStore tokenStore;
    
    @Override
    public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {
        endpoints
                .tokenStore(tokenStore)  //æŒ‡å®štokenå­˜å‚¨åˆ°redis
                .allowedTokenEndpointRequestMethods(HttpMethod.GET,HttpMethod.POST); //æ”¯æŒGET,POSTè¯·æ±‚

    @Override
    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {

        // åŸºäºå†…å­˜æ¨¡å¼ï¼Œè¿™é‡Œåªæ˜¯æ¼”ç¤ºï¼Œå®é™…ç”Ÿäº§ä¸­åº”è¯¥åŸºäºæ•°æ®åº“
        clients.inMemory()
                //é…ç½®client_id
                .withClient(&quot;client&quot;)
                //é…ç½®client_secret
                .secret(passwordEncoder.encode(&quot;123123&quot;))
                //é…ç½®è®¿é—®tokençš„æœ‰æ•ˆæœŸ
                .accessTokenValiditySeconds(3600)
                //é…ç½®åˆ·æ–°tokençš„æœ‰æ•ˆæœŸ
                .refreshTokenValiditySeconds(864000)
                //é…ç½®redirect_uriï¼Œç”¨äºæˆæƒæˆåŠŸåè·³è½¬
                .redirectUris(&quot;http://www.baidu.com&quot;)
                //é…ç½®ç”³è¯·çš„æƒé™èŒƒå›´
                .scopes(&quot;all&quot;)
                //é…ç½®grant_typeï¼Œè¡¨ç¤ºæˆæƒç±»å‹  authorization_code: æˆæƒç 
                .authorizedGrantTypes(&quot;authorization_code&quot;);


    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œå’Œæˆæƒç éƒ½æ˜¯å­˜å‚¨åœ¨äº†å†…å­˜ä¸­ï¼Œä¸€æ—¦è®¤è¯æœåŠ¡å®•æœºï¼Œé‚£å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ä¹Ÿéšä¹‹æ¶ˆå¤±ï¼Œè€Œä¸”å®¢æˆ·ç«¯ä¿¡æ¯æ˜¯åœ¨ç¨‹åºä¸­å†™æ­»çš„ï¼Œç»´æŠ¤èµ·æ¥åŠä¸æ–¹ä¾¿ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦é‡å¯æœåŠ¡ï¼Œå¦‚æœå‘ä¸Šè¿°ä¿¡æ¯éƒ½å­˜äºæ•°æ®åº“ä¸­ä¾¿å¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œå…¶ä¸­æ•°æ®æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å­˜åˆ°<code>noSql</code>æˆ–å…¶ä»–æ•°æ®åº“ä¸­ã€‚</p><p><strong>æ•°æ®åº“å­˜å‚¨æ¨¡å¼</strong></p><p>é¦–å…ˆåœ¨æ•°æ®åº“ä¸­æ–°å»ºå­˜å‚¨å®¢æˆ·ç«¯ä¿¡æ¯ï¼ŒåŠæˆæƒç çš„è¡¨ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>#å®¢æˆ·ç«¯ä¿¡æ¯
CREATE TABLE `oauth_client_details`  (
  `client_id` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  `resource_ids` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `client_secret` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `scope` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `authorized_grant_types` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `web_server_redirect_uri` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `authorities` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `access_token_validity` int(11) NULL DEFAULT NULL,
  `refresh_token_validity` int(11) NULL DEFAULT NULL,
  `additional_information` varchar(4096) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `autoapprove` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  PRIMARY KEY (`client_id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of oauth_client_details
-- ----------------------------
INSERT INTO `oauth_client_details` VALUES (&#39;client&#39;, NULL, &#39;$2a$10$CE1GKj9eBZsNNMCZV2hpo.QBOz93ojy9mTd9YQaOy8H4JAyYKVlm6&#39;, &#39;all&#39;, &#39;authorization_code,password,refresh_token,client_credentials,implicit&#39;, &#39;http://www.baidu.com&#39;, NULL, 3600, 864000, NULL, NULL);

#æˆæƒç 
CREATE TABLE `oauth_code`  (
  `code` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  `authentication` blob NULL
) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼•å…¥ä¾èµ–</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;3.3.2&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;druid&lt;/artifactId&gt;
    &lt;version&gt;1.1.6&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æˆæƒæœåŠ¡å™¨
 *
 * æˆæƒç æ¨¡å¼åŸºäºæ•°æ®åº“
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAuthorizationServer</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthorizationServerConfig1</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizationServerConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TokenStore</span> tokenStore<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthorizationCodeServices</span> authorizationCodeServices<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;jdbcClientDetailsService&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">ClientDetailsService</span> clientDetailsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;jdbcClientDetailsService&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ClientDetailsService</span> <span class="token function">clientDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JdbcClientDetailsService</span> clientDetailsService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcClientDetailsService</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        clientDetailsService<span class="token punctuation">.</span><span class="token function">setPasswordEncoder</span><span class="token punctuation">(</span>passwordEncoder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> clientDetailsService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//è®¾ç½®æˆæƒç æ¨¡å¼çš„æˆæƒç å¦‚ä½•å­˜å–</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthorizationCodeServices</span> <span class="token function">authorizationCodeServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcAuthorizationCodeServices</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>




    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationServerEndpointsConfigurer</span> endpoints<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        endpoints
                <span class="token punctuation">.</span><span class="token function">tokenStore</span><span class="token punctuation">(</span>tokenStore<span class="token punctuation">)</span>  <span class="token comment">//æŒ‡å®štokenå­˜å‚¨åˆ°redis</span>
                <span class="token punctuation">.</span><span class="token function">authorizationCodeServices</span><span class="token punctuation">(</span>authorizationCodeServices<span class="token punctuation">)</span><span class="token comment">//æˆæƒç æœåŠ¡</span>
                <span class="token punctuation">.</span><span class="token function">allowedTokenEndpointRequestMethods</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ”¯æŒGET,POSTè¯·æ±‚</span>


    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationServerSecurityConfigurer</span> security<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//å…è®¸è¡¨å•è®¤è¯</span>
        security
                <span class="token punctuation">.</span><span class="token function">tokenKeyAccess</span><span class="token punctuation">(</span><span class="token string">&quot;permitAll()&quot;</span><span class="token punctuation">)</span>                    <span class="token comment">//oauth/token_keyæ˜¯å…¬å¼€</span>
                <span class="token punctuation">.</span><span class="token function">checkTokenAccess</span><span class="token punctuation">(</span><span class="token string">&quot;permitAll()&quot;</span><span class="token punctuation">)</span>                  <span class="token comment">//oauth/check_tokenå…¬å¼€</span>
                <span class="token punctuation">.</span><span class="token function">allowFormAuthenticationForClients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">ClientDetailsServiceConfigurer</span> clients<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆæƒç æ¨¡å¼</span>
        <span class="token comment">//http://localhost:8080/oauth/authorize?response_type=code&amp;client_id=client&amp;redirect_uri=http://www.baidu.com&amp;scope=all</span>
        <span class="token comment">// ç®€åŒ–æ¨¡å¼</span>
<span class="token comment">//        http://localhost:8080/oauth/authorize?response_type=token&amp;client_id=client&amp;redirect_uri=http://www.baidu.com&amp;scope=all</span>

        clients<span class="token punctuation">.</span><span class="token function">withClientDetails</span><span class="token punctuation">(</span>clientDetailsService<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="é…ç½®èµ„æºæœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#é…ç½®èµ„æºæœåŠ¡å™¨" aria-hidden="true">#</a> <strong>é…ç½®èµ„æºæœåŠ¡å™¨</strong></h6><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableResourceServer</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResourceServiceConfig</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceServerConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="é…ç½®-spring-security" tabindex="-1"><a class="header-anchor" href="#é…ç½®-spring-security" aria-hidden="true">#</a> é…ç½® spring security</h6><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/oauth/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>password<span class="token punctuation">,</span> <span class="token class-name">AuthorityUtils</span><span class="token punctuation">.</span><span class="token function">commaSeparatedStringToAuthorityList</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1ã€Aç½‘ç«™ï¼ˆå®¢æˆ·ç«¯ï¼‰æä¾›ä¸€ä¸ªé“¾æ¥ï¼Œç”¨æˆ·ç‚¹å‡»åå°±ä¼šè·³è½¬åˆ° B ï¼ˆæˆæƒæœåŠ¡å™¨ï¼‰ç½‘ç«™ï¼Œæˆæƒç”¨æˆ·æ•°æ®ç»™ A ç½‘ç«™ä½¿ç”¨ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token number">127.0</span>.0.1:9999/oauth/authorize?   
 <span class="token assign-left variable">response_type</span><span class="token operator">=</span>code<span class="token operator">&amp;</span>            <span class="token comment"># è¡¨ç¤ºæˆæƒç±»å‹ï¼Œå¿…é€‰é¡¹ï¼Œæ­¤å¤„çš„å€¼å›ºå®šä¸º&quot;code&quot;</span>
 <span class="token assign-left variable">client_id</span><span class="token operator">=</span>CLIENT_ID<span class="token operator">&amp;</span>           <span class="token comment"># è¡¨ç¤ºå®¢æˆ·ç«¯çš„IDï¼Œå¿…é€‰é¡¹</span>
 <span class="token assign-left variable">redirect_uri</span><span class="token operator">=</span>CALLBACK_URL<span class="token operator">&amp;</span>     <span class="token comment"># redirect_uriï¼šè¡¨ç¤ºé‡å®šå‘URIï¼Œå¯é€‰é¡¹</span>
 <span class="token assign-left variable">scope</span><span class="token operator">=</span>read					    <span class="token comment"># è¡¨ç¤ºç”³è¯·çš„æƒé™èŒƒå›´ï¼Œå¯é€‰é¡¹ readåªè¯»  </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>http://localhost:8080/oauth/authorize?response_type=code&amp;client_id=client&amp;redirect_uri=http://www.baidu.com&amp;scope=all</p><p>2ã€ç”¨æˆ·è·³è½¬åï¼ŒB ç½‘ç«™ä¼šè¦æ±‚ç”¨æˆ·ç™»å½•ï¼Œç„¶åè¯¢é—®æ˜¯å¦åŒæ„ç»™äºˆ A ç½‘ç«™æˆæƒã€‚ç”¨æˆ·è¡¨ç¤ºåŒæ„ï¼Œè¿™æ—¶ B ç½‘ç«™å°±ä¼šè·³å›redirect_uriå‚æ•°æŒ‡å®šçš„ç½‘å€ã€‚è·³è½¬æ—¶ï¼Œä¼šä¼ å›ä¸€ä¸ªæˆæƒç </p><p>ç™»å½•ï¼š</p><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041653244.png" alt=""></p><p>æˆæƒï¼š</p><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041512818.png" alt=""></p><p>é€‰æ‹© authorize ï¼Œè·å–æˆæƒç ï¼Œæµè§ˆå™¨è¿”å›ï¼šhttps://www.baidu.com/?code=PVpEEw</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://a.com/callback?code=AUTHORIZATION_CODE    #codeå‚æ•°å°±æ˜¯æˆæƒç                    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœä½¿ç”¨æ•°æ®åº“æ¨¡å¼ï¼š</p><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041656285.png" alt=""></p><p>3ã€A ç½‘ç«™æ‹¿åˆ°æˆæƒç ä»¥åï¼Œå°±å¯ä»¥åœ¨åç«¯ï¼Œå‘ B ç½‘ç«™è¯·æ±‚ä»¤ç‰Œã€‚ ç”¨æˆ·ä¸å¯è§ï¼ŒæœåŠ¡ç«¯è¡Œä¸º</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:8080/oauth/token? 
client_id=CLIENT_ID&amp; 
client_secret=CLIENT_SECRET&amp;     # client_idå’Œclient_secretç”¨æ¥è®© B ç¡®è®¤ A çš„èº«ä»½,client_secretå‚æ•°æ˜¯ä¿å¯†çš„ï¼Œå› æ­¤åªèƒ½åœ¨åç«¯å‘è¯·æ±‚ 
grant_type=authorization_code&amp;   # é‡‡ç”¨çš„æˆæƒæ–¹å¼æ˜¯æˆæƒç 
code=AUTHORIZATION_CODE&amp;         # ä¸Šä¸€æ­¥æ‹¿åˆ°çš„æˆæƒç  
redirect_uri=CALLBACK_URL		 # ä»¤ç‰Œé¢å‘åçš„å›è°ƒç½‘å€         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€B ç½‘ç«™æ”¶åˆ°è¯·æ±‚ä»¥åï¼Œå°±ä¼šé¢å‘ä»¤ç‰Œã€‚å…·ä½“åšæ³•æ˜¯å‘redirect_uriæŒ‡å®šçš„ç½‘å€ï¼Œè¿”å›æ•°æ®ã€‚</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code> <span class="token punctuation">{</span>    
   <span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span><span class="token string">&quot;ACCESS_TOKEN&quot;</span><span class="token punctuation">,</span>     # ä»¤ç‰Œ
   <span class="token property">&quot;token_type&quot;</span><span class="token operator">:</span><span class="token string">&quot;bearer&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;expires_in&quot;</span><span class="token operator">:</span><span class="token number">2592000</span><span class="token punctuation">,</span>
   <span class="token property">&quot;refresh_token&quot;</span><span class="token operator">:</span><span class="token string">&quot;REFRESH_TOKEN&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;uid&quot;</span><span class="token operator">:</span><span class="token number">100101</span><span class="token punctuation">,</span>
   <span class="token property">&quot;info&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>...<span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041525228.png" alt=""></p><p>æ­¤æ—¶redisä¸­ä¼šå­˜å‚¨token</p><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041708764.png" alt=""></p><h5 id="å¯†ç æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å¯†ç æ¨¡å¼" aria-hidden="true">#</a> <strong>å¯†ç æ¨¡å¼</strong></h5><p>å¦‚æœä½ é«˜åº¦ä¿¡ä»»æŸä¸ªåº”ç”¨ï¼ŒRFC 6749 ä¹Ÿå…è®¸ç”¨æˆ·æŠŠç”¨æˆ·åå’Œå¯†ç ï¼Œç›´æ¥å‘Šè¯‰è¯¥åº”ç”¨ã€‚è¯¥åº”ç”¨å°±ä½¿ç”¨ä½ çš„å¯†ç ï¼Œç”³è¯·ä»¤ç‰Œï¼Œè¿™ç§æ–¹å¼ç§°ä¸º&quot;å¯†ç å¼&quot;ï¼ˆpasswordï¼‰ã€‚</p><p>åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œç”¨æˆ·å¿…é¡»æŠŠè‡ªå·±çš„å¯†ç ç»™å®¢æˆ·ç«¯ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸å¾—å‚¨å­˜å¯†ç ã€‚è¿™é€šå¸¸ç”¨åœ¨ç”¨æˆ·å¯¹å®¢æˆ·ç«¯é«˜åº¦ä¿¡ä»»çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…ç”±ä¸€ä¸ªè‘—åå…¬å¸å‡ºå“ã€‚è€ŒæˆæƒæœåŠ¡å™¨åªæœ‰åœ¨å…¶ä»–æˆæƒæ¨¡å¼æ— æ³•æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½è€ƒè™‘ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šå…¬å¸æ­å»ºçš„æˆæƒæœåŠ¡å™¨</p><p><img src="https://upload-images.jianshu.io/upload_images/15209061-38d92855ebb979d1.png?imageMogr2/auto-orient/strip|imageView2/2/w/799/format/webp" alt=""></p><p>ï¼ˆAï¼‰ç”¨æˆ·å‘å®¢æˆ·ç«¯æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p>ï¼ˆBï¼‰å®¢æˆ·ç«¯å°†ç”¨æˆ·åå’Œå¯†ç å‘ç»™æˆæƒæœåŠ¡å™¨ï¼Œå‘åè€…è¯·æ±‚ä»¤ç‰Œã€‚</p><p>ï¼ˆCï¼‰æˆæƒæœåŠ¡å™¨ç¡®è®¤æ— è¯¯åï¼Œå‘å®¢æˆ·ç«¯æä¾›è®¿é—®ä»¤ç‰Œã€‚</p><h6 id="é…ç½®-spring-security-1" tabindex="-1"><a class="header-anchor" href="#é…ç½®-spring-security-1" aria-hidden="true">#</a> é…ç½® spring security</h6><p>å¢åŠ AuthenticationManager</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–ç”¨æˆ·ä¿¡æ¯</span>
        auth<span class="token punctuation">.</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span>userService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/oauth/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// oauth2 å¯†ç æ¨¡å¼éœ€è¦æ‹¿åˆ°è¿™ä¸ªbean</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Lazy</span>
    <span class="token keyword">private</span> <span class="token class-name">PasswordEncoder</span> passwordEncoder<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span>password<span class="token punctuation">,</span> <span class="token class-name">AuthorityUtils</span><span class="token punctuation">.</span><span class="token function">commaSeparatedStringToAuthorityList</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TokenStore</span> <span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisTokenStore</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="é…ç½®æˆæƒæœåŠ¡å™¨-1" tabindex="-1"><a class="header-anchor" href="#é…ç½®æˆæƒæœåŠ¡å™¨-1" aria-hidden="true">#</a> é…ç½®æˆæƒæœåŠ¡å™¨</h6><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@Configuration
@EnableAuthorizationServer
public class AuthorizationServerConfig2 extends AuthorizationServerConfigurerAdapter {

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Autowired
    private AuthenticationManager authenticationManagerBean;

    @Autowired
    private UserService userService;

    @Autowired
    private TokenStore tokenStore;


    @Override
    public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {
        endpoints.authenticationManager(authenticationManagerBean) //ä½¿ç”¨å¯†ç æ¨¡å¼éœ€è¦é…ç½®
                .tokenStore(tokenStore)  //æŒ‡å®štokenå­˜å‚¨åˆ°redis
                .reuseRefreshTokens(false)  //refresh_tokenæ˜¯å¦é‡å¤ä½¿ç”¨
                .userDetailsService(userService) //åˆ·æ–°ä»¤ç‰ŒæˆæƒåŒ…å«å¯¹ç”¨æˆ·ä¿¡æ¯çš„æ£€æŸ¥
                .allowedTokenEndpointRequestMethods(HttpMethod.GET,HttpMethod.POST); //æ”¯æŒGET,POSTè¯·æ±‚
    }

    @Override
    public void configure(AuthorizationServerSecurityConfigurer security) throws Exception {
        //å…è®¸è¡¨å•è®¤è¯
        security.allowFormAuthenticationForClients();
    }

    @Override
    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {

        clients.inMemory()
                //é…ç½®client_id
                .withClient(&quot;client&quot;)
                //é…ç½®client-secret
                .secret(passwordEncoder.encode(&quot;123123&quot;))
                //é…ç½®è®¿é—®tokençš„æœ‰æ•ˆæœŸ
                .accessTokenValiditySeconds(3600)
                //é…ç½®åˆ·æ–°tokençš„æœ‰æ•ˆæœŸ
                .refreshTokenValiditySeconds(864000)
                //é…ç½®redirect_uriï¼Œç”¨äºæˆæƒæˆåŠŸåè·³è½¬
                .redirectUris(&quot;http://www.baidu.com&quot;)
                //é…ç½®ç”³è¯·çš„æƒé™èŒƒå›´
                .scopes(&quot;all&quot;)
                /**
                 * é…ç½®grant_typeï¼Œè¡¨ç¤ºæˆæƒç±»å‹
                 * authorization_code: æˆæƒç æ¨¡å¼
                 * implicit: ç®€åŒ–æ¨¡å¼
                 * passwordï¼š å¯†ç æ¨¡å¼
                 * client_credentials: å®¢æˆ·ç«¯æ¨¡å¼
                 * refresh_token: æ›´æ–°ä»¤ç‰Œ
                 */
                .authorizedGrantTypes(&quot;authorization_code&quot;,&quot;implicit&quot;,&quot;password&quot;,&quot;client_credentials&quot;,&quot;refresh_token&quot;);
    }


}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚éœ€æ”¯æŒæ•°æ®åº“æ¨¡å¼ï¼Œåªéœ€è¦æŠŠæˆæƒæœåŠ¡å™¨åœ¨æˆæƒç æ¨¡å¼çš„åŸºç¡€ä¸Šå¢åŠ AuthenticationManagerï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//AuthorizationServerConfig1
@Autowired
private AuthenticationManager authenticationManagerBean;

@Override
public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {
    endpoints.authenticationManager(authenticationManagerBean) //ä½¿ç”¨å¯†ç æ¨¡å¼éœ€è¦é…ç½®
    .tokenStore(tokenStore)  //æŒ‡å®štokenå­˜å‚¨åˆ°redis
    .authorizationCodeServices(authorizationCodeServices)//æˆæƒç æœåŠ¡
    .allowedTokenEndpointRequestMethods(HttpMethod.GET,HttpMethod.POST); //æ”¯æŒGET,POSTè¯·æ±‚


}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è·å–tokenï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://oauth.b.com/oauth/token?
  grant_type=password&amp;       # æˆæƒæ–¹å¼æ˜¯&quot;å¯†ç å¼&quot;
  username=USERNAME&amp;
  password=PASSWORD&amp;
  client_id=CLIENT_ID&amp;
  client_secret=123123&amp;
  scope=all

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041738615.png" alt=""></p><h5 id="å®¢æˆ·ç«¯æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å®¢æˆ·ç«¯æ¨¡å¼" aria-hidden="true">#</a> <strong>å®¢æˆ·ç«¯æ¨¡å¼</strong></h5><p>å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆClient Credentials Grantï¼‰æŒ‡å®¢æˆ·ç«¯ä»¥è‡ªå·±çš„åä¹‰ï¼Œè€Œä¸æ˜¯ä»¥ç”¨æˆ·çš„åä¹‰ï¼Œå‘&quot;æœåŠ¡æä¾›å•†&quot;è¿›è¡Œ æˆæƒã€‚</p><p>**é€‚ç”¨äºæ²¡æœ‰å‰ç«¯çš„å‘½ä»¤è¡Œåº”ç”¨ï¼Œå³åœ¨å‘½ä»¤è¡Œä¸‹è¯·æ±‚ä»¤ç‰Œã€‚**ä¸€èˆ¬ç”¨æ¥æä¾›ç»™æˆ‘ä»¬å®Œå…¨ä¿¡ä»»çš„æœåŠ¡å™¨ç«¯æœåŠ¡ã€‚</p><p><img src="https://note.youdao.com/yws/public/resource/eaab054e79f362d02340114569806d3a/xmlnote/4C4A7E900EAD416F94A9FCE3719413CE/18920" alt=""></p><p>å®ƒçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>ï¼ˆAï¼‰å®¢æˆ·ç«¯å‘æˆæƒæœåŠ¡å™¨è¿›è¡Œèº«ä»½è®¤è¯ï¼Œå¹¶è¦æ±‚ä¸€ä¸ªè®¿é—®ä»¤ç‰Œã€‚</p><p>ï¼ˆBï¼‰æˆæƒæœåŠ¡å™¨ç¡®è®¤æ— è¯¯åï¼Œå‘å®¢æˆ·ç«¯æä¾›è®¿é—®ä»¤ç‰Œã€‚</p><p>A åº”ç”¨åœ¨å‘½ä»¤è¡Œå‘ B å‘å‡ºè¯·æ±‚ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://oauth.b.com/token? 
grant_type=client_credentials&amp; 
client_id=CLIENT_ID&amp; 
client_secret=CLIENT_SECRET              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="é…ç½®æˆæƒæœåŠ¡å™¨-2" tabindex="-1"><a class="header-anchor" href="#é…ç½®æˆæƒæœåŠ¡å™¨-2" aria-hidden="true">#</a> é…ç½®æˆæƒæœåŠ¡å™¨</h6><p>åœ¨grant_typeå¢åŠ client_credentialsæ¥æ”¯æŒå®¢æˆ·ç«¯æ¨¡å¼ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>clients<span class="token punctuation">.</span><span class="token function">inMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®client_id</span>
        <span class="token punctuation">.</span><span class="token function">withClient</span><span class="token punctuation">(</span><span class="token string">&quot;client&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®client-secret</span>
        <span class="token punctuation">.</span><span class="token function">secret</span><span class="token punctuation">(</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;123123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®è®¿é—®tokençš„æœ‰æ•ˆæœŸ</span>
        <span class="token punctuation">.</span><span class="token function">accessTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®åˆ·æ–°tokençš„æœ‰æ•ˆæœŸ</span>
        <span class="token punctuation">.</span><span class="token function">refreshTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">864000</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®redirect_uriï¼Œç”¨äºæˆæƒæˆåŠŸåè·³è½¬</span>
        <span class="token punctuation">.</span><span class="token function">redirectUris</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.baidu.com&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®ç”³è¯·çš„æƒé™èŒƒå›´</span>
        <span class="token punctuation">.</span><span class="token function">scopes</span><span class="token punctuation">(</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span>
        <span class="token doc-comment comment">/**
         * é…ç½®grant_typeï¼Œè¡¨ç¤ºæˆæƒç±»å‹
         * authorization_code: æˆæƒç æ¨¡å¼
         * implicit: ç®€åŒ–æ¨¡å¼
         * passwordï¼š å¯†ç æ¨¡å¼
         * client_credentials: å®¢æˆ·ç«¯æ¨¡å¼
         * refresh_token: æ›´æ–°ä»¤ç‰Œ
         */</span>
        <span class="token punctuation">.</span><span class="token function">authorizedGrantTypes</span><span class="token punctuation">(</span><span class="token string">&quot;authorization_code&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;implicit&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;client_credentials&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;refresh_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è·å–ä»¤ç‰Œï¼š</p><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041752612.png" alt=""></p><h5 id="ç®€åŒ–-éšå¼-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ç®€åŒ–-éšå¼-æ¨¡å¼" aria-hidden="true">#</a> <strong>ç®€åŒ–(éšå¼)æ¨¡å¼</strong></h5><p>æœ‰äº› Web åº”ç”¨æ˜¯çº¯å‰ç«¯åº”ç”¨ï¼Œæ²¡æœ‰åç«¯ã€‚è¿™æ—¶å°±ä¸èƒ½ç”¨ä¸Šé¢çš„æ–¹å¼äº†ï¼Œå¿…é¡»å°†ä»¤ç‰Œå‚¨å­˜åœ¨å‰ç«¯ã€‚<strong>RFC 6749 å°±è§„å®šäº†ç¬¬äºŒç§æ–¹å¼ï¼Œå…è®¸ç›´æ¥å‘å‰ç«¯é¢å‘ä»¤ç‰Œï¼Œè¿™ç§æ–¹å¼æ²¡æœ‰æˆæƒç è¿™ä¸ªä¸­é—´æ­¥éª¤ï¼Œæ‰€ä»¥ç§°ä¸ºï¼ˆæˆæƒç ï¼‰&quot;éšè—å¼&quot;ï¼ˆimplicitï¼‰</strong></p><p>ç®€åŒ–æ¨¡å¼ä¸é€šè¿‡ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­å‘æˆæƒæœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œï¼Œè·³è¿‡äº†&quot;æˆæƒç &quot;è¿™ä¸ªæ­¥éª¤ï¼Œæ‰€æœ‰æ­¥éª¤åœ¨æµè§ˆå™¨ä¸­å®Œæˆï¼Œä»¤ç‰Œå¯¹è®¿é—®è€…æ˜¯å¯è§çš„ï¼Œä¸”å®¢æˆ·ç«¯ä¸éœ€è¦è®¤è¯ã€‚</p><p>è¿™ç§æ–¹å¼æŠŠä»¤ç‰Œç›´æ¥ä¼ ç»™å‰ç«¯ï¼Œæ˜¯å¾ˆä¸å®‰å…¨çš„ã€‚å› æ­¤ï¼Œåªèƒ½ç”¨äºä¸€äº›å®‰å…¨è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼Œå¹¶ä¸”ä»¤ç‰Œçš„æœ‰æ•ˆæœŸå¿…é¡»éå¸¸çŸ­ï¼Œé€šå¸¸å°±æ˜¯ä¼šè¯æœŸé—´ï¼ˆsessionï¼‰æœ‰æ•ˆï¼Œæµè§ˆå™¨å…³æ‰ï¼Œä»¤ç‰Œå°±å¤±æ•ˆäº†ã€‚</p><p><img src="https://note.youdao.com/yws/public/resource/eaab054e79f362d02340114569806d3a/xmlnote/E325135F742643A588C17ED8078C72E7/18898" alt="https://note.youdao.com/yws/public/resource/eaab054e79f362d02340114569806d3a/xmlnote/E325135F742643A588C17ED8078C72E7/18898"></p><p>å®ƒçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>ï¼ˆAï¼‰å®¢æˆ·ç«¯å°†ç”¨æˆ·å¯¼å‘æˆæƒæœåŠ¡å™¨ã€‚</p><p>ï¼ˆBï¼‰ç”¨æˆ·å†³å®šæ˜¯å¦ç»™äºå®¢æˆ·ç«¯æˆæƒã€‚</p><p>ï¼ˆCï¼‰å‡è®¾ç”¨æˆ·ç»™äºˆæˆæƒï¼ŒæˆæƒæœåŠ¡å™¨å°†ç”¨æˆ·å¯¼å‘å®¢æˆ·ç«¯æŒ‡å®šçš„&quot;é‡å®šå‘URI&quot;ï¼Œå¹¶åœ¨URIçš„Hashéƒ¨åˆ†åŒ…å«äº†è®¿é—®ä»¤ç‰Œã€‚</p><p>ï¼ˆDï¼‰æµè§ˆå™¨å‘èµ„æºæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå…¶ä¸­ä¸åŒ…æ‹¬ä¸Šä¸€æ­¥æ”¶åˆ°çš„Hashå€¼ã€‚</p><p>ï¼ˆEï¼‰èµ„æºæœåŠ¡å™¨è¿”å›ä¸€ä¸ªç½‘é¡µï¼Œå…¶ä¸­åŒ…å«çš„ä»£ç å¯ä»¥è·å–Hashå€¼ä¸­çš„ä»¤ç‰Œã€‚</p><p>ï¼ˆFï¼‰æµè§ˆå™¨æ‰§è¡Œä¸Šä¸€æ­¥è·å¾—çš„è„šæœ¬ï¼Œæå–å‡ºä»¤ç‰Œã€‚</p><p>ï¼ˆGï¼‰æµè§ˆå™¨å°†ä»¤ç‰Œå‘ç»™å®¢æˆ·ç«¯ã€‚</p><p>A ç½‘ç«™æä¾›ä¸€ä¸ªé“¾æ¥ï¼Œè¦æ±‚ç”¨æˆ·è·³è½¬åˆ° B ç½‘ç«™ï¼Œæˆæƒç”¨æˆ·æ•°æ®ç»™ A ç½‘ç«™ä½¿ç”¨ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://b.com/oauth/authorize?
&gt;   response_type=token&amp;          # response_typeå‚æ•°ä¸ºtokenï¼Œè¡¨ç¤ºè¦æ±‚ç›´æ¥è¿”å›ä»¤ç‰Œ
&gt;   client_id=CLIENT_ID&amp;
&gt;   redirect_uri=CALLBACK_URL&amp;
&gt;   scope=read
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”¨æˆ·è·³è½¬åˆ° B ç½‘ç«™ï¼Œç™»å½•ååŒæ„ç»™äºˆ A ç½‘ç«™æˆæƒã€‚è¿™æ—¶ï¼ŒB ç½‘ç«™å°±ä¼šè·³å›redirect_uriå‚æ•°æŒ‡å®šçš„è·³è½¬ç½‘å€ï¼Œå¹¶ä¸”æŠŠä»¤ç‰Œä½œä¸º URL å‚æ•°ï¼Œä¼ ç»™ A ç½‘ç«™ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://a.com/callback#token=ACCESS_TOKEN     #tokenå‚æ•°å°±æ˜¯ä»¤ç‰Œï¼ŒA ç½‘ç«™ç›´æ¥åœ¨å‰ç«¯æ‹¿åˆ°ä»¤ç‰Œã€‚ 

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="é…ç½®æˆæƒæœåŠ¡å™¨-3" tabindex="-1"><a class="header-anchor" href="#é…ç½®æˆæƒæœåŠ¡å™¨-3" aria-hidden="true">#</a> é…ç½®æˆæƒæœåŠ¡å™¨</h6><p>åªéœ€è¦åœ¨é…ç½®grant_typeå¢åŠ implicit</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
clients<span class="token punctuation">.</span><span class="token function">inMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®client_id</span>
        <span class="token punctuation">.</span><span class="token function">withClient</span><span class="token punctuation">(</span><span class="token string">&quot;client&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®client-secret</span>
        <span class="token punctuation">.</span><span class="token function">secret</span><span class="token punctuation">(</span>passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;123123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®è®¿é—®tokençš„æœ‰æ•ˆæœŸ</span>
        <span class="token punctuation">.</span><span class="token function">accessTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®åˆ·æ–°tokençš„æœ‰æ•ˆæœŸ</span>
        <span class="token punctuation">.</span><span class="token function">refreshTokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">864000</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®redirect_uriï¼Œç”¨äºæˆæƒæˆåŠŸåè·³è½¬</span>
        <span class="token punctuation">.</span><span class="token function">redirectUris</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.baidu.com&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®ç”³è¯·çš„æƒé™èŒƒå›´</span>
        <span class="token punctuation">.</span><span class="token function">scopes</span><span class="token punctuation">(</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">//é…ç½®grant_typeï¼Œè¡¨ç¤ºæˆæƒç±»å‹ æˆæƒç ï¼šauthorization_code implicit: ç®€åŒ–æ¨¡å¼</span>
        <span class="token punctuation">.</span><span class="token function">authorizedGrantTypes</span><span class="token punctuation">(</span><span class="token string">&quot;authorization_code&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;implicit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>http://localhost:8080/oauth/authorize?client_id=client&amp;response_type=token&amp;scope=all&amp;redirect_uri=http://www.baidu.com</p><p>ç™»å½•ä¹‹åè¿›å…¥æˆæƒé¡µé¢ï¼Œç¡®å®šæˆæƒåæµè§ˆå™¨ä¼šé‡å®šå‘åˆ°æŒ‡å®šè·¯å¾„ï¼Œå¹¶ä»¥Hashçš„å½¢å¼å­˜æ”¾åœ¨é‡å®šå‘uriçš„fargmentä¸­ï¼š</p><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041719513.png" alt=""></p><p>å¦‚æœæƒ³è¦æ”¯æŒæ•°æ®åº“æ¨¡å¼ï¼Œé…ç½®åŒæˆæƒç æ¨¡å¼ä¸€æ ·ï¼Œåªéœ€è¦åœ¨oauth_client_detailsè¡¨çš„authorized_grant_typesé…ç½®ä¸Šimplicitå³å¯ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>INSERT INTO `oauth`.`oauth_client_details`(`client_id`, `resource_ids`, `client_secret`, `scope`, `authorized_grant_types`, `web_server_redirect_uri`, `authorities`, `access_token_validity`, `refresh_token_validity`, `additional_information`, `autoapprove`) VALUES (&#39;gateway&#39;, NULL, &#39;$2a$10$CE1GKj9eBZsNNMCZV2hpo.QBOz93ojy9mTd9YQaOy8H4JAyYKVlm6&#39;, &#39;all&#39;, &#39;authorization_code,password,refresh_token,implicit&#39;, &#39;http://www.baidu.com&#39;, NULL, 3600, 864000, NULL, NULL);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="ä»¤ç‰Œçš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä»¤ç‰Œçš„ä½¿ç”¨" aria-hidden="true">#</a> <strong>ä»¤ç‰Œçš„ä½¿ç”¨</strong></h4><p>A ç½‘ç«™æ‹¿åˆ°ä»¤ç‰Œä»¥åï¼Œå°±å¯ä»¥å‘ B ç½‘ç«™çš„ API è¯·æ±‚æ•°æ®äº†ã€‚</p><p>æ­¤æ—¶ï¼Œæ¯ä¸ªå‘åˆ° API çš„è¯·æ±‚ï¼Œéƒ½å¿…é¡»å¸¦æœ‰ä»¤ç‰Œã€‚å…·ä½“åšæ³•æ˜¯åœ¨è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼ŒåŠ ä¸Šä¸€ä¸ªAuthorizationå­—æ®µï¼Œä»¤ç‰Œå°±æ”¾åœ¨è¿™ä¸ªå­—æ®µé‡Œé¢ã€‚</p><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041530217.png" alt=""></p><p>ä¹Ÿå¯ä»¥æ·»åŠ è¯·æ±‚å‚æ•°access_tokenè¯·æ±‚æ•°æ®</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>localhost/user/getCurrentUser?access_token=xxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041527367.png" alt=""></p><h4 id="æ›´æ–°ä»¤ç‰Œ" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°ä»¤ç‰Œ" aria-hidden="true">#</a> <strong>æ›´æ–°ä»¤ç‰Œ</strong></h4><p>ä»¤ç‰Œçš„æœ‰æ•ˆæœŸåˆ°äº†ï¼Œå¦‚æœè®©ç”¨æˆ·é‡æ–°èµ°ä¸€éä¸Šé¢çš„æµç¨‹ï¼Œå†ç”³è¯·ä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œå¾ˆå¯èƒ½ä½“éªŒä¸å¥½ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰å¿…è¦ã€‚OAuth 2.0 å…è®¸ç”¨æˆ·è‡ªåŠ¨æ›´æ–°ä»¤ç‰Œã€‚</p><p>â€‹ <img src="https://note.youdao.com/yws/public/resource/eaab054e79f362d02340114569806d3a/xmlnote/6D63CE8D35F04D63976B016C628B05CD/18991" alt="0"></p><p>å…·ä½“æ–¹æ³•æ˜¯ï¼ŒB ç½‘ç«™é¢å‘ä»¤ç‰Œçš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§é¢å‘ä¸¤ä¸ªä»¤ç‰Œï¼Œä¸€ä¸ªç”¨äºè·å–æ•°æ®ï¼Œå¦ä¸€ä¸ªç”¨äºè·å–æ–°çš„ä»¤ç‰Œï¼ˆrefresh token å­—æ®µï¼‰ã€‚ä»¤ç‰Œåˆ°æœŸå‰ï¼Œç”¨æˆ·ä½¿ç”¨ refresh token å‘ä¸€ä¸ªè¯·æ±‚ï¼Œå»æ›´æ–°ä»¤ç‰Œã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://b.com/oauth/token?
&gt;   grant_type=refresh_token&amp;    # grant_typeå‚æ•°ä¸ºrefresh_tokenè¡¨ç¤ºè¦æ±‚æ›´æ–°ä»¤ç‰Œ
&gt;   client_id=CLIENT_ID&amp;
&gt;   client_secret=CLIENT_SECRET&amp;
&gt;   refresh_token=REFRESH_TOKEN    # ç”¨äºæ›´æ–°ä»¤ç‰Œçš„ä»¤ç‰Œ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://gitee.com/zysspace/pic/raw/master/images/202205041814057.png" alt=""></p><h4 id="åŸºäºrediså­˜å‚¨token" tabindex="-1"><a class="header-anchor" href="#åŸºäºrediså­˜å‚¨token" aria-hidden="true">#</a> <strong>åŸºäºrediså­˜å‚¨Token</strong></h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
    &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="redisé…ç½®ç±»" tabindex="-1"><a class="header-anchor" href="#redisé…ç½®ç±»" aria-hidden="true">#</a> redisé…ç½®ç±»</h6><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TokenStore</span> <span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisTokenStore</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æˆæƒæœåŠ¡å™¨é…ç½®ä¸­æŒ‡å®šä»¤ç‰Œçš„å­˜å‚¨ç­–ç•¥ä¸ºRedis</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">TokenStore</span> tokenStore<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationServerEndpointsConfigurer</span> endpoints<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    endpoints<span class="token punctuation">.</span><span class="token function">authenticationManager</span><span class="token punctuation">(</span>authenticationManagerBean<span class="token punctuation">)</span> <span class="token comment">//ä½¿ç”¨å¯†ç æ¨¡å¼éœ€è¦é…ç½®</span>
        <span class="token punctuation">.</span><span class="token function">tokenStore</span><span class="token punctuation">(</span>tokenStore<span class="token punctuation">)</span>  <span class="token comment">//æŒ‡å®štokenå­˜å‚¨åˆ°redis</span>
        <span class="token punctuation">.</span><span class="token function">reuseRefreshTokens</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>  <span class="token comment">//refresh_tokenæ˜¯å¦é‡å¤ä½¿ç”¨</span>
        <span class="token punctuation">.</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span>userService<span class="token punctuation">)</span> <span class="token comment">//åˆ·æ–°ä»¤ç‰ŒæˆæƒåŒ…å«å¯¹ç”¨æˆ·ä¿¡æ¯çš„æ£€æŸ¥</span>
        <span class="token punctuation">.</span><span class="token function">allowedTokenEndpointRequestMethods</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ”¯æŒGET,POSTè¯·æ±‚</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h3><p>OAuth2.0 çš„æˆæƒç®€å•ç†è§£å…¶å®å°±æ˜¯è·å–ä»¤ç‰Œï¼ˆtokenï¼‰çš„è¿‡ç¨‹ï¼ŒOAuth åè®®å®šä¹‰äº†å››ç§è·å¾—ä»¤ç‰Œçš„æˆæƒæ–¹å¼ï¼ˆauthorization grant ï¼‰ï¼šæˆæƒç ï¼ˆauthorization-codeï¼‰ã€ç®€å•å¼ï¼ˆimplicitï¼‰ã€å¯†ç å¼ï¼ˆpasswordï¼‰ã€å®¢æˆ·ç«¯å‡­è¯ï¼ˆclient credentialsï¼‰ï¼Œä¸€èˆ¬å¸¸ç”¨çš„æ˜¯æˆæƒç å’Œå¯†ç æ¨¡å¼ã€‚</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: zysspace@163.com">javacode</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/docs/SpringCloudAlibaba/Spring%20Cloud%20Ribbon.html" class="nav-link prev" aria-label="Spring Cloud Ribbon"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon discover" style=""></span>Spring Cloud Ribbon</div></a><a href="/docs/SpringCloudAlibaba/spring%20cloud%20%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.html" class="nav-link next" aria-label="SpringCloud æ³¨å†Œä¸­å¿ƒ"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">SpringCloud æ³¨å†Œä¸­å¿ƒ<span class="font-icon icon discover" style=""></span></div></a></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/docs/assets/app-e6db4a12.js" defer></script>
  </body>
</html>
