<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zilong-tech.github.io/docs/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html"><meta property="og:site_name" content="å­é¾™æŠ€æœ¯"><meta property="og:title" content="RocketMQå®æˆ˜"><meta property="og:description" content="ä½¿ç”¨åŸç”ŸAPI å¼•å…¥ä¾èµ– ``` org.apache.rocketmq rocketmq-client 4.9.1 ``` ä½¿ç”¨æ­¥éª¤æ¶ˆæ¯å‘é€è€…çš„å›ºå®šæ­¥éª¤; 1.åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…producerï¼Œå¹¶åˆ¶å®šç”Ÿäº§è€…ç»„å 2.æŒ‡å®šNameserveråœ°å€ 3.å¯åŠ¨producer 4.åˆ›å»ºæ¶ˆæ¯å¯¹è±¡ï¼ŒæŒ‡å®šä¸»é¢˜Topicã€Tagå’Œæ¶ˆæ¯ä½“ 5.å‘é€æ¶ˆæ¯ 6.å…³é—­ç”Ÿäº§..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-02-15T12:37:42.000Z"><meta property="article:author" content="ç¨‹åºå‘˜å­é¾™"><meta property="article:modified_time" content="2023-02-15T12:37:42.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"RocketMQå®æˆ˜","image":[""],"dateModified":"2023-02-15T12:37:42.000Z","author":[{"@type":"Person","name":"ç¨‹åºå‘˜å­é¾™"}]}</script><title>RocketMQå®æˆ˜ | å­é¾™æŠ€æœ¯</title><meta name="description" content="ä½¿ç”¨åŸç”ŸAPI å¼•å…¥ä¾èµ– ``` org.apache.rocketmq rocketmq-client 4.9.1 ``` ä½¿ç”¨æ­¥éª¤æ¶ˆæ¯å‘é€è€…çš„å›ºå®šæ­¥éª¤; 1.åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…producerï¼Œå¹¶åˆ¶å®šç”Ÿäº§è€…ç»„å 2.æŒ‡å®šNameserveråœ°å€ 3.å¯åŠ¨producer 4.åˆ›å»ºæ¶ˆæ¯å¯¹è±¡ï¼ŒæŒ‡å®šä¸»é¢˜Topicã€Tagå’Œæ¶ˆæ¯ä½“ 5.å‘é€æ¶ˆæ¯ 6.å…³é—­ç”Ÿäº§...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/docs/assets/style-84ad0583.css" as="style"><link rel="stylesheet" href="/docs/assets/style-84ad0583.css">
    <link rel="modulepreload" href="/docs/assets/app-e6db4a12.js"><link rel="modulepreload" href="/docs/assets/framework-2afc6763.js"><link rel="modulepreload" href="/docs/assets/RocketMQå®æˆ˜.html-0ffd92a8.js"><link rel="modulepreload" href="/docs/assets/RocketMQå®æˆ˜.html-3f67ee11.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/docs/" class="brand"><img class="logo" src="/docs/logo.png" alt="å­é¾™æŠ€æœ¯"><!----><span class="site-name hide-in-pad">å­é¾™æŠ€æœ¯</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/docs/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="nav-link" aria-label="å¹¶å‘ç¼–ç¨‹"><span class="font-icon icon info" style=""></span>å¹¶å‘ç¼–ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="nav-link" aria-label="ç½‘ç»œç¼–ç¨‹"><span class="font-icon icon info" style=""></span>ç½‘ç»œç¼–ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åˆ†å¸ƒå¼"><span class="title"><span class="font-icon icon info" style=""></span>åˆ†å¸ƒå¼</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80/" class="nav-link" aria-label="åˆ†å¸ƒå¼åŸºç¡€"><span class="font-icon icon creative" style=""></span>åˆ†å¸ƒå¼åŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/docs/zookeeper/" class="nav-link" aria-label="zookeeper"><span class="font-icon icon creative" style=""></span>zookeeper<!----></a></li><li class="dropdown-item"><a href="/docs/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" class="nav-link" aria-label="åˆ†å¸ƒå¼äº‹åŠ¡"><span class="font-icon icon creative" style=""></span>åˆ†å¸ƒå¼äº‹åŠ¡<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¾®æœåŠ¡"><span class="title"><span class="font-icon icon info" style=""></span>å¾®æœåŠ¡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/SpringBoot/" class="nav-link" aria-label="SpringBoot"><span class="font-icon icon creative" style=""></span>SpringBoot<!----></a></li><li class="dropdown-item"><a href="/docs/SpringCloudAlibaba/" class="nav-link" aria-label="SpringCloudAlibaba"><span class="font-icon icon creative" style=""></span>SpringCloudAlibaba<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="nav-link" aria-label="è®¾è®¡æ¨¡å¼"><span class="font-icon icon info" style=""></span>è®¾è®¡æ¨¡å¼<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/Java/" class="nav-link" aria-label="Java"><span class="font-icon icon info" style=""></span>Java<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/JVM/" class="nav-link" aria-label="JVM"><span class="font-icon icon info" style=""></span>JVM<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="font-icon icon info" style=""></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/Redis/" class="nav-link" aria-label="Redis"><span class="font-icon icon info" style=""></span>Redis<!----></a></li><li class="dropdown-item"><a href="/docs/MySQL/" class="nav-link" aria-label="MySQL"><span class="font-icon icon info" style=""></span>MySQL<!----></a></li><li class="dropdown-item"><a href="/docs/Mongodb/" class="nav-link" aria-label="Mongodb"><span class="font-icon icon info" style=""></span>Mongodb<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/Mybatis/" class="nav-link" aria-label="Mybatis"><span class="font-icon icon info" style=""></span>Mybatis<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/Spring/" class="nav-link" aria-label="Spring"><span class="font-icon icon info" style=""></span>Spring<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¶ˆæ¯ä¸­é—´ä»¶"><span class="title"><span class="font-icon icon info" style=""></span>æ¶ˆæ¯ä¸­é—´ä»¶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/docs/Kafka/" class="nav-link" aria-label="Kafka"><span class="font-icon icon creative" style=""></span>Kafka<!----></a></li><li class="dropdown-item"><a href="/docs/RocketMQ/" class="nav-link active" aria-label="RocketMQ"><span class="font-icon icon creative" style=""></span>RocketMQ<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/docs/%E9%AB%98%E5%B9%B6%E5%8F%91/" class="nav-link" aria-label="é«˜å¹¶å‘"><span class="font-icon icon info" style=""></span>é«˜å¹¶å‘<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E9%9D%A2%E8%AF%95/" class="nav-link" aria-label="é¢è¯•"><span class="font-icon icon info" style=""></span>é¢è¯•<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E5%B7%A5%E5%85%B7/" class="nav-link" aria-label="å·¥å…·"><span class="font-icon icon info" style=""></span>å·¥å…·<!----></a></div><div class="nav-item hide-in-mobile"><a href="/docs/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/" class="nav-link" aria-label="å¼€æºé¡¹ç›®"><span class="font-icon icon info" style=""></span>å¼€æºé¡¹ç›®<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/docs/RocketMQ/RocketMQ%E4%BD%BF%E7%94%A8%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E9%97%AE%E9%A2%98.html" class="nav-link sidebar-link sidebar-page" aria-label="ä½¿ç”¨RocketMQå¸¸è§é—®é¢˜"><span class="font-icon icon discover" style=""></span>ä½¿ç”¨RocketMQå¸¸è§é—®é¢˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/docs/RocketMQ/RocketMQ%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" class="nav-link sidebar-link sidebar-page" aria-label="RocketMQåŸºç¡€çŸ¥è¯†"><span class="font-icon icon discover" style=""></span>RocketMQåŸºç¡€çŸ¥è¯†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="RocketMQå®æˆ˜"><span class="font-icon icon discover" style=""></span>RocketMQå®æˆ˜<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#ä½¿ç”¨åŸç”Ÿapi" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä½¿ç”¨åŸç”ŸAPI"><!---->ä½¿ç”¨åŸç”ŸAPI<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#å¼•å…¥ä¾èµ–" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¼•å…¥ä¾èµ–"><!---->å¼•å…¥ä¾èµ–<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#ä½¿ç”¨æ­¥éª¤" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä½¿ç”¨æ­¥éª¤"><!---->ä½¿ç”¨æ­¥éª¤<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#æ¶ˆæ¯ç¤ºä¾‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ¶ˆæ¯ç¤ºä¾‹"><!---->æ¶ˆæ¯ç¤ºä¾‹<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#springbootæ•´åˆrocketmq" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBootæ•´åˆRocketMQ"><!---->SpringBootæ•´åˆRocketMQ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#å¼•å…¥ä¾èµ–-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¼•å…¥ä¾èµ–"><!---->å¼•å…¥ä¾èµ–<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#æ¶ˆæ¯ç”Ÿäº§è€…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ¶ˆæ¯ç”Ÿäº§è€…"><!---->æ¶ˆæ¯ç”Ÿäº§è€…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#æ¶ˆæ¯æ¶ˆè´¹è€…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ¶ˆæ¯æ¶ˆè´¹è€…"><!---->æ¶ˆæ¯æ¶ˆè´¹è€…<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="font-icon icon discover" style=""></span>RocketMQå®æˆ˜</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">ç¨‹åºå‘˜å­é¾™</span></span><span property="author" content="ç¨‹åºå‘˜å­é¾™"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-15T03:36:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 21 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT21M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category0" role>RocketMQ</span><meta property="articleSection" content="RocketMQ"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#ä½¿ç”¨åŸç”Ÿapi" class="router-link-active router-link-exact-active toc-link level2">ä½¿ç”¨åŸç”ŸAPI</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#å¼•å…¥ä¾èµ–" class="router-link-active router-link-exact-active toc-link level3">å¼•å…¥ä¾èµ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#ä½¿ç”¨æ­¥éª¤" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨æ­¥éª¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#æ¶ˆæ¯ç¤ºä¾‹" class="router-link-active router-link-exact-active toc-link level3">æ¶ˆæ¯ç¤ºä¾‹</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#springbootæ•´åˆrocketmq" class="router-link-active router-link-exact-active toc-link level2">SpringBootæ•´åˆRocketMQ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#å¼•å…¥ä¾èµ–-1" class="router-link-active router-link-exact-active toc-link level3">å¼•å…¥ä¾èµ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#æ¶ˆæ¯ç”Ÿäº§è€…" class="router-link-active router-link-exact-active toc-link level3">æ¶ˆæ¯ç”Ÿäº§è€…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/docs/RocketMQ/RocketMQ%E5%AE%9E%E6%88%98.html#æ¶ˆæ¯æ¶ˆè´¹è€…" class="router-link-active router-link-exact-active toc-link level3">æ¶ˆæ¯æ¶ˆè´¹è€…</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h2 id="ä½¿ç”¨åŸç”Ÿapi" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åŸç”Ÿapi" aria-hidden="true">#</a> ä½¿ç”¨åŸç”ŸAPI</h2><h3 id="å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#å¼•å…¥ä¾èµ–" aria-hidden="true">#</a> å¼•å…¥ä¾èµ–</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;
    &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt;
    &lt;version&gt;4.9.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ­¥éª¤" aria-hidden="true">#</a> ä½¿ç”¨æ­¥éª¤</h3><ul><li><p>æ¶ˆæ¯å‘é€è€…çš„å›ºå®šæ­¥éª¤</p><p>1.åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…producerï¼Œå¹¶åˆ¶å®šç”Ÿäº§è€…ç»„å 2.æŒ‡å®šNameserveråœ°å€ 3.å¯åŠ¨producer 4.åˆ›å»ºæ¶ˆæ¯å¯¹è±¡ï¼ŒæŒ‡å®šä¸»é¢˜Topicã€Tagå’Œæ¶ˆæ¯ä½“ 5.å‘é€æ¶ˆæ¯ 6.å…³é—­ç”Ÿäº§è€…producer</p></li><li><p>æ¶ˆæ¯æ¶ˆè´¹è€…çš„å›ºå®šæ­¥éª¤</p><p>1.åˆ›å»ºæ¶ˆè´¹è€…Consumerï¼Œåˆ¶å®šæ¶ˆè´¹è€…ç»„å 2.æŒ‡å®šNameserveråœ°å€ 3.è®¢é˜…ä¸»é¢˜Topicå’ŒTag 4.è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå¤„ç†æ¶ˆæ¯ 5.å¯åŠ¨æ¶ˆè´¹è€…consumer</p></li></ul><h3 id="æ¶ˆæ¯ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯ç¤ºä¾‹" aria-hidden="true">#</a> æ¶ˆæ¯ç¤ºä¾‹</h3><h4 id="æ™®é€šæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#æ™®é€šæ¶ˆæ¯" aria-hidden="true">#</a> æ™®é€šæ¶ˆæ¯</h4><h5 id="æ¶ˆæ¯å‘é€" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯å‘é€" aria-hidden="true">#</a> æ¶ˆæ¯å‘é€</h5><h6 id="å‘é€åŒæ­¥æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å‘é€åŒæ­¥æ¶ˆæ¯" aria-hidden="true">#</a> å‘é€åŒæ­¥æ¶ˆæ¯</h6><p>åŒæ­¥å‘é€æ˜¯æŒ‡æ¶ˆæ¯å‘é€æ–¹å‘å‡ºæ•°æ®åï¼ŒåŒæ­¥ç­‰å¾…ï¼Œç›´åˆ°æ”¶åˆ°æ¥æ”¶æ–¹å‘å›å“åº”ä¹‹åæ‰å‘ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</p><p>è¿™ç§å¯é æ€§åŒæ­¥åœ°å‘é€æ–¹å¼ä½¿ç”¨çš„æ¯”è¾ƒå¹¿æ³›ï¼Œæ¯”å¦‚ï¼šé‡è¦çš„æ¶ˆæ¯é€šçŸ¥ã€‚</p><p><img src="http://rpumme6gd.hb-bkt.clouddn.com/202302151704600.png" alt=""></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;ProducerGroupName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>

                    <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;OrderID101&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//åŒæ­¥ä¼ é€’æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¼šå‘ç»™é›†ç¾¤ä¸­çš„ä¸€ä¸ªBrokerèŠ‚ç‚¹ã€‚</span>
                    <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>SendResult [sendStatus=SEND_OK, msgId=7F000001468C18B4AAC23D1B3B830000, offsetMsgId=C0A8016600002A9F000000000005FA8C, messageQueue=MessageQueue [topic=TopicTest, brokerName=LAPTOP-1I6NM6CJ, queueId=3], queueOffset=510] SendResult [sendStatus=SEND_OK, msgId=7F000001468C18B4AAC23D1B3B900001, offsetMsgId=C0A8016600002A9F000000000005FB55, messageQueue=MessageQueue [topic=TopicTest, brokerName=LAPTOP-1I6NM6CJ, queueId=0], queueOffset=510] SendResult [sendStatus=SEND_OK, msgId=7F000001468C18B4AAC23D1B3B920002, offsetMsgId=C0A8016600002A9F000000000005FC1E, messageQueue=MessageQueue [topic=TopicTest, brokerName=LAPTOP-1I6NM6CJ, queueId=1], queueOffset=510] SendResult [sendStatus=SEND_OK, msgId=7F000001468C18B4AAC23D1B3B950003, offsetMsgId=C0A8016600002A9F000000000005FCE7, messageQueue=MessageQueue [topic=TopicTest, brokerName=LAPTOP-1I6NM6CJ, queueId=2], queueOffset=510] SendResult [sendStatus=SEND_OK, msgId=7F000001468C18B4AAC23D1B3B9B0004, offsetMsgId=C0A8016600002A9F000000000005FDB0, messageQueue=MessageQueue [topic=TopicTest, brokerName=LAPTOP-1I6NM6CJ, queueId=3], queueOffset=511]</p></blockquote><p><strong>Message ID</strong></p><p>æ¶ˆæ¯çš„å…¨å±€å”¯ä¸€æ ‡è¯†ï¼ˆå†…éƒ¨æœºåˆ¶çš„ ID ç”Ÿæˆæ˜¯ä½¿ç”¨æœºå™¨ IP å’Œæ¶ˆæ¯åç§»é‡çš„ç»„æˆï¼Œæ‰€ä»¥æœ‰å¯èƒ½é‡å¤ï¼Œå¦‚æœæ˜¯å¹‚ç­‰æ€§è¿˜æ˜¯æœ€å¥½è€ƒè™‘ Keyï¼‰ï¼Œç”±æ¶ˆæ¯é˜Ÿåˆ— MQ</p><p>ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œå”¯ä¸€æ ‡è¯†æŸæ¡æ¶ˆæ¯ã€‚</p><p><strong>SendStatus</strong></p><p>å‘é€çš„æ ‡è¯†ã€‚æˆåŠŸï¼Œå¤±è´¥ç­‰</p><p><strong>Queue</strong></p><p>ç›¸å½“äºæ˜¯ Topic çš„åˆ†åŒºï¼›ç”¨äºå¹¶è¡Œå‘é€å’Œæ¥æ”¶æ¶ˆæ¯</p><h6 id="å‘é€å¼‚æ­¥æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å‘é€å¼‚æ­¥æ¶ˆæ¯" aria-hidden="true">#</a> <strong>å‘é€å¼‚æ­¥æ¶ˆæ¯</strong></h6><p>æ¶ˆæ¯å‘é€æ–¹åœ¨å‘é€äº†ä¸€æ¡æ¶ˆæ¯åï¼Œä¸ç­‰æ¥æ”¶æ–¹å‘å›å“åº”ï¼Œæ¥ç€è¿›è¡Œç¬¬äºŒæ¡æ¶ˆæ¯å‘é€ã€‚å‘é€æ–¹é€šè¿‡å›è°ƒæ¥å£çš„æ–¹å¼æ¥æ”¶æœåŠ¡å™¨å“åº”ï¼Œå¹¶å¯¹å“åº”ç»“æœè¿›è¡Œå¤„ç†ã€‚</p><p>å¼‚æ­¥æ¶ˆæ¯é€šå¸¸ç”¨åœ¨å¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ï¼Œå³å‘é€ç«¯ä¸èƒ½å®¹å¿é•¿æ—¶é—´åœ°ç­‰å¾… Broker çš„å“åº”ã€‚</p><p><img src="http://rpumme6gd.hb-bkt.clouddn.com/202302151655497.png" alt=""></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ç®€å•æ ·ä¾‹ï¼šå¼‚æ­¥å‘é€æ¶ˆæ¯</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>

        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;Daily_test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendAsyncFailed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> messageCount <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token comment">//ç”±äºæ˜¯å¼‚æ­¥å‘é€ï¼Œè¿™é‡Œå¼•å…¥ä¸€ä¸ªcountDownLatchï¼Œä¿è¯æ‰€æœ‰Producerå‘é€æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•éƒ½æ‰§è¡Œå®Œäº†å†åœæ­¢ProduceræœåŠ¡ã€‚</span>
        <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>messageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> messageCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;OrderID102&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d OK %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d Exception %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘é€å®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ¶ˆæ¯å‘é€å®Œæˆ æ¶ˆæ¯å‘é€å®Œæˆ æ¶ˆæ¯å‘é€å®Œæˆ æ¶ˆæ¯å‘é€å®Œæˆ æ¶ˆæ¯å‘é€å®Œæˆ 3 OK 7F000001189018B4AAC23D1C8C530003 0 OK 7F000001189018B4AAC23D1C8C530004 2 OK 7F000001189018B4AAC23D1C8C530002 1 OK 7F000001189018B4AAC23D1C8C530001 4 OK 7F000001189018B4AAC23D1C8C520000</p></blockquote><h6 id="å•å‘å‘é€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å•å‘å‘é€æ¶ˆæ¯" aria-hidden="true">#</a> å•å‘å‘é€æ¶ˆæ¯</h6><p>å•å‘ï¼ˆOnewayï¼‰å‘é€ç‰¹ç‚¹ä¸ºå‘é€æ–¹åªè´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œä¸ç­‰å¾…æœåŠ¡å™¨å›åº”ä¸”æ²¡æœ‰å›è°ƒå‡½æ•°è§¦å‘ï¼Œå³åªå‘é€è¯·æ±‚ä¸ç­‰å¾…åº”ç­”ã€‚æ­¤æ–¹å¼å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹è€—æ—¶éå¸¸çŸ­ï¼Œä¸€èˆ¬åœ¨å¾®ç§’çº§åˆ«ã€‚</p><p>è¿™ç§æ–¹å¼ä¸»è¦ç”¨åœ¨ä¸ç‰¹åˆ«å…³å¿ƒå‘é€ç»“æœçš„åœºæ™¯ï¼Œä¾‹å¦‚æ—¥å¿—å‘é€.</p><p><img src="http://rpumme6gd.hb-bkt.clouddn.com/202302151707027.png" alt=""></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnewayProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//Instantiate with a producer group name.</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Specify name server addresses.</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Launch the instance.</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Create a message instance, specifying topic, tag and message body.</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
                <span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span>
                    i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//Call send message to deliver message to one of brokers.</span>
            producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//Wait for sending to complete</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆæ¯å‘é€çš„é€‰æ‹©</strong></p><p><img src="http://rpumme6gd.hb-bkt.clouddn.com/202302151707527.png" alt=""></p><h5 id="æ¶ˆè´¹æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹æ¶ˆæ¯" aria-hidden="true">#</a> æ¶ˆè´¹æ¶ˆæ¯</h5><p>æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯æ¶ˆè´¹è€…ä¸»åŠ¨å»Brokerä¸Šæ‹‰å–æ¶ˆæ¯çš„æ‹‰æ¨¡å¼ï¼Œå¦ä¸€ç§æ˜¯æ¶ˆè´¹è€…ç­‰å¾…BrokeræŠŠæ¶ˆæ¯æ¨é€è¿‡æ¥çš„æ¨æ¨¡å¼ã€‚</p><h6 id="æ‹‰æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#æ‹‰æ¨¡å¼" aria-hidden="true">#</a> <strong>æ‹‰æ¨¡å¼</strong></h6><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ‹‰æ¨¡å¼
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PullConsumer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>

        <span class="token class-name">DefaultMQPullConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPullConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;group_name_6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> topics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//You would better to register topics,It will use in rebalance when starting</span>
        topics<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">setRegisterTopics</span><span class="token punctuation">(</span>topics<span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ExecutorService</span> executors <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>topics<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">&quot;PullConsumerThread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> topic <span class="token operator">:</span> consumer<span class="token punctuation">.</span><span class="token function">getRegisterTopics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            executors<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>


                <span class="token punctuation">}</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">&gt;</span></span> messageQueues <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">fetchMessageQueuesInBalance</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>messageQueues <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> messageQueues<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">continue</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token class-name">PullResult</span> pullResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageQueue</span> messageQueue <span class="token operator">:</span> messageQueues<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                                    <span class="token keyword">long</span> offset <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">consumeFromOffset</span><span class="token punctuation">(</span>messageQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    pullResult <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span>messageQueue<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> offset<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> pullResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">switch</span> <span class="token punctuation">(</span>pullResult<span class="token punctuation">.</span><span class="token function">getPullStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token keyword">case</span> <span class="token constant">FOUND</span><span class="token operator">:</span>
                                            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs <span class="token operator">=</span> pullResult<span class="token punctuation">.</span><span class="token function">getMsgFoundList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                                            <span class="token keyword">if</span> <span class="token punctuation">(</span>msgs <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>msgs<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span>msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                <span class="token comment">//update offset to broker</span>
                                                consumer<span class="token punctuation">.</span><span class="token function">updateConsumeOffset</span><span class="token punctuation">(</span>messageQueue<span class="token punctuation">,</span> pullResult<span class="token punctuation">.</span><span class="token function">getNextBeginOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                <span class="token comment">//print pull tps</span>
                                                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">incPullTPS</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> pullResult<span class="token punctuation">.</span><span class="token function">getMsgFoundList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            <span class="token punctuation">}</span>
                                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                                        <span class="token keyword">case</span> <span class="token constant">OFFSET_ILLEGAL</span><span class="token operator">:</span>
                                            consumer<span class="token punctuation">.</span><span class="token function">updateConsumeOffset</span><span class="token punctuation">(</span>messageQueue<span class="token punctuation">,</span> pullResult<span class="token punctuation">.</span><span class="token function">getNextBeginOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                                        <span class="token keyword">case</span> <span class="token constant">NO_NEW_MSG</span><span class="token operator">:</span>
                                            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            consumer<span class="token punctuation">.</span><span class="token function">updateConsumeOffset</span><span class="token punctuation">(</span>messageQueue<span class="token punctuation">,</span> pullResult<span class="token punctuation">.</span><span class="token function">getNextBeginOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                                        <span class="token keyword">case</span> <span class="token constant">NO_MATCHED_MSG</span><span class="token operator">:</span>
                                            consumer<span class="token punctuation">.</span><span class="token function">updateConsumeOffset</span><span class="token punctuation">(</span>messageQueue<span class="token punctuation">,</span> pullResult<span class="token punctuation">.</span><span class="token function">getNextBeginOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                                        <span class="token keyword">default</span><span class="token operator">:</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemotingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQBrokerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">//reblance error</span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">consumeFromOffset</span><span class="token punctuation">(</span><span class="token class-name">MessageQueue</span> messageQueue<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>
                    <span class="token comment">//-1 when started</span>
                    <span class="token keyword">long</span> offset <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">getOffsetStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readOffset</span><span class="token punctuation">(</span>messageQueue<span class="token punctuation">,</span> <span class="token class-name">ReadOffsetType</span><span class="token punctuation">.</span><span class="token constant">READ_FROM_MEMORY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//query from broker</span>
                        offset <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">getOffsetStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readOffset</span><span class="token punctuation">(</span>messageQueue<span class="token punctuation">,</span> <span class="token class-name">ReadOffsetType</span><span class="token punctuation">.</span><span class="token constant">READ_FROM_STORE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//first time start from last offset</span>
                        offset <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">maxOffset</span><span class="token punctuation">(</span>messageQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//make sure</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">return</span> offset<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">incPullTPS</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token keyword">int</span> pullSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    consumer<span class="token punctuation">.</span><span class="token function">getDefaultMQPullConsumerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRebalanceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getmQClientFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">getConsumerStatsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">incPullTPS</span><span class="token punctuation">(</span>consumer<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> topic<span class="token punctuation">,</span> pullSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="æ¨æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#æ¨æ¨¡å¼" aria-hidden="true">#</a> <strong>æ¨æ¨¡å¼</strong></h6><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¨æ¨¡å¼æ¶ˆè´¹æ¶ˆæ¯
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PushConsumer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;group_name_7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">setConsumeFromWhere</span><span class="token punctuation">(</span><span class="token class-name">ConsumeFromWhere</span><span class="token punctuation">.</span><span class="token constant">CONSUME_FROM_FIRST_OFFSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//wrong time format 2017_0422_221800</span>
        consumer<span class="token punctuation">.</span><span class="token function">setConsumeTimestamp</span><span class="token punctuation">(</span><span class="token string">&quot;20181109221800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s Receive New Messages: %s %n&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="é›†ç¾¤æ¶ˆè´¹" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤æ¶ˆè´¹" aria-hidden="true">#</a> <strong>é›†ç¾¤æ¶ˆè´¹</strong></h6><p><img src="http://rpumme6gd.hb-bkt.clouddn.com/202302151656699.png" alt=""></p><p>ä¸€ä¸ª Consumer Group ä¸­çš„å„ä¸ª Consumer å®ä¾‹åˆ†æ‘Šå»æ¶ˆè´¹æ¶ˆæ¯ï¼Œå³ä¸€æ¡æ¶ˆæ¯åªä¼šæŠ•é€’åˆ°ä¸€ä¸ª Consumer Group ä¸‹é¢çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><p>å®é™…ä¸Šï¼Œæ¯ä¸ª Consumer æ˜¯å¹³å‡åˆ†æ‘Š Message Queue çš„å»åšæ‹‰å–æ¶ˆè´¹ã€‚ä¾‹å¦‚æŸä¸ª Topic æœ‰ 3 æ¡ Qï¼Œå…¶ä¸­ä¸€ä¸ª Consumer Group æœ‰ 3 ä¸ªå®ä¾‹ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸ªå®ä¾‹åªæ¶ˆè´¹å…¶ä¸­çš„ 1 æ¡ Qã€‚</p><p>è€Œç”± Producer å‘é€æ¶ˆæ¯çš„æ—¶å€™æ˜¯è½®è¯¢æ‰€æœ‰çš„ Q,æ‰€ä»¥æ¶ˆæ¯ä¼šå¹³å‡æ•£è½åœ¨ä¸åŒçš„ Q ä¸Šï¼Œå¯ä»¥è®¤ä¸º Q ä¸Šçš„æ¶ˆæ¯æ˜¯å¹³å‡çš„ã€‚é‚£ä¹ˆå®ä¾‹ä¹Ÿå°±å¹³å‡åœ°æ¶ˆè´¹æ¶ˆæ¯äº†ã€‚</p><p>è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è¿›åº¦(Consumer Offset)çš„å­˜å‚¨ä¼šæŒä¹…åŒ–åˆ° <strong>Broker</strong>ã€‚</p><p>è¿™ç§æ–¹å¼æ˜¯é»˜è®¤æ¶ˆè´¹æ–¹å¼ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BalanceComuser</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å®ä¾‹åŒ–æ¶ˆæ¯ç”Ÿäº§è€…,æŒ‡å®šç»„å</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;group_name_8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æŒ‡å®šNamesrvåœ°å€ä¿¡æ¯.</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¢é˜…Topic</span>
        consumer<span class="token punctuation">.</span><span class="token function">setMaxReconsumeTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//tag  tagA|TagB|TagC</span>
        <span class="token comment">//è´Ÿè½½å‡è¡¡æ¨¡å¼æ¶ˆè´¹</span>
        consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">CLUSTERING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå¤„ç†æ¶ˆæ¯</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                                                            <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg <span class="token operator">:</span> msgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span> topic <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> msgBody <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> tags <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> <span class="token string">&quot; topic :&quot;</span> <span class="token operator">+</span> topic <span class="token operator">+</span> <span class="token string">&quot; ,tags : &quot;</span> <span class="token operator">+</span> tags <span class="token operator">+</span> <span class="token string">&quot; ,msg : &quot;</span> <span class="token operator">+</span> msgBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">RECONSUME_LATER</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¯åŠ¨æ¶ˆæ¯è€…</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="å¹¿æ’­æ¶ˆè´¹" tabindex="-1"><a class="header-anchor" href="#å¹¿æ’­æ¶ˆè´¹" aria-hidden="true">#</a> <strong>å¹¿æ’­æ¶ˆè´¹</strong></h6><p><img src="http://rpumme6gd.hb-bkt.clouddn.com/202302151656180.png" alt=""></p><p>æ¶ˆæ¯å°†å¯¹ä¸€ä¸ª Consumer Group ä¸‹çš„å„ä¸ª Consumer å®ä¾‹éƒ½æŠ•é€’ä¸€éã€‚å³å³ä½¿è¿™äº› Consumer å±äºåŒä¸€ä¸ª Consumer Groupï¼Œ æ¶ˆæ¯ä¹Ÿä¼šè¢« Consumer Group ä¸­çš„æ¯ä¸ª Consumer éƒ½æ¶ˆè´¹ä¸€æ¬¡ã€‚</p><p>å®é™…ä¸Šï¼Œæ˜¯ä¸€ä¸ªæ¶ˆè´¹ç»„ä¸‹çš„æ¯ä¸ªæ¶ˆè´¹è€…å®ä¾‹éƒ½è·å–åˆ°äº† topic ä¸‹é¢çš„æ¯ä¸ª Message Queue å»æ‹‰å–æ¶ˆè´¹ã€‚æ‰€ä»¥æ¶ˆæ¯ä¼šæŠ•é€’åˆ°æ¯ä¸ªæ¶ˆè´¹è€…å®ä¾‹ã€‚</p><p>è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è¿›åº¦(Consumer Offset)ä¼šå­˜å‚¨æŒä¹…åŒ–åˆ°å®ä¾‹æœ¬åœ°ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¹¿æ’­æ¶ˆè´¹
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BroadcastComuser</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å®ä¾‹åŒ–æ¶ˆæ¯ç”Ÿäº§è€…,æŒ‡å®šç»„å</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;B-test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æŒ‡å®šNamesrvåœ°å€ä¿¡æ¯.</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¢é˜…Topic</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¹¿æ’­æ¨¡å¼æ¶ˆè´¹</span>
        consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">BROADCASTING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœéç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šæ¬¡æ¶ˆè´¹çš„ä½ç½®ç»§ç»­æ¶ˆè´¹</span>
        consumer<span class="token punctuation">.</span><span class="token function">setConsumeFromWhere</span><span class="token punctuation">(</span><span class="token class-name">ConsumeFromWhere</span><span class="token punctuation">.</span><span class="token constant">CONSUME_FROM_FIRST_OFFSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå¤„ç†æ¶ˆæ¯</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                                             <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg <span class="token operator">:</span> msgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">String</span> topic <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> msgBody <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> tags <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> <span class="token string">&quot; topic :&quot;</span> <span class="token operator">+</span> topic <span class="token operator">+</span> <span class="token string">&quot; ,tags : &quot;</span> <span class="token operator">+</span> tags <span class="token operator">+</span> <span class="token string">&quot; ,msg : &quot;</span> <span class="token operator">+</span> msgBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">RECONSUME_LATER</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¯åŠ¨æ¶ˆæ¯è€…</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆæ¯æ¶ˆè´¹æ—¶çš„æƒè¡¡</strong></p><p>é›†ç¾¤æ¨¡å¼ï¼šé€‚ç”¨åœºæ™¯</p><p>æ¶ˆè´¹ç«¯é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œæ¯æ¡æ¶ˆæ¯åªéœ€è¦è¢«å¤„ç†ä¸€æ¬¡ã€‚</p><p>ç”±äºæ¶ˆè´¹è¿›åº¦åœ¨æœåŠ¡ç«¯ç»´æŠ¤ï¼Œå¯é æ€§æ›´é«˜ã€‚</p><p>é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€æ¡æ¶ˆæ¯éƒ½åªä¼šè¢«åˆ†å‘åˆ°ä¸€å°æœºå™¨ä¸Šå¤„ç†ã€‚å¦‚æœéœ€è¦è¢«é›†ç¾¤ä¸‹çš„æ¯ä¸€å°æœºå™¨éƒ½å¤„ç†ï¼Œè¯·ä½¿ç”¨å¹¿æ’­æ¨¡å¼ã€‚</p><p>é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œä¸ä¿è¯æ¯ä¸€æ¬¡å¤±è´¥é‡æŠ•çš„æ¶ˆæ¯è·¯ç”±åˆ°åŒä¸€å°æœºå™¨ä¸Šï¼Œå› æ­¤å¤„ç†æ¶ˆæ¯æ—¶ä¸åº”è¯¥åšä»»ä½•ç¡®å®šæ€§å‡è®¾ã€‚</p><p>å¹¿æ’­æ¨¡å¼ï¼šé€‚ç”¨åœºæ™¯</p><p>å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ä¸æ”¯æŒé¡ºåºæ¶ˆæ¯ã€‚</p><p>å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ä¸æ”¯æŒé‡ç½®æ¶ˆè´¹ä½ç‚¹ã€‚</p><p>æ¯æ¡æ¶ˆæ¯éƒ½éœ€è¦è¢«ç›¸åŒé€»è¾‘çš„å¤šå°æœºå™¨å¤„ç†ã€‚</p><p>æ¶ˆè´¹è¿›åº¦åœ¨å®¢æˆ·ç«¯ç»´æŠ¤ï¼Œå‡ºç°é‡å¤çš„æ¦‚ç‡ç¨å¤§äºé›†ç¾¤æ¨¡å¼ã€‚</p><p>å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ— RocketMQ ä¿è¯æ¯æ¡æ¶ˆæ¯è‡³å°‘è¢«æ¯å°å®¢æˆ·ç«¯æ¶ˆè´¹ä¸€æ¬¡ï¼Œä½†æ˜¯å¹¶ä¸ä¼šå¯¹æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯è¿›è¡Œå¤±è´¥é‡æŠ•ï¼Œå› æ­¤ä¸šåŠ¡æ–¹éœ€è¦å…³æ³¨æ¶ˆè´¹å¤±è´¥çš„æƒ…å†µã€‚</p><p>å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œ<strong>å®¢æˆ·ç«¯æ¯ä¸€æ¬¡é‡å¯éƒ½ä¼šä»æœ€æ–°æ¶ˆæ¯æ¶ˆè´¹ã€‚å®¢æˆ·ç«¯åœ¨è¢«åœæ­¢æœŸé—´å‘é€è‡³æœåŠ¡ç«¯çš„æ¶ˆæ¯å°†ä¼šè¢«è‡ªåŠ¨è·³è¿‡ï¼Œè¯·è°¨æ…é€‰æ‹©ã€‚</strong></p><p>å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«å¤§é‡çš„å®¢æˆ·ç«¯é‡å¤å¤„ç†ï¼Œå› æ­¤æ¨èå°½å¯èƒ½ä½¿ç”¨é›†ç¾¤æ¨¡å¼ã€‚</p><p>ç›®å‰ä»… Java å®¢æˆ·ç«¯æ”¯æŒå¹¿æ’­æ¨¡å¼ã€‚</p><p>å¹¿æ’­æ¨¡å¼ä¸‹æœåŠ¡ç«¯ä¸ç»´æŠ¤æ¶ˆè´¹è¿›åº¦ï¼Œæ‰€ä»¥æ¶ˆæ¯é˜Ÿåˆ— RocketMQ æ§åˆ¶å°ä¸æ”¯æŒæ¶ˆæ¯å †ç§¯æŸ¥è¯¢ã€æ¶ˆæ¯å †ç§¯æŠ¥è­¦å’Œè®¢é˜…å…³ç³»æŸ¥è¯¢åŠŸèƒ½ã€‚</p><h4 id="é¡ºåºæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#é¡ºåºæ¶ˆæ¯" aria-hidden="true">#</a> é¡ºåºæ¶ˆæ¯</h4><p>æ¶ˆæ¯æœ‰åºæŒ‡çš„æ˜¯å¯ä»¥æŒ‰ç…§æ¶ˆæ¯çš„å‘é€é¡ºåºæ¥æ¶ˆè´¹(FIFO)ã€‚RocketMQ å¯ä»¥ä¸¥æ ¼çš„ä¿è¯æ¶ˆæ¯æœ‰åºï¼Œå¯ä»¥åˆ†ä¸ºåˆ†åŒºæœ‰åºæˆ–è€…å…¨å±€æœ‰åºã€‚</p><p>é¡ºåºæ¶ˆè´¹çš„åŸç†è§£æï¼Œåœ¨é»˜è®¤çš„æƒ…å†µä¸‹æ¶ˆæ¯å‘é€ä¼šé‡‡å– Round Robin è½®è¯¢æ–¹å¼æŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„ queue(åˆ†åŒºé˜Ÿåˆ—)ï¼›è€Œæ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ä»å¤šä¸ª queue ä¸Šæ‹‰å–æ¶ˆæ¯ï¼Œè¿™ç§æƒ…å†µå‘é€å’Œæ¶ˆè´¹æ˜¯ä¸èƒ½ä¿è¯é¡ºåºã€‚ä½†æ˜¯å¦‚æœæ§åˆ¶å‘é€çš„é¡ºåºæ¶ˆæ¯åªä¾æ¬¡å‘é€åˆ°åŒä¸€ä¸ª queue ä¸­ï¼ŒBrokerä¸­ä¸€ä¸ªé˜Ÿåˆ—å†…çš„æ¶ˆæ¯æ˜¯å¯ä»¥ä¿è¯æœ‰åºçš„ã€‚æ¶ˆè´¹çš„æ—¶å€™åªä»è¿™ä¸ª queue ä¸Šä¾æ¬¡æ‹‰å–ï¼Œåˆ™å°±ä¿è¯äº†é¡ºåºã€‚å½“å‘é€å’Œæ¶ˆè´¹å‚ä¸çš„ queue åªæœ‰ä¸€ä¸ªï¼Œåˆ™æ˜¯å…¨å±€æœ‰åºï¼›å¦‚æœå¤šä¸ª queue å‚ä¸ï¼Œåˆ™ä¸ºåˆ†åŒºæœ‰åºï¼Œå³ç›¸å¯¹æ¯ä¸ª queueï¼Œæ¶ˆæ¯éƒ½æ˜¯æœ‰åºçš„ã€‚</p><p><strong>å…¨å±€é¡ºåºæ¶ˆæ¯</strong></p><p><img src="http://rpumme6gd.hb-bkt.clouddn.com/202302151656691.png" alt=""></p><p>å±€éƒ¨é¡ºåºæ¶ˆæ¯</p><p><img src="http://rpumme6gd.hb-bkt.clouddn.com/202302151656172.png" alt=""></p><p>æˆ‘ä»¬æ‰€è¯´çš„é¡ºåºæ¶ˆæ¯æŒ‡çš„æ˜¯å±€éƒ¨æ¶ˆæ¯é¡ºåºï¼Œæ¯”å¦‚è¯´ä¿è¯ä¸€ä¸ªè®¢å•ä¸‹çš„æ¶ˆæ¯é¡ºåºæ˜¯æœ‰åºçš„ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * é¡ºåºæ¶ˆæ¯ç”Ÿäº§è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> orderId <span class="token operator">=</span> i<span class="token punctuation">;</span>

                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">3</span> <span class="token punctuation">;</span> j <span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">Message</span> msg <span class="token operator">=</span>
                            <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;OrderTopicTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;order_&quot;</span><span class="token operator">+</span>orderId<span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> orderId<span class="token punctuation">,</span>
                                    <span class="token punctuation">(</span><span class="token string">&quot;order_&quot;</span><span class="token operator">+</span>orderId<span class="token operator">+</span><span class="token string">&quot; step &quot;</span> <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessageQueueSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                        <span class="token comment">//ä¿è¯åŒä¸€ä¸ªè®¢å•ä¸‹çš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€ä¸ªmessagequeueä¸­</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token class-name">MessageQueue</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">&gt;</span></span> mqs<span class="token punctuation">,</span> <span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">Integer</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>
                            <span class="token keyword">int</span> index <span class="token operator">=</span> id <span class="token operator">%</span> mqs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">return</span> mqs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> <span class="token operator">|</span> <span class="token class-name">RemotingException</span> <span class="token operator">|</span> <span class="token class-name">MQBrokerException</span> <span class="token operator">|</span> <span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¶ˆè´¹è€…å’Œæ™®é€šæ¶ˆæ¯çš„æ¶ˆè´¹è€…ä¸€æ ·ï¼Œè¿™é‡Œå°±çœç•¥äº†ã€‚</p><h4 id="å»¶è¿Ÿæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å»¶è¿Ÿæ¶ˆæ¯" aria-hidden="true">#</a> å»¶è¿Ÿæ¶ˆæ¯</h4><p>Producer å°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ— RocketMQ æœåŠ¡ç«¯ï¼Œä½†å¹¶ä¸æœŸæœ›è¿™æ¡æ¶ˆæ¯ç«‹é©¬æŠ•é€’ï¼Œè€Œæ˜¯å»¶è¿Ÿä¸€å®šæ—¶é—´åæ‰æŠ•é€’åˆ° Consumer è¿›è¡Œæ¶ˆè´¹ã€‚</p><p>é‚£ä¼šå»¶è¿Ÿå¤šä¹…å‘¢ï¼Ÿå»¶è¿Ÿæ—¶é—´çš„è®¾ç½®å°±æ˜¯åœ¨Messageæ¶ˆæ¯å¯¹è±¡ä¸Šè®¾ç½®ä¸€ä¸ªå»¶è¿Ÿçº§åˆ«message.setDelayTimeLevel(3);</p><p>å¼€æºç‰ˆæœ¬çš„RocketMQä¸­ï¼Œå¯¹å»¶è¿Ÿæ¶ˆæ¯å¹¶ä¸æ”¯æŒä»»æ„æ—¶é—´çš„å»¶è¿Ÿè®¾å®š(å•†ä¸šç‰ˆæœ¬ä¸­æ”¯æŒ)ï¼Œè€Œæ˜¯åªæ”¯æŒ18ä¸ªå›ºå®šçš„å»¶è¿Ÿçº§åˆ«ï¼Œ1åˆ°18åˆ†åˆ«å¯¹åº”messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2hã€‚æ˜¯è¿™ 18 ä¸ªç­‰çº§ï¼ˆç§’ï¼ˆsï¼‰ã€åˆ†ï¼ˆmï¼‰ã€å°æ—¶ï¼ˆhï¼‰ï¼‰ï¼Œlevel ä¸º 1ï¼Œè¡¨ç¤ºå»¶è¿Ÿ 1 ç§’åæ¶ˆè´¹ï¼Œlevel ä¸º 5 è¡¨ç¤ºå»¶è¿Ÿ 1 åˆ†é’Ÿåæ¶ˆè´¹ï¼Œlevel ä¸º 18 è¡¨ç¤ºå»¶è¿Ÿ 2 ä¸ªå°æ—¶æ¶ˆè´¹ã€‚ç”Ÿäº§æ¶ˆæ¯è·Ÿæ™®é€šçš„ç”Ÿäº§æ¶ˆæ¯ç±»ä¼¼ï¼Œåªéœ€è¦åœ¨æ¶ˆæ¯ä¸Šè®¾ç½®å»¶è¿Ÿé˜Ÿåˆ—çš„ level å³å¯ã€‚æ¶ˆè´¹æ¶ˆæ¯è·Ÿæ™®é€šçš„æ¶ˆè´¹æ¶ˆæ¯ä¸€è‡´ã€‚</p><p><strong>é€‚ç”¨åœºæ™¯</strong></p><p>æ¶ˆæ¯ç”Ÿäº§å’Œæ¶ˆè´¹æœ‰æ—¶é—´çª—å£è¦æ±‚ï¼šæ¯”å¦‚åœ¨ç”µå•†äº¤æ˜“ä¸­è¶…æ—¶æœªæ”¯ä»˜å…³é—­è®¢å•çš„åœºæ™¯ï¼Œåœ¨è®¢å•åˆ›å»ºæ—¶ä¼šå‘é€ä¸€æ¡å»¶æ—¶æ¶ˆæ¯ã€‚è¿™æ¡æ¶ˆæ¯å°†ä¼šåœ¨ 30 åˆ†é’Ÿä»¥åæŠ•é€’ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°æ­¤æ¶ˆæ¯åéœ€è¦åˆ¤æ–­å¯¹åº”çš„è®¢å•æ˜¯å¦å·²å®Œæˆæ”¯ä»˜ã€‚ å¦‚æ”¯ä»˜æœªå®Œæˆï¼Œåˆ™å…³é—­è®¢å•ã€‚å¦‚å·²å®Œæˆæ”¯ä»˜åˆ™å¿½ç•¥ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

         <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleProducerGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// Launch producer</span>
         producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> totalMessagesToSend <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalMessagesToSend<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Hello scheduled message &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">// This message will be delivered to consumer 10 seconds later.</span>
             <span class="token comment">// messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h</span>
             message<span class="token punctuation">.</span><span class="token function">setDelayTimeLevel</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">// Send the message</span>
             producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    
         <span class="token comment">// Shutdown producer after use.</span>
         producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ‰¹é‡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#æ‰¹é‡æ¶ˆæ¯" aria-hidden="true">#</a> æ‰¹é‡æ¶ˆæ¯</h4><p>æ‰¹é‡å‘é€æ¶ˆæ¯èƒ½æ˜¾è‘—æé«˜ä¼ é€’å°æ¶ˆæ¯çš„æ€§èƒ½ã€‚é™åˆ¶æ˜¯è¿™äº›æ‰¹é‡æ¶ˆæ¯åº”è¯¥æœ‰ç›¸åŒçš„ topicï¼Œç›¸åŒçš„ waitStoreMsgOKï¼ˆé›†ç¾¤æ—¶ä¼šç»†è®²ï¼‰ï¼Œè€Œä¸”ä¸èƒ½æ˜¯å»¶æ—¶æ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ã€‚æ­¤å¤–ï¼Œè¿™ä¸€æ‰¹æ¶ˆæ¯çš„æ€»å¤§å°ä¸åº”è¶…è¿‡ 4MBã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;BatchProducerGroupName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> topic <span class="token operator">=</span> <span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Message</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;Tag&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 0&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;Tag&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID002&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token string">&quot;Tag&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OrderID003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world 2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰¹é‡åˆ‡åˆ†</strong></p><p>å¦‚æœæ¶ˆæ¯çš„æ€»é•¿åº¦å¯èƒ½å¤§äº 4MB æ—¶ï¼Œè¿™æ—¶å€™æœ€å¥½æŠŠæ¶ˆæ¯è¿›è¡Œåˆ†å‰²ã€‚ç¤ºä¾‹ä»£ç åœ¨æ–‡æœ«ã€‚</p><h4 id="è¿‡æ»¤æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#è¿‡æ»¤æ¶ˆæ¯" aria-hidden="true">#</a> è¿‡æ»¤æ¶ˆæ¯</h4><p><strong>Tag</strong> <strong>è¿‡æ»¤</strong></p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒTAG æ˜¯ä¸€ä¸ªç®€å•è€Œæœ‰ç”¨çš„è®¾è®¡ï¼Œå…¶å¯ä»¥æ¥é€‰æ‹©æ‚¨æƒ³è¦çš„æ¶ˆæ¯ã€‚TAGæ˜¯RocketMQä¸­ç‰¹æœ‰çš„ä¸€ä¸ªæ¶ˆæ¯å±æ€§ã€‚RocketMQçš„æœ€ä½³å®è·µä¸­å°±å»ºè®®ï¼Œä½¿ç”¨RocketMQæ—¶ï¼Œä¸€ä¸ªåº”ç”¨å¯ä»¥å°±ç”¨ä¸€ä¸ªTopicï¼Œè€Œåº”ç”¨ä¸­çš„ä¸åŒä¸šåŠ¡å°±ç”¨TAGæ¥åŒºåˆ†ã€‚</p><p>åœ¨ç”Ÿäº§æ¶ˆæ¯æ—¶åŠ ä¸Štagï¼Œæ¶ˆè´¹æ—¶å€™åŠ ä¸Šæ¡ä»¶ï¼Œç±»ä¼¼sqlä¸­çš„whereæ¡ä»¶ã€‚consumer.subscribe(&quot;TagFilterTest&quot;, &quot;TagA || TagC&quot;); è¿™å¥åªè®¢é˜…TagAå’ŒTagCçš„æ¶ˆæ¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>   <span class="token comment">// ç”Ÿäº§è€…</span>
   <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TagFilterTest&quot;</span><span class="token punctuation">,</span>
                tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token comment">//æ¶ˆè´¹è€…</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TagFilterTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagA || TagC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ tag é™åˆ¶æ˜¯ä¸€ä¸ªæ¶ˆæ¯åªèƒ½æœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œè¿™å¯¹äºå¤æ‚çš„åœºæ™¯å¯èƒ½ä¸èµ·ä½œç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ SQL è¡¨è¾¾å¼ç­›é€‰æ¶ˆæ¯ã€‚SQL ç‰¹æ€§å¯ä»¥é€šè¿‡å‘é€æ¶ˆæ¯æ—¶çš„å±æ€§æ¥è¿›è¡Œè®¡ç®—ã€‚</p><p><strong>Sql</strong> <strong>è¿‡æ»¤</strong></p><p><strong>SQL</strong> <strong>åŸºæœ¬è¯­æ³•</strong></p><p>RocketMQ å®šä¹‰äº†ä¸€äº›åŸºæœ¬è¯­æ³•æ¥æ”¯æŒè¿™ä¸ªç‰¹æ€§ã€‚ä½ ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•å®ƒã€‚</p><p>åªæœ‰ä½¿ç”¨ push æ¨¡å¼çš„æ¶ˆè´¹è€…æ‰èƒ½ç”¨ä½¿ç”¨ SQL92 æ ‡å‡†çš„ sql è¯­å¥ï¼Œå¸¸ç”¨çš„è¯­å¥å¦‚ä¸‹ï¼š</p><p>**æ•°å€¼æ¯”è¾ƒï¼š**æ¯”å¦‚ï¼š&gt;ï¼Œ&gt;=ï¼Œ&lt;ï¼Œ&lt;=ï¼ŒBETWEENï¼Œ=ï¼›</p><p>**å­—ç¬¦æ¯”è¾ƒï¼š**æ¯”å¦‚ï¼š=ï¼Œ&lt;&gt;ï¼ŒINï¼›</p><p>IS NULL æˆ–è€… IS NOT NULLï¼›</p><p>**é€»è¾‘ç¬¦å·ï¼š**ANDï¼ŒORï¼ŒNOTï¼›</p><p><strong>å¸¸é‡æ”¯æŒç±»å‹ä¸ºï¼š</strong></p><p>æ•°å€¼ï¼Œæ¯”å¦‚ï¼š123ï¼Œ3.1415ï¼›</p><p>å­—ç¬¦ï¼Œæ¯”å¦‚ï¼š&#39;abc&#39;ï¼Œå¿…é¡»ç”¨å•å¼•å·åŒ…è£¹èµ·æ¥ï¼›</p><p><strong>NULL</strong>ï¼Œç‰¹æ®Šçš„å¸¸é‡</p><p>å¸ƒå°”å€¼ï¼ŒTRUE æˆ– FALSE</p><p>è¿™ä¸ªæ¨¡å¼çš„å…³é”®æ˜¯åœ¨æ¶ˆè´¹è€…ç«¯ä½¿ç”¨MessageSelector.bySql(String sql)è¿”å›çš„ä¸€ä¸ªMessageSelectorã€‚è¿™é‡Œé¢çš„sqlè¯­å¥æ˜¯æŒ‰ç…§SQL92æ ‡å‡†æ¥æ‰§è¡Œçš„ã€‚sqlä¸­å¯ä»¥ä½¿ç”¨çš„å‚æ•°æœ‰é»˜è®¤çš„TAGSå’Œä¸€ä¸ªåœ¨ç”Ÿäº§è€…ä¸­åŠ å…¥çš„aå±æ€§ã€‚</p><p><strong>ä½¿ç”¨æ³¨æ„ï¼šåªæœ‰æ¨æ¨¡å¼çš„æ¶ˆè´¹è€…å¯ä»¥ä½¿ç”¨SQLè¿‡æ»¤ã€‚æ‹‰æ¨¡å¼æ˜¯ç”¨ä¸äº†çš„ã€‚</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token comment">//ç”Ÿäº§è€…</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;SqlFilterTest&quot;</span><span class="token punctuation">,</span>
                tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            msg<span class="token punctuation">.</span><span class="token function">putUserProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token comment">// æ¶ˆè´¹è€…</span>
  consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;SqlFilterTest&quot;</span><span class="token punctuation">,</span>
            <span class="token class-name">MessageSelector</span><span class="token punctuation">.</span><span class="token function">bySql</span><span class="token punctuation">(</span><span class="token string">&quot;(TAGS is not null and TAGS in (&#39;TagA&#39;, &#39;TagB&#39;))&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;and (a is not null and a between 0 and 3)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ¶ˆè´¹è€…æŠ¥é”™ï¼š</p><p><img src="https://img-blog.csdnimg.cn/5118c730d0344fbcafb37f31b71b5214.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3poYW5nemVuZ3hpdQ==,size_16,color_FFFFFF,t_70#pic_center" alt=""></p><p>è¿™æ˜¯å› ä¸ºé»˜è®¤çš„brokerå¹¶æ²¡æœ‰å¼€å¯å¯¹SQLè¯­æ³•çš„æ”¯æŒï¼Œéœ€è¦ä¿®æ”¹é…ç½®:</p><p>æ‰“å¼€brokeræœåŠ¡å™¨ä¸‹çš„broker.confæ–‡ä»¶</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>enablePropertyFilter=true 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é‡å¯æœåŠ¡</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sh mqbroker -n localhost:9876 -c ../conf/broker.conf 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="äº‹åŠ¡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡æ¶ˆæ¯" aria-hidden="true">#</a> äº‹åŠ¡æ¶ˆæ¯</h4><p>äº‹åŠ¡æ¶ˆæ¯æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„ä¸¤é˜¶æ®µæäº¤çš„æ¶ˆæ¯å®ç°ã€‚ä»–å¯ä»¥ä¿è¯æœ¬åœ°äº‹åŠ¡æ‰§è¡Œä¸æ¶ˆæ¯å‘é€ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸¤ä¸ªæ“ä½œä¸€èµ·æˆåŠŸæˆ–è€…ä¸€èµ·å¤±è´¥ã€‚</p><p>äº‹åŠ¡æ¶ˆæ¯åªä¿è¯æ¶ˆæ¯å‘é€è€…çš„æœ¬åœ°äº‹åŠ¡ä¸å‘æ¶ˆæ¯è¿™ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œå› æ­¤ï¼Œäº‹åŠ¡æ¶ˆæ¯çš„ç¤ºä¾‹åªæ¶‰åŠåˆ°æ¶ˆæ¯å‘é€è€…ï¼Œå¯¹äºæ¶ˆæ¯æ¶ˆè´¹è€…æ¥è¯´ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚</p><p>äº‹åŠ¡æ¶ˆæ¯çš„å…³é”®æ˜¯åœ¨TransactionMQProducerä¸­æŒ‡å®šäº†ä¸€ä¸ªTransactionListeneräº‹åŠ¡ç›‘å¬å™¨ï¼Œè¿™ä¸ªäº‹åŠ¡ç›‘å¬å™¨å°±æ˜¯äº‹åŠ¡æ¶ˆæ¯çš„å…³é”®æ§åˆ¶å™¨ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯</strong></p><p>ç”¨æˆ·æäº¤è®¢å•åï¼Œæ‰£å‡åº“å­˜æˆåŠŸã€æ‰£å‡ä¼˜æƒ åˆ¸æˆåŠŸã€ä½¿ç”¨ä½™é¢æˆåŠŸï¼Œä½†æ˜¯åœ¨ç¡®è®¤è®¢å•æ“ä½œå¤±è´¥ï¼Œéœ€è¦å¯¹åº“å­˜ã€åº“å­˜ã€ä½™é¢è¿›è¡Œå›é€€ã€‚å¦‚ä½•ä¿è¯æ•°æ® çš„å®Œæ•´æ€§ï¼Ÿ</p><p>å¯ä»¥ä½¿ç”¨ RocketMQ çš„åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯åœ¨ä¸‹å•å¤±è´¥åç³»ç»Ÿæ•°æ®çš„å®Œæ•´æ€§ã€‚</p><p><img src="http://rpumme6gd.hb-bkt.clouddn.com/202302151657350.png" alt=""></p><p>å…¶ä¸­åˆ†ä¸ºä¸¤ä¸ªæµç¨‹ï¼šæ­£å¸¸äº‹åŠ¡æ¶ˆæ¯çš„å‘é€åŠæäº¤ã€äº‹åŠ¡æ¶ˆæ¯çš„è¡¥å¿æµç¨‹ã€‚</p><p><strong>æ­£å¸¸äº‹åŠ¡æµç¨‹</strong></p><p>(1) å‘é€æ¶ˆæ¯ï¼ˆhalf æ¶ˆæ¯ï¼‰ï¼šå›¾ä¸­æ­¥éª¤ 1ã€‚</p><p>(2) æœåŠ¡ç«¯å“åº”æ¶ˆæ¯å†™å…¥ç»“æœï¼šå›¾ä¸­æ­¥éª¤ 2ã€‚</p><p>(3) æ ¹æ®å‘é€ç»“æœæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ˆå¦‚æœå†™å…¥å¤±è´¥ï¼Œæ­¤æ—¶ half æ¶ˆæ¯å¯¹ä¸šåŠ¡ä¸å¯è§ï¼Œæœ¬åœ°é€»è¾‘ä¸æ‰§è¡Œï¼‰ï¼šå›¾ä¸­æ­¥éª¤ 3ã€‚</p><p>(4) æ ¹æ®æœ¬åœ°äº‹åŠ¡çŠ¶æ€æ‰§è¡Œ Commit æˆ–è€… Rollbackï¼ˆCommit æ“ä½œç”Ÿæˆæ¶ˆæ¯ç´¢å¼•ï¼Œæ¶ˆæ¯å¯¹æ¶ˆè´¹è€…å¯è§ï¼‰ï¼šå›¾ä¸­æ­¥éª¤ 4ã€‚</p><p><strong>äº‹åŠ¡è¡¥å¿æµç¨‹</strong></p><p>(1) å¯¹æ²¡æœ‰ Commit/Rollback çš„äº‹åŠ¡æ¶ˆæ¯ï¼ˆpending çŠ¶æ€çš„æ¶ˆæ¯ï¼‰ï¼Œä»æœåŠ¡ç«¯å‘èµ·ä¸€æ¬¡â€œå›æŸ¥â€ï¼šå›¾ä¸­æ­¥éª¤ 5ã€‚</p><p>(2) Producer æ”¶åˆ°å›æŸ¥æ¶ˆæ¯ï¼Œæ£€æŸ¥å›æŸ¥æ¶ˆæ¯å¯¹åº”çš„æœ¬åœ°äº‹åŠ¡çš„çŠ¶æ€ï¼šå›¾ä¸­æ­¥éª¤ 6ã€‚</p><p>(3) æ ¹æ®æœ¬åœ°äº‹åŠ¡çŠ¶æ€ï¼Œé‡æ–° Commit æˆ–è€… Rollbackï¼šï¼šå›¾ä¸­æ­¥éª¤ 6ã€‚</p><p>å…¶ä¸­ï¼Œè¡¥å¿é˜¶æ®µç”¨äºè§£å†³æ¶ˆæ¯ Commit æˆ–è€… Rollback å‘ç”Ÿè¶…æ—¶æˆ–è€…å¤±è´¥çš„æƒ…å†µã€‚</p><p>äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶çš„å…³é”®æ˜¯åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šå°†æ¶ˆæ¯è½¬ä¸ºä¸€ä¸ªhalfåŠæ¶ˆæ¯ï¼Œå¹¶å­˜å…¥RocketMQå†…éƒ¨çš„ä¸€ä¸ª RMQ_SYS_TRANS_HALF_TOPIC è¿™ä¸ªTopicï¼Œè¿™æ ·å¯¹æ¶ˆè´¹è€…æ˜¯ä¸å¯è§çš„ã€‚å†ç»è¿‡ä¸€ç³»åˆ—äº‹åŠ¡æ£€æŸ¥é€šè¿‡åï¼Œå†å°†æ¶ˆæ¯è½¬å­˜åˆ°ç›®æ ‡Topicï¼Œè¿™æ ·å¯¹æ¶ˆè´¹è€…å°±å¯è§äº†ã€‚</p><p><strong>äº‹åŠ¡æ¶ˆæ¯çŠ¶æ€</strong></p><p>äº‹åŠ¡æ¶ˆæ¯å…±æœ‰ä¸‰ç§çŠ¶æ€ï¼Œæäº¤çŠ¶æ€ã€å›æ»šçŠ¶æ€ã€ä¸­é—´çŠ¶æ€ï¼š</p><p>TransactionStatus.CommitTransaction: æäº¤çŠ¶æ€ï¼Œå®ƒå…è®¸æ¶ˆè´¹è€…æ¶ˆè´¹æ­¤æ¶ˆæ¯ï¼ˆå®Œæˆå›¾ä¸­äº† 1ï¼Œ2,3,4 æ­¥ï¼Œç¬¬ 4 æ­¥æ˜¯ Commitï¼‰ã€‚</p><p>TransactionStatus.RollbackTransaction: å›æ»šçŠ¶æ€ï¼Œå®ƒä»£è¡¨è¯¥æ¶ˆæ¯å°†è¢«åˆ é™¤ï¼Œä¸å…è®¸è¢«æ¶ˆè´¹ï¼ˆå®Œæˆå›¾ä¸­äº† 1ï¼Œ2,3,4 æ­¥, ç¬¬ 4 æ­¥æ˜¯ Rollbackï¼‰ã€‚</p><p>TransactionStatus.Unknown: ä¸­é—´çŠ¶æ€ï¼Œå®ƒä»£è¡¨éœ€è¦æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—æ¥ç¡®å®šçŠ¶æ€ï¼ˆå®Œæˆå›¾ä¸­äº† 1,2,3 æ­¥, ä½†æ˜¯æ²¡æœ‰ 4 æˆ–è€…æ²¡æœ‰ 7ï¼Œæ— æ³• Commit æˆ– Rollbackï¼‰ã€‚</p><p>äº‹åŠ¡æ¶ˆæ¯çš„ä½¿ç”¨é™åˆ¶ï¼š</p><p>1ã€äº‹åŠ¡æ¶ˆæ¯ä¸æ”¯æŒå»¶è¿Ÿæ¶ˆæ¯å’Œæ‰¹é‡æ¶ˆæ¯ã€‚</p><p>2ã€ä¸ºäº†é¿å…å•ä¸ªæ¶ˆæ¯è¢«æ£€æŸ¥å¤ªå¤šæ¬¡è€Œå¯¼è‡´åŠé˜Ÿåˆ—æ¶ˆæ¯ç´¯ç§¯ï¼Œæˆ‘ä»¬é»˜è®¤å°†å•ä¸ªæ¶ˆæ¯çš„æ£€æŸ¥æ¬¡æ•°é™åˆ¶ä¸º 15 æ¬¡ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥é€šè¿‡ Broker é…ç½®æ–‡ä»¶çš„ transactionCheckMaxå‚æ•°æ¥ä¿®æ”¹æ­¤é™åˆ¶ã€‚å¦‚æœå·²ç»æ£€æŸ¥æŸæ¡æ¶ˆæ¯è¶…è¿‡ N æ¬¡çš„è¯ï¼ˆ N = transactionCheckMax ï¼‰ åˆ™ Broker å°†ä¸¢å¼ƒæ­¤æ¶ˆæ¯ï¼Œå¹¶åœ¨é»˜è®¤æƒ…å†µä¸‹åŒæ—¶æ‰“å°é”™è¯¯æ—¥å¿—ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡é‡å†™ AbstractTransactionCheckListener ç±»æ¥ä¿®æ”¹è¿™ä¸ªè¡Œä¸ºã€‚</p><p>3ã€äº‹åŠ¡æ¶ˆæ¯å°†åœ¨ Broker é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•° transactionMsgTimeout è¿™æ ·çš„ç‰¹å®šæ—¶é—´é•¿åº¦ä¹‹åè¢«æ£€æŸ¥ã€‚å½“å‘é€äº‹åŠ¡æ¶ˆæ¯æ—¶ï¼Œç”¨æˆ·è¿˜å¯ä»¥é€šè¿‡è®¾ç½®ç”¨æˆ·å±æ€§ CHECK_IMMUNITY_TIME_IN_SECONDS æ¥æ”¹å˜è¿™ä¸ªé™åˆ¶ï¼Œè¯¥å‚æ•°ä¼˜å…ˆäº transactionMsgTimeout å‚æ•°ã€‚</p><p>4ã€äº‹åŠ¡æ€§æ¶ˆæ¯å¯èƒ½ä¸æ­¢ä¸€æ¬¡è¢«æ£€æŸ¥æˆ–æ¶ˆè´¹ã€‚</p><p>5ã€æäº¤ç»™ç”¨æˆ·çš„ç›®æ ‡ä¸»é¢˜æ¶ˆæ¯å¯èƒ½ä¼šå¤±è´¥ï¼Œç›®å‰è¿™ä¾æ—¥å¿—çš„è®°å½•è€Œå®šã€‚å®ƒçš„é«˜å¯ç”¨æ€§é€šè¿‡ RocketMQ æœ¬èº«çš„é«˜å¯ç”¨æ€§æœºåˆ¶æ¥ä¿è¯ï¼Œå¦‚æœå¸Œæœ›ç¡®ä¿äº‹åŠ¡æ¶ˆæ¯ä¸ä¸¢å¤±ã€å¹¶ä¸”äº‹åŠ¡å®Œæ•´æ€§å¾—åˆ°ä¿è¯ï¼Œå»ºè®®ä½¿ç”¨åŒæ­¥çš„åŒé‡å†™å…¥æœºåˆ¶ã€‚</p><p>6ã€äº‹åŠ¡æ¶ˆæ¯çš„ç”Ÿäº§è€… ID ä¸èƒ½ä¸å…¶ä»–ç±»å‹æ¶ˆæ¯çš„ç”Ÿäº§è€… ID å…±äº«ã€‚ä¸å…¶ä»–ç±»å‹çš„æ¶ˆæ¯ä¸åŒï¼Œäº‹åŠ¡æ¶ˆæ¯å…è®¸åå‘æŸ¥è¯¢ã€MQæœåŠ¡å™¨èƒ½é€šè¿‡å®ƒä»¬çš„ç”Ÿäº§è€… ID æŸ¥è¯¢åˆ°æ¶ˆè´¹è€…ã€‚</p><p>7ã€äº‹åŠ¡æ€§æ¶ˆæ¯ä¸­ç”¨åˆ°äº†ç”Ÿäº§è€…ç¾¤ç»„ï¼Œè¿™ç§å°±æ˜¯ä¸€ç§é«˜å¯ç”¨æœºåˆ¶ï¼Œç”¨æ¥ç¡®ä¿äº‹åŠ¡æ¶ˆæ¯çš„å¯é æ€§ã€‚</p><p>8ã€**äº‹åŠ¡å›æŸ¥çš„é—´éš”æ—¶é—´ï¼š**BrokerConfig. transactionCheckInterval é€šè¿‡ Broker çš„é…ç½®æ–‡ä»¶è®¾ç½®å¥½ã€‚</p><p><strong>åˆ›å»ºäº‹åŠ¡æ€§ç”Ÿäº§è€…</strong></p><p>ä½¿ç”¨ TransactionMQProducer ç±»åˆ›å»ºç”Ÿäº§è€…ï¼Œå¹¶æŒ‡å®šå”¯ä¸€çš„ ProducerGroupï¼Œå°±å¯ä»¥è®¾ç½®è‡ªå®šä¹‰çº¿ç¨‹æ± æ¥å¤„ç†è¿™äº›æ£€æŸ¥è¯·æ±‚ã€‚æ‰§è¡Œæœ¬åœ°äº‹åŠ¡åã€éœ€ è¦æ ¹æ®æ‰§è¡Œç»“æœå¯¹æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå›å¤ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//äº‹åŠ¡ç›‘å¬å™¨</span>
        <span class="token class-name">TransactionListener</span> transactionListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionListenerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…</span>
        <span class="token class-name">TransactionMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;client-transaction-msg-check-thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è®¾ç½®ç”Ÿäº§è€…å›æŸ¥çº¿ç¨‹æ± </span>
        producer<span class="token punctuation">.</span><span class="token function">setExecutorService</span><span class="token punctuation">(</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”Ÿäº§è€…ç›‘å¬å™¨</span>
        producer<span class="token punctuation">.</span><span class="token function">setTransactionListener</span><span class="token punctuation">(</span>transactionListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> tags <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span>
                    <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> tags<span class="token punctuation">[</span>i <span class="token operator">%</span> tags<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;KEY&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//                msg.putUserProperty(&quot;CHECK_IMMUNITY_TIME_IN_SECONDS&quot;,&quot;10000&quot;);</span>
                <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">sendMessageInTransaction</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> <span class="token operator">|</span> <span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®ç°äº‹åŠ¡çš„ç›‘å¬æ¥å£</strong></p><p>å½“å‘é€åŠæ¶ˆæ¯æˆåŠŸæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ executeLocalTransaction æ–¹æ³•æ¥æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ˆ<strong>æ­¥éª¤ 3</strong>ï¼‰ã€‚å®ƒè¿”å›å‰ä¸€èŠ‚ä¸­æåˆ°çš„ä¸‰ä¸ªäº‹åŠ¡çŠ¶æ€ä¹‹ä¸€ã€‚</p><p>checkLocalTranscation æ–¹æ³•ç”¨äºæ£€æŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€ï¼ˆ<strong>æ­¥éª¤ 5</strong>ï¼‰ï¼Œå¹¶å›åº”æ¶ˆæ¯é˜Ÿåˆ—çš„æ£€æŸ¥è¯·æ±‚ã€‚å®ƒä¹Ÿæ˜¯è¿”å›å‰ä¸€èŠ‚ä¸­æåˆ°çš„ä¸‰ä¸ªäº‹åŠ¡çŠ¶æ€ä¹‹ä¸€ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionListenerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">TransactionListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicInteger</span> transactionIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> localTrans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ‰§è¡Œæœ¬åœ°äº‹åŠ¡
     * <span class="token keyword">@param</span> <span class="token parameter">msg</span>
     * <span class="token keyword">@param</span> <span class="token parameter">arg</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">executeLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> value <span class="token operator">=</span> transactionIndex<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> status <span class="token operator">=</span> value <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
        localTrans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getTransactionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">UNKNOW</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ£€æŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€
     * <span class="token keyword">@param</span> <span class="token parameter">msg</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalTransactionState</span> <span class="token function">checkLocalTransaction</span><span class="token punctuation">(</span><span class="token class-name">MessageExt</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> status <span class="token operator">=</span> localTrans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getTransactionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MQæ£€æŸ¥æ¶ˆæ¯ã€&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">.</span><span class="token function">getTransactionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;ã€‘äº‹åŠ¡çŠ¶æ€ã€ä¸­é—´çŠ¶æ€ã€‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">UNKNOW</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MQæ£€æŸ¥æ¶ˆæ¯ã€&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">.</span><span class="token function">getTransactionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;ã€‘äº‹åŠ¡çŠ¶æ€ã€æäº¤çŠ¶æ€ã€‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MQæ£€æŸ¥æ¶ˆæ¯ã€&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">.</span><span class="token function">getTransactionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;ã€‘äº‹åŠ¡çŠ¶æ€ã€å›æ»šçŠ¶æ€ã€‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">ROLLBACK_MESSAGE</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MQæ£€æŸ¥æ¶ˆæ¯ã€&quot;</span><span class="token operator">+</span>msg<span class="token punctuation">.</span><span class="token function">getTransactionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;ã€‘äº‹åŠ¡çŠ¶æ€ã€æäº¤çŠ¶æ€ã€‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">LocalTransactionState</span><span class="token punctuation">.</span><span class="token constant">COMMIT_MESSAGE</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="springbootæ•´åˆrocketmq" tabindex="-1"><a class="header-anchor" href="#springbootæ•´åˆrocketmq" aria-hidden="true">#</a> <strong>SpringBootæ•´åˆRocketMQ</strong></h2><h3 id="å¼•å…¥ä¾èµ–-1" tabindex="-1"><a class="header-anchor" href="#å¼•å…¥ä¾èµ–-1" aria-hidden="true">#</a> å¼•å…¥ä¾èµ–</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>       &lt;dependency&gt;
            &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;
            &lt;artifactId&gt;rocketmq-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.2.1&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                    &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                    &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æ–‡ä»¶</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>rocketmq.name-server=127.0.0.1:9876
#ç”Ÿäº§è€…ç»„
rocketmq.producer.group=springBootGroup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¶ˆæ¯ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯ç”Ÿäº§è€…" aria-hidden="true">#</a> æ¶ˆæ¯ç”Ÿäº§è€…</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringProducer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RocketMQTemplate</span> rocketMQTemplate<span class="token punctuation">;</span>

    <span class="token comment">//å‘é€æ™®é€šæ¶ˆæ¯</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rocketMQTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¶ˆæ¯æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯æ¶ˆè´¹è€…" aria-hidden="true">#</a> æ¶ˆæ¯æ¶ˆè´¹è€…</h3><p>SpringBooté›†æˆRocketMQï¼Œæ¶ˆè´¹è€…éƒ¨åˆ†çš„æ ¸å¿ƒå°±åœ¨@RocketMQMessageListeneræ³¨è§£ä¸Šã€‚æ‰€æœ‰æ¶ˆè´¹è€…çš„æ ¸å¿ƒåŠŸèƒ½ä¹Ÿéƒ½ä¼š</p><p>é›†æˆåˆ°è¿™ä¸ªæ³¨è§£ä¸­ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹æ³¨è§£çš„å±æ€§ï¼š</p><p>consumerGroup æ¶ˆè´¹è€…åˆ†ç»„</p><p>topic ä¸»é¢˜</p><p>selectorType æ¶ˆæ¯é€‰æ‹©å™¨ç±»å‹ é»˜è®¤å€¼ SelectorType.TAG æ ¹æ®TAGé€‰æ‹© ä»…æ”¯æŒè¡¨è¾¾å¼æ ¼å¼å¦‚ï¼šâ€œtag1 || tag2 || tag3â€ï¼Œå¦‚æœè¡¨è¾¾å¼ä¸ºnullæˆ–è€…â€œ*â€æ ‡è¯†è®¢é˜…æ‰€æœ‰æ¶ˆæ¯ SelectorType.SQL92 æ ¹æ®SQL92è¡¨è¾¾å¼é€‰æ‹©</p><p>selectorExpression è¿‡æ»¤è¡¨è¾¾å¼</p><p>æ¶ˆæ¯è¿‡æ»¤å¯ä»¥ç”±é‡Œé¢çš„selectorTypeå±æ€§å’ŒselectorExpressionæ¥å®šåˆ¶</p><p>consumeMode æ¶ˆè´¹æ¨¡å¼ é»˜è®¤å€¼ ConsumeMode.CONCURRENTLY å¹¶è¡Œå¤„ç† ConsumeMode.ORDERLY æŒ‰é¡ºåºå¤„ç†</p><p>messageModel æ¶ˆæ¯æ¨¡å‹ é»˜è®¤å€¼ MessageModel.CLUSTERING é›†ç¾¤ MessageModel.BROADCASTING å¹¿æ’­</p><p>consumeThreadMax æœ€å¤§çº¿ç¨‹æ•° é»˜è®¤å€¼ 64</p><p>consumeTimeout è¶…æ—¶æ—¶é—´ é»˜è®¤å€¼ 30000ms</p><p>accessKey é»˜è®¤å€¼ ${rocketmq.consumer.access-key:}</p><p>secretKey é»˜è®¤å€¼ ${rocketmq.consumer.secret-key:}</p><p>enableMsgTrace å¯ç”¨æ¶ˆæ¯è½¨è¿¹ é»˜è®¤å€¼ true</p><p>customizedTraceTopic è‡ªå®šä¹‰çš„æ¶ˆæ¯è½¨è¿¹ä¸»é¢˜ é»˜è®¤å€¼ ${rocketmq.consumer.customized-trace-topic:} æ²¡æœ‰é…ç½®æ­¤é…ç½®é¡¹åˆ™ä½¿ç”¨é»˜è®¤çš„ä¸»é¢˜</p><p>nameServer å‘½åæœåŠ¡å™¨åœ°å€ é»˜è®¤å€¼ ${rocketmq.name-server:}</p><p>accessChannel é»˜è®¤å€¼ ${rocketmq.access-channel:}</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RocketMQMessageListener</span><span class="token punctuation">(</span>consumerGroup <span class="token operator">=</span> <span class="token string">&quot;MyConsumerGroup&quot;</span><span class="token punctuation">,</span> topic <span class="token operator">=</span> <span class="token string">&quot;TestTopic&quot;</span><span class="token punctuation">,</span>consumeMode<span class="token operator">=</span> <span class="token class-name">ConsumeMode</span><span class="token punctuation">.</span><span class="token constant">CONCURRENTLY</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConsumer</span> <span class="token keyword">implements</span> <span class="token class-name">RocketMQListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received message : &quot;</span><span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šSpringBootä¾èµ–ä¸­çš„Messageå¯¹è±¡å’ŒRocketMQ-clientä¸­çš„Messageå¯¹è±¡æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œè¿™åœ¨ä½¿ç”¨çš„æ—¶å€™è¦éå¸¸å®¹æ˜“å¼„é”™ã€‚ä¾‹å¦‚RocketMQ-clientä¸­çš„Messageé‡Œçš„TAGå±æ€§ï¼Œåœ¨SpringBootä¾èµ–ä¸­çš„Messageä¸­å°±æ²¡æœ‰ã€‚Tagå±æ€§è¢«ç§»åˆ°äº†å‘é€ç›®æ ‡ä¸­ï¼Œä¸Topicä¸€èµ·ï¼Œä»¥Topic:Tagçš„æ–¹å¼æŒ‡å®šã€‚</p><p>é¡¹ç›®åœ°å€ï¼šhttps://gitee.com/zysspace/mq-demo</p><p>ç å­—ä¸æ˜“ï¼Œå–œæ¬¢è®°å¾—ç‚¹èµã€æ”¶è—ï¼</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: zysspace@163.com">javacode</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/docs/RocketMQ/RocketMQ%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" class="nav-link prev" aria-label="RocketMQåŸºç¡€çŸ¥è¯†"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon discover" style=""></span>RocketMQåŸºç¡€çŸ¥è¯†</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/docs/assets/app-e6db4a12.js" defer></script>
  </body>
</html>
